
[{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/auto/","section":"Tags","summary":"","title":"Auto","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/build/","section":"Tags","summary":"","title":"Build","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/ci/","section":"Tags","summary":"","title":"Ci","type":"tags"},{"content":" 1.è‡ªåŠ¨åŒ–æ„å»º # é€šè¿‡åœ¨éœ€è¦è‡ªåŠ¨åŒ–çš„æ­¥éª¤ï¼ŒæŒ‡å®šruleså¯¹åº”commitåˆ†æ”¯å³å¯ï¼Œè‡ªåŠ¨è§¦å‘è¯¥æ­¥éª¤ stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;è‡ªåŠ¨åŒ–æ„å»º\u0026#34; rules: - if: \u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;master\u0026#34;\u0026#39; 2. åŠè‡ªåŠ¨åŒ–æ„å»º(å‚è€ƒå‹äººæ–¹æ¡ˆï¼‰ # è®¾å®šå¥½éœ€è¦æ‰§è¡Œçš„commitåˆ†æ”¯ä»¥åŠè§¦å‘åŠè‡ªåŠ¨åŒ–æ„å»ºçš„å˜é‡åŠå€¼ è¯¥å˜é‡RUN_PIPELINEåˆå§‹åŒ–å€¼ä¸ºfalse variables: RUN_PIPELINE: \u0026#39;false\u0026#39; stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;è‡ªåŠ¨åŒ–æ„å»º\u0026#34; rules: - if: \u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;dev\u0026#34; \u0026amp;\u0026amp; $RUN_PIPELINE == \u0026#34;true\u0026#34;\u0026#39; åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºgit-push-ci.shæ–‡ä»¶ #!/bin/bash # æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦ä¸º dev current_branch=$(git rev-parse --abbrev-ref HEAD) if [ \u0026#34;$current_branch\u0026#34; != \u0026#34;dev\u0026#34; ]; then echo \u0026#34;Error: This script should only be run on the dev branch.\u0026#34; exit 1 fi # è®¾ç½® CI å˜é‡å¹¶æ¨é€ git push origin dev -o ci.variable=\u0026#34;RUN_PIPELINE=true\u0026#34; echo \u0026#34;Pushed to dev branch with pipeline trigger.\u0026#34; åœ¨å…¨å±€ç”¨æˆ·gité…ç½®æœ«å°¾æ·»åŠ  windowsé»˜è®¤è·¯å¾„ï¼šC:\\Users\\Administrator.gitconfig [alias] push-ci = \u0026#34;!sh ./git-push-ci.sh\u0026#34; æäº¤ä»£ç æ—¶ï¼Œä½¿ç”¨git push-ciä»£æ›¿git pushï¼Œå³å¯è§¦å‘CICDæµç¨‹ 3. æ‰‹åŠ¨æ„å»º # é€šè¿‡åœ¨éœ€è¦æ‰‹åŠ¨æ‰§è¡Œçš„æ­¥éª¤ï¼ŒæŒ‡å®šruleså¯¹åº”å‚æ•° stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;æ‰‹åŠ¨æ„å»º\u0026#34; rules: - if: \u0026#39;$EXECUTE_MODE == \u0026#34;manual\u0026#34;\u0026#39; åœ¨gitlabç•Œé¢ï¼Œæ‰‹åŠ¨ç‚¹Run pipelineæŒ‰é’®è¿›å» é€‰æ‹©éœ€è¦æ‰§è¡Œçš„åˆ†æ”¯ï¼Œè¾“å…¥ä¸Šä¸€æ­¥å®šä¹‰å˜é‡åŠå€¼ å³å¯æ‰‹åŠ¨æ‰§è¡ŒCICDæµç¨‹ ","date":"2024-09-11","externalUrl":null,"permalink":"/devops/20240911-1/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"\u003ch1 class=\"relative group\"\u003e1.è‡ªåŠ¨åŒ–æ„å»º \n    \u003cdiv id=\"1%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eé€šè¿‡åœ¨éœ€è¦è‡ªåŠ¨åŒ–çš„æ­¥éª¤ï¼ŒæŒ‡å®šruleså¯¹åº”commitåˆ†æ”¯å³å¯ï¼Œè‡ªåŠ¨è§¦å‘è¯¥æ­¥éª¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;è‡ªåŠ¨åŒ–æ„å»º\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;master\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1 class=\"relative group\"\u003e2. åŠè‡ªåŠ¨åŒ–æ„å»º(å‚è€ƒå‹äººæ–¹æ¡ˆï¼‰ \n    \u003cdiv id=\"2-%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%8F%82%E8%80%83%E5%8F%8B%E4%BA%BA%E6%96%B9%E6%A1%88\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#2-%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%8F%82%E8%80%83%E5%8F%8B%E4%BA%BA%E6%96%B9%E6%A1%88\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eè®¾å®šå¥½éœ€è¦æ‰§è¡Œçš„commitåˆ†æ”¯ä»¥åŠè§¦å‘åŠè‡ªåŠ¨åŒ–æ„å»ºçš„å˜é‡åŠå€¼\n\u003cul\u003e\n\u003cli\u003eè¯¥å˜é‡\u003ccode\u003eRUN_PIPELINE\u003c/code\u003eåˆå§‹åŒ–å€¼ä¸º\u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eRUN_PIPELINE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;false\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;è‡ªåŠ¨åŒ–æ„å»º\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;dev\u0026#34; \u0026amp;\u0026amp; $RUN_PIPELINE == \u0026#34;true\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º\u003ccode\u003egit-push-ci.sh\u003c/code\u003eæ–‡ä»¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦ä¸º dev\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecurrent_branch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003egit rev-parse --abbrev-ref HEAD\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$current_branch\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;dev\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Error: This script should only be run on the dev branch.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¾ç½® CI å˜é‡å¹¶æ¨é€\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit push origin dev -o ci.variable\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;RUN_PIPELINE=true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Pushed to dev branch with pipeline trigger.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨å…¨å±€ç”¨æˆ·gité…ç½®æœ«å°¾æ·»åŠ \n\u003cul\u003e\n\u003cli\u003ewindowsé»˜è®¤è·¯å¾„ï¼šC:\\Users\\Administrator.gitconfig\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-conf\" data-lang=\"conf\"\u003e[alias]\n  push-ci = \u0026#34;!sh ./git-push-ci.sh\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eæäº¤ä»£ç æ—¶ï¼Œä½¿ç”¨\u003ccode\u003egit push-ci\u003c/code\u003eä»£æ›¿\u003ccode\u003egit push\u003c/code\u003eï¼Œå³å¯è§¦å‘CICDæµç¨‹\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e3. æ‰‹åŠ¨æ„å»º \n    \u003cdiv id=\"3-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#3-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eé€šè¿‡åœ¨éœ€è¦æ‰‹åŠ¨æ‰§è¡Œçš„æ­¥éª¤ï¼ŒæŒ‡å®šruleså¯¹åº”å‚æ•°\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;æ‰‹åŠ¨æ„å»º\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$EXECUTE_MODE == \u0026#34;manual\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨gitlabç•Œé¢ï¼Œæ‰‹åŠ¨ç‚¹\u003ccode\u003eRun pipeline\u003c/code\u003eæŒ‰é’®è¿›å»\n\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./1.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/li\u003e\n\u003cli\u003eé€‰æ‹©éœ€è¦æ‰§è¡Œçš„åˆ†æ”¯ï¼Œè¾“å…¥ä¸Šä¸€æ­¥å®šä¹‰å˜é‡åŠå€¼\n\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./2.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/li\u003e\n\u003cli\u003eå³å¯æ‰‹åŠ¨æ‰§è¡ŒCICDæµç¨‹\u003c/li\u003e\n\u003c/ul\u003e","title":"Devopsä¹‹CIä¸‰ç§è§¦å‘æ„å»º","type":"blog"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/kubernetes/","section":"Tags","summary":"","title":"Kubernetes","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/","section":"æ¬¢è¿æ¥åˆ°äº‘ä¸€äºŒä¸‰çŸ¥è¯†åº“! ğŸ‰","summary":"","title":"æ¬¢è¿æ¥åˆ°äº‘ä¸€äºŒä¸‰çŸ¥è¯†åº“! ğŸ‰","type":"page"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/devops/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"","title":"äº‘åŸç”ŸAIæŠ€æœ¯","type":"devops"},{"content":" 1. å‰è¨€ # å‚è€ƒï¼šgitlab-runnerå­¦ä¹ èµ„æ–™å¤§å…¨\næœ¬æ–¹æ¡ˆCIé‡‡ç”¨çš„æ˜¯gitlab-ciï¼Œé€šè¿‡å¯åŠ¨gitlab-runnerå»æ„å»ºå®ç°ï¼Œç†è®ºä¸Šå¯ä»¥æ„å»ºä»»æ„å½¢å¼çš„åˆ¶å“ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºé•œåƒã€å‰ç«¯é™æ€æ–‡ä»¶å‹ç¼©åŒ…ç­‰ã€‚\n1.1 K8s éƒ¨ç½² Gitlab CI Runner # K8s ç‰ˆæœ¬ï¼š1.20.10 GitLab CI æœ€å¤§çš„ä½œç”¨æ˜¯ç®¡ç†å„ä¸ªé¡¹ç›®çš„æ„å»ºçŠ¶æ€ã€‚å› æ­¤ï¼Œè¿è¡Œæ„å»ºä»»åŠ¡è¿™ç§æµªè´¹èµ„æºçš„äº‹æƒ…äº¤ç»™ä¸€ä¸ªç‹¬ç«‹çš„ Gitlab Runner æ¥åšå°±ä¼šå¥½å¾ˆå¤šï¼Œè€Œä¸” Gitlab Runner å¯ä»¥å®‰è£…åˆ°ä¸åŒçš„æœºå™¨ä¸Š åªè¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª.gitlab-ci.ymlæ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä¸€ä¸ª Runner ï¼Œå³å¯è¿›è¡ŒæŒç»­é›†æˆ å®˜æ–¹æ–‡æ¡£ï¼šInstall GitLab Runner | GitLab 1.2 ä»‹ç» # Pipelineï¼šç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªæµç¨‹ï¼Œå¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰ã€‚ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline æ„å»º Stagesï¼šè¡¨ç¤ºä¸€ä¸ªæ„å»ºé˜¶æ®µã€‚ä¸€æ¬¡ Pipeline ä¸­å¯å®šä¹‰å¤šä¸ª Stages æ‰€æœ‰ Stages ä¼šé¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹ åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡æ‰ä¼šæˆåŠŸ å¦‚æœä»»ä½•ä¸€ä¸ª Stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ Stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡å¤±è´¥ Jobsï¼šè¡¨ç¤ºæ„å»ºå·¥ä½œï¼Œå³æŸä¸ª Stage é‡Œé¢æ‰§è¡Œçš„å·¥ä½œã€‚ä¸€ä¸ª Stage ä¸­å¯å®šä¹‰å¤šä¸ª Jobs ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æ‰ä¼šæˆåŠŸ å¦‚æœä»»ä½•ä¸€ä¸ª Job å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥ Stage å¤±è´¥ï¼Œå³è¯¥æ„å»ºä»»åŠ¡å¤±è´¥ Runnerï¼šæ‰§è¡Œ Gitlab CI æ„å»ºä»»åŠ¡ 2. gitlab-ciç¼“å­˜é…ç½® # æœ¬é¡¹ç›®é€šè¿‡minioçš„s3æ¥å£ä¸ºgitlab-ciæä¾›è¯¸å¦‚mavenä¾èµ–ç­‰ç¼“å­˜\n2.1 minioå®‰è£… # minioçš„helmåŒ…ä¸‹è½½\nhelm repo add bitnami https://charts.bitnami.com/bitnami helm repo update helm pull bitnami/minio tar -xvf minio-14.7.5.tgz minioé…ç½®ä¿®æ”¹\nvalues.yaml mode: distributed ...... auth: ## @param auth.rootUser MinIO\u0026amp;reg; root username ## rootUser: minio ## @param auth.rootPassword Password for MinIO\u0026amp;reg; root user ## rootPassword: \u0026#34;minio123\u0026#34; ...... resourcesPreset: \u0026#34;2xlarge\u0026#34; ...... statefulset: ## @param statefulset.replicaCount Number of pods per zone (only for MinIO\u0026amp;reg; distributed mode). Should be even and `\u0026gt;= 4` ## replicaCount: 4 ...... persistence: ## @param persistence.enabled Enable MinIO\u0026amp;reg; data persistence using PVC. If false, use emptyDir ## enabled: true ## @param persistence.storageClass PVC Storage Class for MinIO\u0026amp;reg; data volume ## If defined, storageClassName: \u0026lt;storageClass\u0026gt; ## If set to \u0026#34;-\u0026#34;, storageClassName: \u0026#34;\u0026#34;, which disables dynamic provisioning ## If undefined (the default) or set to null, no storageClassName spec is ## set, choosing the default provisioner. (gp2 on AWS, standard on ## GKE, AWS \u0026amp; OpenStack) ## storageClass: \u0026#34;\u0026#34; ## @param persistence.mountPath Data volume mount path ## mountPath: /bitnami/minio/data ## @param persistence.accessModes PVC Access Modes for MinIO\u0026amp;reg; data volume ## accessModes: - ReadWriteMany ## @param persistence.size PVC Storage Request for MinIO\u0026amp;reg; data volume ## size: 30Gi minioå®‰è£…\nå‘½åç©ºé—´æŒ‡å®šï¼š-n minio #é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®å¯†ç ä¸ç”Ÿæ•ˆ #helm install -n minio minio bitnami/minio --set accessKey=minio,secretKey=minio123 helm install -n minio minio bitnami/minio -f ./values.yaml 2.2 minioæ•°æ®è¿ç§»ï¼ˆå¦‚æœä¹‹å‰é…ç½®è¿‡ï¼‰ # minioå®¢æˆ·ç«¯ä¸‹è½½ wget https:// dl.minio.org.cn/client/mc/release/linux-amd64/mc \u0026amp;\u0026amp; chmod -x mc \u0026amp;\u0026amp; mv mc /usr/bin minioæœåŠ¡ç«¯åˆ«åè®¾ç½® mc alias set minio1 http://172.16.2.xx1:3xxx1 minio minio123 mc alias set minio2 http://172.16.2.xx2:3xxx2 minio minio123 æ•°æ®é€šè¿‡å‘½ä»¤è¿ç§»ï¼ˆå¦‚æœé…ç½®ä½çš„è¯ï¼Œä¼šå¯¼è‡´å¤±è´¥ï¼‰ mc mirror minio1/gitlabrb minio2/gitlabrb æ•°æ®ä¸‹è½½åè¿ç§»ï¼ˆæ— è§†minioé…ç½®ï¼‰, å› minioæ€§èƒ½å·®ï¼Œæ— æ³•ç›´æ¥mc cpæ‰€æœ‰é¡¹ç›®åˆ°minioä»“åº“ä¸­ï¼Œå› æ­¤é‡‡ç”¨bashè„šæœ¬é€ä¸ªå­é¡¹ç›®ä¸Šä¼  æ‹·è´æºminioä»“åº“åˆ°æœ¬åœ°ï¼šmc cp \u0026ndash;recursive minio1/gitlabrb ./ æ‹·è´æœ¬åœ°ä»“åº“åˆ°minioä»“åº“ï¼šmc cp $i minio2/gitlabrb/gitlabruner/project \u0026ndash;recursive \u0026ndash;recursiveï¼šé€’å½’cpç›®å½• listä¸­ä¸ºåŸminioä¸Šgitlabrb/gitlabruner/projectä¸‹çš„å­ç›®å½• #!/bin/bash list=(1040 1196 1197 1198 1199 1205 1222 1239 1271 1272 1273 1274 1279 1294 1304 1311 1314 1326 1334 1335 1336 1338 1342 1357 1360 1460 1476 1483 275 357 361 362 368 370 374 375 376 377 378 379 381 382 383 406 407) for i in ${list[@]};do mc cp $i minio2/gitlabrb/gitlabruner/project --recursive sleep 5 done 3. gitlab-runnerå®‰è£… # gitlab-runner.yaml gitlabåœ°å€ï¼šCI_SERVER_URL runnerå¹¶å‘æ•°ï¼šRUNNER_REQUEST_CONCURRENCY minio-bucketåœ°å€ï¼šCACHE_PATH minioåœ°å€ï¼šCACHE_S3_SERVER_ADDRESS å…è®¸httpçš„minioæœåŠ¡ï¼šCACHE_S3_INSECURE: \u0026ldquo;true\u0026rdquo; gitlab-groupçš„å¯†é’¥ï¼Œéœ€ç»è¿‡base64å¤„ç†(echo xxxxxxs | base64 -w0)ï¼šGITLAB_CI_TOKEN http://gitlab.south.com/admin/runners -\u0026gt; xxxs apiVersion: v1 kind: ServiceAccount metadata: name: gitlab-ci namespace: gitlab --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: name: gitlab-ci namespace: gitlab rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;*\u0026#34;] verbs: [\u0026#34;*\u0026#34;] --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: gitlab-ci namespace: gitlab subjects: - kind: ServiceAccount name: gitlab-ci namespace: gitlab roleRef: kind: Role name: gitlab-ci apiGroup: rbac.authorization.k8s.io --- apiVersion: v1 kind: ConfigMap metadata: labels: app: gitlab-ci-runner name: gitlab-ci-runner-cm namespace: gitlab data: REGISTER_NON_INTERACTIVE: \u0026#34;true\u0026#34; REGISTER_LOCKED: \u0026#34;false\u0026#34; METRICS_SERVER: \u0026#34;0.0.0.0:9100\u0026#34; CI_SERVER_URL: \u0026#34;https://git.xxx.cn\u0026#34; # * RUNNER_REQUEST_CONCURRENCY: \u0026#34;6\u0026#34; RUNNER_EXECUTOR: \u0026#34;kubernetes\u0026#34; KUBERNETES_NAMESPACE: \u0026#34;gitlab\u0026#34; # * KUBERNETES_PRIVILEGED: \u0026#34;true\u0026#34; KUBERNETES_CPU_LIMIT: \u0026#34;2\u0026#34; KUBERNETES_MEMORY_LIMIT: \u0026#34;10Gi\u0026#34; KUBERNETES_MEMORY_REQUEST: \u0026#34;8Gi\u0026#34; KUBERNETES_SERVICE_CPU_LIMIT: \u0026#34;1\u0026#34; KUBERNETES_SERVICE_CPU_REQUEST: \u0026#34;1\u0026#34; KUBERNETES_SERVICE_MEMORY_LIMIT: \u0026#34;10Gi\u0026#34; KUBERNETES_SERVICE_MEMORY_REQUEST: \u0026#34;8Gi\u0026#34; KUBERNETES_HELPER_CPU_LIMIT: \u0026#34;1000m\u0026#34; KUBERNETES_HELPER_CPU_REQUEST: \u0026#34;500m\u0026#34; KUBERNETES_HELPER_MEMORY_LIMIT: \u0026#34;3000Mi\u0026#34; KUBERNETES_HELPER_MEMORY_REQUEST: \u0026#34;2000Mi\u0026#34; KUBERNETES_PULL_POLICY: \u0026#34;if-not-present\u0026#34; KUBERNETES_TERMINATIONGRACEPERIODSECONDS: \u0026#34;10\u0026#34; KUBERNETES_POLL_INTERVAL: \u0026#34;5\u0026#34; KUBERNETES_POLL_TIMEOUT: \u0026#34;360\u0026#34; CACHE_TYPE: \u0026#34;s3\u0026#34; CACHE_PATH: \u0026#34;gitlabruner\u0026#34; CACHE_SHARED: \u0026#34;true\u0026#34; CACHE_S3_SERVER_ADDRESS: \u0026#34;10.96.1.175:9000\u0026#34; CACHE_S3_ACCESS_KEY: \u0026#34;minio\u0026#34; CACHE_S3_SECRET_KEY: \u0026#34;minio123\u0026#34; CACHE_S3_BUCKET_NAME: \u0026#34;gitlabrb\u0026#34; CACHE_S3_INSECURE: \u0026#34;true\u0026#34; --- apiVersion: v1 kind: Secret metadata: name: gitlab-ci-token namespace: gitlab labels: app: gitlab-ci-runner data: GITLAB_CI_TOKEN: xxxxaXZjxxxxxxhUV25txxxx # echo xxxxf4SxxxT7fqxHSxxxx | base64 -w0 --- apiVersion: v1 kind: ConfigMap metadata: labels: app: gitlab-ci-runner name: gitlab-ci-runner-scripts namespace: gitlab data: run.sh: | #!/bin/bash unregister() { kill %1 echo \u0026#34;Unregistering runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner unregister -t \u0026#34;$(/usr/bin/gitlab-ci-multi-runner list 2\u0026gt;\u0026amp;1 | tail -n1 | awk \u0026#39;{print $4}\u0026#39; | cut -d\u0026#39;=\u0026#39; -f2)\u0026#34; -n ${RUNNER_NAME} exit $? } trap \u0026#39;unregister\u0026#39; EXIT HUP INT QUIT PIPE TERM echo \u0026#34;Registering runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner register -r ${GITLAB_CI_TOKEN} --tls-ca-file /opt/gitlab-runner/certs/gitlab.crt #/usr/bin/gitlab-ci-multi-runner register -r ${GITLAB_CI_TOKEN} --tls-ca-file /opt/gitlab-runner/certs/gitlab.crt --docker-volumes \u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34; --docker-volumes \u0026#34;/usr/bin/docker:/usr/bin/docker\u0026#34; sed -i \u0026#39;s/^concurrent.*/concurrent = \u0026#39;\u0026#34;${RUNNER_REQUEST_CONCURRENCY}\u0026#34;\u0026#39;/\u0026#39; /home/gitlab-runner/.gitlab-runner/config.toml echo \u0026#34;Starting runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner run -n ${RUNNER_NAME} \u0026amp; wait --- apiVersion: apps/v1 kind: StatefulSet metadata: name: gitlab-ci-runner namespace: gitlab labels: app: gitlab-ci-runner spec: updateStrategy: type: RollingUpdate replicas: 6 serviceName: gitlab-ci-runner selector: matchLabels: app: gitlab-ci-runner template: metadata: labels: app: gitlab-ci-runner spec: volumes: - name: mypvc hostPath: path: /data/gitlab-runner/certs - name: gitlab-ci-runner-scripts projected: sources: - configMap: name: gitlab-ci-runner-scripts items: - key: run.sh path: run.sh mode: 0755 serviceAccountName: gitlab-ci securityContext: runAsNonRoot: true runAsUser: 999 supplementalGroups: [999] containers: - image: xxx/gitlab-runner:latest name: gitlab-ci-runner command: - /scripts/run.sh envFrom: - configMapRef: name: gitlab-ci-runner-cm - secretRef: name: gitlab-ci-token env: - name: RUNNER_NAME valueFrom: fieldRef: fieldPath: metadata.name ports: - containerPort: 9100 name: http-metrics protocol: TCP #securityContext: #runAsUser: 0 #securityContext: {} volumeMounts: - name: gitlab-ci-runner-scripts mountPath: \u0026#34;/scripts\u0026#34; readOnly: true - name: mypvc mountPath: /opt/gitlab-runner/certs #- name: gitlab-runner-pv #mountPath: /opt/cache #- name: docker-sock #mountPath: /var/run/docker.sock #readOnly: true #- name: docker-use #mountPath: /usr/bin/docker #readOnly: true restartPolicy: Always 4. ciä½¿ç”¨ # åœ¨gité¡¹ç›®ä¸­é…ç½®gitlab-ci.yml æäº¤gité¡¹ç›®,è‡ªåŠ¨è§¦å‘ 4.1 gitlab-ciä¸­ç¯å¢ƒå˜é‡è®¾ç½® # é€šè¿‡ç®¡ç†å‘˜è´¦å·è®¾ç½®Variablesåï¼Œciè¿è¡Œæ—¶å¯è·å¾—å¯¹åº”å˜é‡å€¼ 4.2 mavené¡¹ç›®é…ç½®ç¼“å­˜ # ç¼“å­˜ç›®å½•: .m2/* mavenä»“åº“ç¼“å­˜é…ç½®(mavené•œåƒä¸­è®¾ç½®äº†repositoryä¸ºå½“å‰è·¯å¾„ä¸‹çš„.m2/repository): .m2/repository mavenå·¥ç¨‹äº§ç”Ÿçš„ç»“æœzipæ–‡ä»¶ç¼“å­˜é…ç½®: .m2/xxx-server-1.0.0-SNAPSHOT.zip image: nnntln/3.6.1-jdk-8:latest variables: MAVEN_OPTS: -Dmaven.repo.local=/cache/maven.repository cache: key: PortalReportBackend paths: - .m2/repository stages: - build - execute build: stage: build cache: key: PortalReportBackend paths: - .m2 script: /usr/lib/jvm/java-8-openjdk-amd64/bin/javac Hello.java artifacts: paths: - Hello.* execute: stage: execute script: /usr/lib/jvm/java-8-openjdk-amd64/bin/java Hello 4.3 nodeé¡¹ç›®é…ç½®ç¼“å­˜ # cache: key: é¡¹ç›®å paths: - $(pwd)/.yarn-cache - node_modules/ install: image: node:latest stage: Install script: - echo \u0026#39;nameserver 223.5.5.5\u0026#39;\u0026gt;\u0026gt;/etc/resolv.conf - yarn config set registry \u0026#39;https://registry.npm.taobao.org\u0026#39; - yarn config set sass_binary_site \u0026#34;https://npm.taobao.org/mirrors/node-sass/\u0026#34; - yarn config set phantomjs_cdnurl \u0026#34;http://cnpmjs.org/downloads\u0026#34; - yarn config set electron_mirror \u0026#34;https://npm.taobao.org/mirrors/electron/\u0026#34; - yarn config set sqlite3_binary_host_mirror \u0026#34;https://foxgis.oss-cn-shanghai.aliyuncs.com/\u0026#34; - yarn config set profiler_binary_host_mirror \u0026#34;https://npm.taobao.org/mirrors/node-inspector/\u0026#34; - yarn config set chromedriver_cdnurl \u0026#34;https://cdn.npm.taobao.org/dist/chromedriver\u0026#34; - yarn config set cache-folder $(pwd)/.yarn-cache ","date":"2024-09-09","externalUrl":null,"permalink":"/devops/20240909-2/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"\u003ch1 class=\"relative group\"\u003e1. å‰è¨€ \n    \u003cdiv id=\"1-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%89%8D%E8%A8%80\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå‚è€ƒï¼š\u003ca href=\"https://blog.csdn.net/github_35631540/category_10804590.html\" target=\"_blank\"\u003egitlab-runnerå­¦ä¹ èµ„æ–™å¤§å…¨\u003c/a\u003e\u003c/p\u003e","title":"Devopsä¹‹gitlab-ciéƒ¨ç½²","type":"blog"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/docker/","section":"Tags","summary":"","title":"Docker","type":"tags"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/gitlab-runner/","section":"Tags","summary":"","title":"Gitlab-Runner","type":"tags"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/kaniko/","section":"Tags","summary":"","title":"Kaniko","type":"tags"},{"content":" 1. kanikoä»‹ç» # kaniko æ˜¯ä¸€ç§å·¥å…·ï¼Œç”¨äºåœ¨å®¹å™¨æˆ– Kubernetes é›†ç¾¤å†…ä» Dockerfile æ„å»ºå®¹å™¨é•œåƒã€‚ ä¸dockerä¸åŒï¼ŒKaniko å¹¶ä¸ä¾èµ–äºDocker daemonè¿›ç¨‹ï¼Œå®Œå…¨æ˜¯åœ¨ç”¨æˆ·ç©ºé—´æ ¹æ®Dockerfileçš„å†…å®¹é€è¡Œæ‰§è¡Œå‘½ä»¤æ¥æ„å»ºé•œåƒï¼Œè¿™å°±ä½¿å¾—åœ¨ä¸€äº›æ— æ³•è·å– docker daemon è¿›ç¨‹çš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½å¤Ÿæ„å»ºé•œåƒï¼Œæ¯”å¦‚åœ¨æ ‡å‡†çš„Kubernetes Clusterä¸Šã€‚ Kaniko ä»¥å®¹å™¨é•œåƒçš„æ–¹å¼æ¥è¿è¡Œçš„ï¼ŒåŒæ—¶éœ€è¦ä¸‰ä¸ªå‚æ•°: Dockerfileï¼Œä¸Šä¸‹æ–‡ï¼Œä»¥åŠè¿œç«¯é•œåƒä»“åº“çš„åœ°å€ã€‚ Kanikoä¼šå…ˆæå–åŸºç¡€é•œåƒ(Dockerfile FROM ä¹‹åçš„é•œåƒ)çš„æ–‡ä»¶ç³»ç»Ÿ ç„¶åæ ¹æ®Dockerfileä¸­æ‰€æè¿°çš„ï¼Œä¸€æ¡æ¡æ‰§è¡Œå‘½ä»¤ï¼Œæ¯ä¸€æ¡å‘½ä»¤æ‰§è¡Œå®Œä»¥åä¼šåœ¨ç”¨æˆ·ç©ºé—´ä¸‹é¢åˆ›å»ºä¸€ä¸ªsnapshotï¼Œå¹¶ä¸å­˜å‚¨ä¸å†…å­˜ä¸­çš„ä¸Šä¸€ä¸ªçŠ¶æ€è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œå°±å°†æ–°çš„ä¿®æ”¹ç”Ÿæˆä¸€ä¸ªé•œåƒå±‚æ·»åŠ åœ¨åŸºç¡€é•œåƒä¸Šï¼Œå¹¶ä¸”å°†ç›¸å…³çš„ä¿®æ”¹ä¿¡æ¯å†™å…¥é•œåƒå…ƒæ•°æ®ä¸­ ç­‰æ‰€æœ‰å‘½ä»¤æ‰§è¡Œå®Œï¼Œkanikoä¼šå°†æœ€ç»ˆé•œåƒæ¨é€åˆ°æŒ‡å®šçš„è¿œç«¯é•œåƒä»“åº“ã€‚ 2. kanikoé•œåƒæ„å»º # æ ¹æ®è‡ªå®šä¹‰çš„harborä»“åº“ç»™kanikoé•œåƒé…ç½®æƒé™\næ„å»ºå‘½ä»¤ docker build -t harbor.xxx.cn/tools/executor:v1.23.2-debug . config.json é€šè¿‡echo -n admin:xxx |base64ç”Ÿæˆä¸€ä¸ªbase64çš„å¯†é’¥ï¼Œä¾‹å¦‚xxtaW46SGFyYm9yxxx harborç§åº“åœ°å€ï¼šharbor.xxx.cn {\u0026#34;auths\u0026#34;:{\u0026#34;harbor.xxx.cn\u0026#34;:{\u0026#34;auth\u0026#34;:\u0026#34;xxtaW46SGFyYm9yxxx\u0026#34;}}} Dockerfile harborç§åº“åœ°å€ï¼šharbor.xxx.cn FROM gcr.io/kaniko-project/executor:v1.23.2-debug ENV HARBOR_REGISTRY=harbor.xxx.cn COPY config.json /kaniko/.docker/config.json 3. åœ¨gitlab-ciä¸­ä½¿ç”¨kanikoæ„å»ºé•œåƒ # .gitlab-ci.yml Dockerfileæ–‡ä»¶éœ€ä¸.gitlab-ci.ymlæ”¾åœ¨åŒä¸€çº§ç›®å½•æˆ–æŒ‡å®šç›®å½•ä¹Ÿå¯ \u0026ndash;dockerfileï¼šæŒ‡å®š Docker file æ–‡ä»¶è·¯å¾„ \u0026ndash;insecureï¼šæŒ‡å®šæ—  HTTPS çš„ Harbor ä»“åº“åœ°å€ \u0026ndash;skip-tls-verify: å¦‚æœharborç§åº“æ²¡æœ‰é…ç½®httpsï¼Œåˆ™ä½¿ç”¨æ­¤é…ç½®è·³è¿‡éªŒè¯ \u0026ndash;destinationï¼šè®¾ç½®æ‰“è¿‡ Harbor ä»“åº“æ ‡ç­¾çš„é•œåƒåç§°åŠç‰ˆæœ¬å· cache: key: ${CI_PROJECT_NAME} paths: - .venv/ stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} cache: key: ${CI_PROJECT_NAME} paths: - .venv/ script: | ls -la ./ cp -r /builds/xxxx/${CI_PROJECT_NAME}/* /workspace cp -r .venv /workspace if [ \u0026#34;${CI_COMMIT_REF_NAME}\u0026#34; == \u0026#34;master\u0026#34; ]; then /kaniko/executor --build-arg CI_PROJECT_NAME=${CI_PROJECT_NAME} --dockerfile Dockerfile --skip-tls-verify --destination ${HARBOR_REGISTRY}/xxxx/${CI_PROJECT_NAME}:$VERSION_VAR else /kaniko/executor --build-arg CI_PROJECT_NAME=${CI_PROJECT_NAME} --dockerfile Dockerfile --skip-tls-verify --destination ${HARBOR_REGISTRY}/xxxx/${CI_PROJECT_NAME}:$VERSION_VAR fi 4. æŠ¥é”™è§£å†³ # 4.1 Error: kaniko should only be run inside of a container # è¿™æ˜¯å› ä¸ºDocker Engine 20.10 å¼•å…¥äº†ä¸€ä¸ªå·²çŸ¥çš„ä¸å…¼å®¹é—®é¢˜ï¼Œå½“ä¸»æœºä½¿ç”¨ Docker Engine 20.10 æˆ–æ›´é«˜ç‰ˆæœ¬æ—¶ï¼Œä½äº v1.9.0 çš„ç‰ˆæœ¬ä¸­çš„ gcr.io/kaniko-project/executor:debug é•œåƒæ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚ å½“å°è¯•æ„å»ºæ˜ åƒæ—¶ï¼ŒKanikoä¼šå¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºï¼š\nkaniko should only be run inside of a container, run with the --force flag if you are sure you want to continue è§£å†³æ–¹æ¡ˆ è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·å°† gcr.io/kaniko-project/executor:debug å®¹å™¨æ›´æ–°åˆ°è‡³å°‘ v1.9.0 çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ gcr.io/kaniko-project/executor:v1.23.2-debug è€Œåè¿‡æ¥ï¼Œï¼ˆç‰ˆæœ¬ 19.06.x æˆ–æ›´æ—©ç‰ˆæœ¬ä¸­ä¸»æœºä¸Šçš„ gcr.io/kaniko-project/executor:v1.23.2-debug æ˜ åƒå’Œ Docker å¼•æ“ï¼‰å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä¸ºäº†è·å¾—æœ€ä½³ç­–ç•¥ï¼Œæ‚¨åº”è¯¥ç»å¸¸æµ‹è¯•ä½œä¸šç¯å¢ƒç‰ˆæœ¬å¹¶å°†å…¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚è¿™å¸¦æ¥äº†æ–°åŠŸèƒ½ã€æ›´é«˜çš„å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯¹äºè¿™ç§ç‰¹å®šæƒ…å†µï¼Œä½¿è¿è¡Œå™¨ä¸»æœºä¸Šåº•å±‚ Docker Engine çš„å‡çº§å¯¹ä½œä¸šé€æ˜ã€‚\n","date":"2024-09-09","externalUrl":null,"permalink":"/devops/20240909-1/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"\u003ch1 class=\"relative group\"\u003e1. kanikoä»‹ç» \n    \u003cdiv id=\"1-kaniko%E4%BB%8B%E7%BB%8D\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-kaniko%E4%BB%8B%E7%BB%8D\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/GoogleContainerTools/kaniko\" target=\"_blank\"\u003ekaniko\u003c/a\u003e æ˜¯ä¸€ç§å·¥å…·ï¼Œç”¨äºåœ¨å®¹å™¨æˆ– Kubernetes é›†ç¾¤å†…ä» Dockerfile æ„å»ºå®¹å™¨é•œåƒã€‚\u003c/li\u003e\n\u003cli\u003eä¸dockerä¸åŒï¼ŒKaniko å¹¶ä¸ä¾èµ–äºDocker daemonè¿›ç¨‹ï¼Œå®Œå…¨æ˜¯åœ¨ç”¨æˆ·ç©ºé—´æ ¹æ®Dockerfileçš„å†…å®¹é€è¡Œæ‰§è¡Œå‘½ä»¤æ¥æ„å»ºé•œåƒï¼Œè¿™å°±ä½¿å¾—åœ¨ä¸€äº›æ— æ³•è·å– docker daemon è¿›ç¨‹çš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½å¤Ÿæ„å»ºé•œåƒï¼Œæ¯”å¦‚åœ¨æ ‡å‡†çš„Kubernetes Clusterä¸Šã€‚\u003c/li\u003e\n\u003cli\u003eKaniko ä»¥å®¹å™¨é•œåƒçš„æ–¹å¼æ¥è¿è¡Œçš„ï¼ŒåŒæ—¶éœ€è¦ä¸‰ä¸ªå‚æ•°: Dockerfileï¼Œä¸Šä¸‹æ–‡ï¼Œä»¥åŠè¿œç«¯é•œåƒä»“åº“çš„åœ°å€ã€‚\n\u003cul\u003e\n\u003cli\u003eKanikoä¼šå…ˆæå–åŸºç¡€é•œåƒ(Dockerfile FROM ä¹‹åçš„é•œåƒ)çš„æ–‡ä»¶ç³»ç»Ÿ\u003c/li\u003e\n\u003cli\u003eç„¶åæ ¹æ®Dockerfileä¸­æ‰€æè¿°çš„ï¼Œä¸€æ¡æ¡æ‰§è¡Œå‘½ä»¤ï¼Œæ¯ä¸€æ¡å‘½ä»¤æ‰§è¡Œå®Œä»¥åä¼šåœ¨ç”¨æˆ·ç©ºé—´ä¸‹é¢åˆ›å»ºä¸€ä¸ªsnapshotï¼Œå¹¶ä¸å­˜å‚¨ä¸å†…å­˜ä¸­çš„ä¸Šä¸€ä¸ªçŠ¶æ€è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œå°±å°†æ–°çš„ä¿®æ”¹ç”Ÿæˆä¸€ä¸ªé•œåƒå±‚æ·»åŠ åœ¨åŸºç¡€é•œåƒä¸Šï¼Œå¹¶ä¸”å°†ç›¸å…³çš„ä¿®æ”¹ä¿¡æ¯å†™å…¥é•œåƒå…ƒæ•°æ®ä¸­\u003c/li\u003e\n\u003cli\u003eç­‰æ‰€æœ‰å‘½ä»¤æ‰§è¡Œå®Œï¼Œkanikoä¼šå°†æœ€ç»ˆé•œåƒæ¨é€åˆ°æŒ‡å®šçš„è¿œç«¯é•œåƒä»“åº“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e2. kanikoé•œåƒæ„å»º \n    \u003cdiv id=\"2-kaniko%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#2-kaniko%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003eæ ¹æ®è‡ªå®šä¹‰çš„harborä»“åº“ç»™kanikoé•œåƒé…ç½®æƒé™\u003c/p\u003e","title":"é€šè¿‡kanikoåœ¨å®¹å™¨ä¸­æ„å»ºé•œåƒ","type":"blog"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/fnos/","section":"Tags","summary":"","title":"Fnos","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/kubernetes/","section":"Kubernetes","summary":"","title":"Kubernetes","type":"kubernetes"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/mount/","section":"Tags","summary":"","title":"Mount","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/nas/","section":"Tags","summary":"","title":"Nas","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/path/","section":"Tags","summary":"","title":"Path","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tools/","section":"å·¥å…·åˆé›†","summary":"","title":"å·¥å…·åˆé›†","type":"tools"},{"content":" 1. æ‰¹é‡åˆ é™¤å¸è½½dockeré—ç•™çš„å¤§é‡æŒ‚è½½è·¯å¾„ # å¯è‡ªå®šä¹‰è·¯å¾„ï¼š /var/lib/bak-docker/overlay2 /var/lib/bak-docker/containers #!/bin/bash # æ‰§è¡Œ df -h å‘½ä»¤å¹¶å°†è¾“å‡ºå­˜å‚¨åˆ°å˜é‡ä¸­ disk_output=$(df -h) # å®šä¹‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ç›®æ ‡è·¯å¾„ regex_overlay=\u0026#34;/var/lib/bak-docker/overlay2/[a-fA-F0-9]{64}/merged\u0026#34; regex_containers=\u0026#34;/var/lib/bak-docker/containers/[a-zA-Z0-9.-]+\u0026#34; # ä½¿ç”¨grepåŒ¹é…åŒ…å«ç‰¹å®šè·¯å¾„çš„è¡Œï¼Œå¹¶æå–è·¯å¾„ while read -r line; do if [[ $line =~ $regex_overlay || $line =~ $regex_containers ]]; then # æå–è·¯å¾„ path=$(echo $line | awk \u0026#39;{print $6}\u0026#39;) echo \u0026#34;Found path: $path\u0026#34; # æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¸è½½ if [ -d \u0026#34;$path\u0026#34; ]; then if ! mountpoint -q \u0026#34;$path\u0026#34;; then echo \u0026#34;Path $path is not mounted.\u0026#34; else umount \u0026#34;$path\u0026#34; echo \u0026#34;Unmounted $path\u0026#34; fi else echo \u0026#34;Path $path does not exist.\u0026#34; fi fi done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$disk_output\u0026#34; ","date":"2024-09-08","externalUrl":null,"permalink":"/kubernetes/20240908-1/","section":"Kubernetes","summary":"\u003ch1 class=\"relative group\"\u003e1. æ‰¹é‡åˆ é™¤å¸è½½dockeré—ç•™çš„å¤§é‡æŒ‚è½½è·¯å¾„ \n    \u003cdiv id=\"1-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%8D%B8%E8%BD%BDdocker%E9%81%97%E7%95%99%E7%9A%84%E5%A4%A7%E9%87%8F%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%8D%B8%E8%BD%BDdocker%E9%81%97%E7%95%99%E7%9A%84%E5%A4%A7%E9%87%8F%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eå¯è‡ªå®šä¹‰è·¯å¾„ï¼š\n\u003cul\u003e\n\u003cli\u003e/var/lib/bak-docker/overlay2\u003c/li\u003e\n\u003cli\u003e/var/lib/bak-docker/containers\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ‰§è¡Œ df -h å‘½ä»¤å¹¶å°†è¾“å‡ºå­˜å‚¨åˆ°å˜é‡ä¸­\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edisk_output\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edf -h\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å®šä¹‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ç›®æ ‡è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eregex_overlay\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/var/lib/bak-docker/overlay2/[a-fA-F0-9]{64}/merged\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eregex_containers\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/var/lib/bak-docker/containers/[a-zA-Z0-9.-]+\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä½¿ç”¨grepåŒ¹é…åŒ…å«ç‰¹å®šè·¯å¾„çš„è¡Œï¼Œå¹¶æå–è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"nb\"\u003eread\u003c/span\u003e -r line\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e~ \u003cspan class=\"nv\"\u003e$regex_overlay\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e~ \u003cspan class=\"nv\"\u003e$regex_containers\u003c/span\u003e \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# æå–è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print $6}\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Found path: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¸è½½\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -d \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e ! mountpoint -q \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Path \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e is not mounted.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                umount \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Unmounted \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Path \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e does not exist.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$disk_output\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"æ‰¹é‡åˆ é™¤å¸è½½dockeré—ç•™çš„å¤§é‡æŒ‚è½½è·¯å¾„","type":"blog"},{"content":" 0. å‰è¨€ # é£ç‰›äº‘æ¨å‡ºçš„é£ç‰›äº‘nasæ“ä½œç³»ç»Ÿï¼ŒFnOSåŸºäºæœ€æ–° Linux å†…æ ¸ï¼ˆDebian å‘è¡Œç‰ˆï¼‰æ·±åº¦å¼€å‘ï¼Œå…¼å®¹ä¸»æµ x86 ç¡¬ä»¶ï¼Œè‡ªç”±ç»„è£… NASï¼Œçµæ´»æ‰©å±•å¤–éƒ¨å­˜å‚¨ é£ç‰›äº‘å®˜ç½‘\n1. å®‰è£…æ­¥éª¤ # æœ¬æ–‡é€šè¿‡vmwareè™šæ‹Ÿæœºè¿›è¡ŒFnOSçš„å®‰è£…æ“ä½œï¼Œä¸»æ‰“ä½“éªŒ\n1.1 åˆ›å»ºè™šæ‹Ÿæœº # ç‚¹å‡»vmwareä¸»é¡µåˆ›å»ºæ–°çš„è™šæ‹Ÿæœº é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ é€‰æ‹©Linuxæ“ä½œç³»ç»Ÿ é€‰æ‹©Debian 9.xï¼ˆFnOSåŸºäºæ­¤å¼€å‘ï¼‰ é€‰æ‹©è™šæ‹Ÿæœºæ‰€åœ¨ç›®å½• ç»™è™šæ‹Ÿæœºåˆ†é…å­˜å‚¨ç©ºé—´ ç»™è™šæ‹Ÿæœºåˆ†é…å†…å­˜ã€cpuç­‰èµ„æº è®¾ç½®åˆé€‚çš„å†…å­˜ã€cpuå¤§å° ç»™è™šæ‹Ÿæœºé€‰æ‹©æ“ä½œç³»ç»Ÿé•œåƒ é€‰æ‹©æå‰ä¸‹è½½å¥½çš„trim.isoé•œåƒæ–‡ä»¶ ç‚¹å‡»å¼€å¯æ­¤è™šæ‹Ÿæœºï¼Œè¿›è¡Œè™šæ‹Ÿæœºçš„å®‰è£…æ“ä½œ é€‰æ‹©åˆ†é…å¥½çš„è™šæ‹Ÿç¡¬ç›˜ è®¾ç½®ç³»ç»Ÿåˆ†åŒºå¤§å°ï¼Œæ ¹æ®ç¡¬ç›˜å¯Œè£•ç¨‹åº¦åˆ†é… æ ¼å¼åŒ–è¯¥è™šæ‹Ÿç¡¬ç›˜ ç­‰å¾…å®‰è£… å®‰è£…å®Œæˆ ç­‰å¾…å‡ ç§’è‡ªåŠ¨è¿›å…¥ç³»ç»Ÿ å¼¹å‡ºç³»ç»Ÿç»ˆç«¯ç•Œé¢ï¼Œå®‰è£…æˆåŠŸ ç„¶åå¯ä»¥å°†vmwareè™šæ‹Ÿæœºæœ€å°åŒ–äº†ï¼Œæ¥ä¸‹æ¥æ“ä½œéƒ½å°†åœ¨æµè§ˆå™¨å®Œæˆ æ ¹æ®ç»ˆç«¯ç»™å‡ºç»™å‡ºçš„Web UIåœ°å€ï¼ˆé»˜è®¤ç«¯å£æ˜¯8000ï¼‰å»æµè§ˆå™¨è®¿é—® 2. ä½¿ç”¨æ­¥éª¤ # 2.1 ç¬¬ä¸€æ¬¡ç™»é™† # æµè§ˆå™¨è¾“å…¥ç¬¬ä¸€æ­¥å®‰è£…å®Œæˆåç»™å‡ºçš„WebUIåœ°å€ ç¬¬ä¸€æ¬¡ç™»é™†ï¼Œè®¾ç½®ç”¨æˆ·å/å¯†ç  æ­¤æ­¥éª¤è®¾ç½®çš„ç”¨æˆ·åå¯†ç å³ä¸ºFnOSåº•å±‚debianç³»ç»Ÿçš„ç®¡ç†å‘˜ç”¨æˆ·ä¸å¯†ç  2.2 ç¬¬äºŒæ¬¡ç™»é™† # æµè§ˆå™¨è¾“å…¥ç¬¬ä¸€æ­¥å®‰è£…å®Œæˆåç»™å‡ºçš„WebUIåœ°å€ è¾“å…¥è®¾ç½®å¥½çš„ç”¨æˆ·å/å¯†ç  2.3 äº«å—å›½äº§Naså§ # ","date":"2024-09-08","externalUrl":null,"permalink":"/tools/20240908-1/","section":"å·¥å…·åˆé›†","summary":"\u003ch1 class=\"relative group\"\u003e0. å‰è¨€ \n    \u003cdiv id=\"0-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#0-%E5%89%8D%E8%A8%80\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003eé£ç‰›äº‘æ¨å‡ºçš„é£ç‰›äº‘nasæ“ä½œç³»ç»Ÿï¼ŒFnOSåŸºäºæœ€æ–° Linux å†…æ ¸ï¼ˆDebian å‘è¡Œç‰ˆï¼‰æ·±åº¦å¼€å‘ï¼Œå…¼å®¹ä¸»æµ x86 ç¡¬ä»¶ï¼Œè‡ªç”±ç»„è£… NASï¼Œçµæ´»æ‰©å±•å¤–éƒ¨å­˜å‚¨\n\u003ca href=\"https://www.fnnas.com/download?key=fnos\" target=\"_blank\"\u003eé£ç‰›äº‘å®˜ç½‘\u003c/a\u003e\u003c/p\u003e","title":"é€šè¿‡vmwareè™šæ‹Ÿæœºå®‰è£…å›½äº§nasç³»ç»ŸFnOS","type":"blog"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/frp/","section":"Tags","summary":"","title":"Frp","type":"tags"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/net/","section":"Tags","summary":"","title":"Net","type":"tags"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/proxy/","section":"Tags","summary":"","title":"Proxy","type":"tags"},{"content":" 0. å‰è¨€ # æœ¬æ–‡ä¸»è¦ç”¨äºé€šè¿‡ä¸€å°å…·æœ‰å…¬ç½‘ipåœ°å€çš„æœåŠ¡å™¨æ¥ä»£ç†å¯è®¿é—®å…¬ç½‘çš„naså†…éƒ¨çš„å±€åŸŸç½‘æœåŠ¡ï¼Œéœ€æ³¨æ„çš„æ˜¯æœ¬æ–¹æ¡ˆå­˜åœ¨ä¸€å®šçš„è¢«é»‘å®¢æ”»å‡»é£é™©ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚\n1. frpsé…ç½®åŠéƒ¨ç½²ï¼ˆæœåŠ¡ç«¯ï¼‰ # éƒ¨ç½²åœ¨å…·æœ‰å…¬ç½‘ipåœ°å€çš„æœåŠ¡å™¨ä¸Š\nè¿è¡Œå‘½ä»¤ docker-compose -f docker-compose.yaml up -d docker-compose.yaml version: \u0026#39;3\u0026#39; services: frp: container_name: frps image: snowdreamtech/frps:0.60 network_mode: \u0026#34;host\u0026#34; environment: - TZ=Asia/Shanghai volumes: - \u0026#34;/data/software/frps/frps.toml:/etc/frp/frps.toml\u0026#34; restart: always é…ç½®ï¼šfrps.toml [common] bindAddr = 0.0.0.0 bind_port = 5xxx # å¯ç”¨é¢æ¿ dashboard_port = 5x1x # é¢æ¿ç™»å½•åå’Œå¯†ç  dashboard_user = xxx dashboard_pwd = xxxx # ä½¿ç”¨httpä»£ç†å¹¶ä½¿ç”¨5x2xç«¯å£è¿›è¡Œç©¿é€ vhost_http_port = 5x2x # ä½¿ç”¨httpsä»£ç†å¹¶ä½¿ç”¨5x3xç«¯å£è¿›è¡Œç©¿é€ vhost_https_port = 5x3x # æ—¥å¿—è·¯å¾„ log_file = ./frps.log # æ—¥å¿—çº§åˆ« log_level = info # æ—¥å¿—æœ€å¤§ä¿å­˜å¤©æ•° log_max_days = 2 # è®¤è¯è¶…æ—¶æ—¶é—´ authentication_timeout = 900 # è®¤è¯tokenï¼Œå®¢æˆ·ç«¯éœ€è¦å’Œæ­¤å¯¹åº” token=123456 # æœ€å¤§è¿æ¥æ•° max_pool_count = 50 max_ports_per_client = 0 2. frpcé…ç½®åŠéƒ¨ç½²ï¼ˆå®¢æˆ·ç«¯ï¼‰ # éƒ¨ç½²åœ¨å¯è®¿é—®å…¬ç½‘çš„nasä¸Š\nè¿è¡Œå‘½ä»¤ docker-compose -f docker-compose.yaml up -d docker-compose.yaml version: \u0026#39;3\u0026#39; services: frp: container_name: frpc image: snowdreamtech/frpc:0.60 network_mode: \u0026#34;host\u0026#34; environment: - TZ=Asia/Shanghai volumes: - \u0026#34;/vol1/1000/frpc/frpc.toml:/etc/frp/frpc.toml\u0026#34; restart: always é…ç½®ï¼šfrpc.toml tokenã€server_addrã€server_portï¼šå¯¹åº”frpsçš„é…ç½®æ¥å¡«å†™ custom_domainsã€customDomainsï¼šå¦‚æœæ²¡æœ‰åŸŸåï¼Œåˆ™å¡«å†™frpsæœåŠ¡å™¨çš„ipåœ°å€ remote_portï¼šè®¾å®šfrpsæœåŠ¡å™¨ä»£ç†çš„ç«¯å£ [common] server_addr = xx.xx.xx.xx server_port = 5xxx token = \u0026#34;123456\u0026#34; log.to = \u0026#34;./frpc.log\u0026#34; log.level = info log.maxDays = 3 log.disablePrintColor = false [[proxies]] name = xxxx type = http local_ip = 0.0.0.0 local_port = xxxx custom_domains = frps.ip customDomains = xx.xx.xx remote_port = 5x2x ","date":"2024-09-07","externalUrl":null,"permalink":"/tools/20240907-1/","section":"å·¥å…·åˆé›†","summary":"\u003ch1 class=\"relative group\"\u003e0. å‰è¨€ \n    \u003cdiv id=\"0-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#0-%E5%89%8D%E8%A8%80\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003eæœ¬æ–‡ä¸»è¦ç”¨äºé€šè¿‡ä¸€å°å…·æœ‰å…¬ç½‘ipåœ°å€çš„æœåŠ¡å™¨æ¥ä»£ç†å¯è®¿é—®å…¬ç½‘çš„naså†…éƒ¨çš„å±€åŸŸç½‘æœåŠ¡ï¼Œéœ€æ³¨æ„çš„æ˜¯æœ¬æ–¹æ¡ˆå­˜åœ¨ä¸€å®šçš„è¢«é»‘å®¢æ”»å‡»é£é™©ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚\u003c/p\u003e","title":"å†…ç½‘ç©¿é€å·¥å…·FRPä½¿ç”¨","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/ai/","section":"Tags","summary":"","title":"Ai","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/backup/","section":"Tags","summary":"","title":"Backup","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/cloud/","section":"Tags","summary":"","title":"Cloud","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/harbor/","section":"Tags","summary":"","title":"Harbor","type":"tags"},{"content":" 1. å¾…è¿ç§»Harborä»“åº“é…ç½® # 1.1 é€šè¿‡ä»“åº“ç®¡ç†æ·»åŠ æ–°Harborä»“åº“å…³è” # æ–°å»ºç›®æ ‡ æ·»åŠ å¯¹åº”Harborä»“åº“ä¿¡æ¯ æ·»åŠ å…·æœ‰åˆ›å»ºç©ºé—´æƒé™çš„ç”¨æˆ·åã€å¯†ç  æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ ä¿å­˜ 1.2 é€šè¿‡å¤åˆ¶ç®¡ç†æ·»åŠ å¾…å¤åˆ¶ç©ºé—´çš„è§„åˆ™ # æ–°å»ºè§„åˆ™ é€‰æ‹©å¤åˆ¶æ¨¡å¼ é…ç½®èµ„æºè¿‡æ»¤å™¨æ¡ä»¶ï¼šä¸å¡«ï¼Œåˆ™é»˜è®¤å¤åˆ¶å…¨éƒ¨é•œåƒï¼Œå¯å®šä¹‰å•ä¸ªå‘½åç©ºé—´: xxx/** é€‰æ‹©ç›®æ ‡ä»“åº“ï¼ˆ1.1ä¸­å¢åŠ çš„ä»“åº“ï¼‰ é€‰æ‹©è§¦å‘æ¨¡å¼ï¼ˆé»˜è®¤æ‰‹åŠ¨ï¼‰ 2. å¼€å§‹è¿ç§» # é€‰ä¸­å¤åˆ¶ç®¡ç†é‡Œæ–°å»ºçš„è§„åˆ™ï¼Œç‚¹å‡»å¤åˆ¶æŒ‰é’®å¼€å§‹å¤åˆ¶ æŸ¥çœ‹è¿›åº¦ ","date":"2024-09-02","externalUrl":null,"permalink":"/cloudnative/20240902-1/","section":"äº‘åŸç”Ÿ","summary":"\u003ch5 id=\"typeit-44468b13ec0e2d9a786f3228a14e74ca\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-44468b13ec0e2d9a786f3228a14e74ca\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e1. å¾…è¿ç§»Harborä»“åº“é…ç½® \n    \u003cdiv id=\"1-%E5%BE%85%E8%BF%81%E7%A7%BBharbor%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%BE%85%E8%BF%81%E7%A7%BBharbor%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 é€šè¿‡ä»“åº“ç®¡ç†æ·»åŠ æ–°Harborä»“åº“å…³è” \n    \u003cdiv id=\"11-%E9%80%9A%E8%BF%87%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E6%B7%BB%E5%8A%A0%E6%96%B0harbor%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E9%80%9A%E8%BF%87%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E6%B7%BB%E5%8A%A0%E6%96%B0harbor%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cp\u003e\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./1.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/p\u003e","title":"Harboré•œåƒä»“åº“è¿ç§»","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/image/","section":"Tags","summary":"","title":"Image","type":"tags"},{"content":" æ³¨æ„ # éœ€è¦æ³¨æ„çš„æ˜¯kserveä½¿ç”¨çš„æ¨¡å‹ä¸‹è½½é“¾æ¥storageUri: \u0026quot;http://172.16.2.132:9999/00000123.tar\u0026quot;å¯¹åº”çš„æ¨¡å‹å‹ç¼©åŒ…ï¼šåº”è¯¥æ˜¯è§£å‹åæ¨¡å‹åŠé…ç½®æ–‡ä»¶å¹³é“ºå¼€æ¥çš„ï¼Œè€Œä¸æ˜¯è§£å‹åè¿˜æœ‰ä¸€å±‚ç›®å½•åŒ…è£¹çš„ åŒæ—¶å¯¹äºstorageUri: \u0026quot;http://172.16.2.132:9999/00000123\u0026quot;çš„æ¨¡å‹é“¾æ¥ï¼Œ00000123é‡Œé¢çš„å†…å®¹åº”è¯¥ç›´æ¥æ˜¯æ¨¡å‹åŠé…ç½®æ–‡ä»¶ï¼Œè€Œä¸åº”è¯¥å†æœ‰æ·±å±‚æ¬¡çš„ç›®å½• 1. kserve-0.10.0ç‰ˆæœ¬å®‰è£… # 1.1 kserveä¸ä¾èµ–ç‰ˆæœ¬å¯¹åº” # K8s v1.22.15 KServe v0.10.0 Cert-manager v1.11.0 Ingress-nginxï¼ˆä¸k8sç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼‰ v1.3.0 1.2 éƒ¨ç½²ingress-nginx # é‡‡ç”¨RawDeploymentæ¨¡å¼ï¼Œå› æ­¤ä¸éœ€è¦æŒ‰ç…§å®˜ç½‘è¦æ±‚å®‰è£…Istioï¼ˆIstioè¾ƒé‡ï¼‰\né€šè¿‡ç®¡ç†Ingressï¼Œæ§åˆ¶è·¯ç”±ï¼Œå› æ­¤éƒ¨ç½² Ingress-Nginx å³å¯ã€‚ kubectl apply -f nginx-ingress-1.3.1.yml 1.3 éƒ¨ç½²CertManager # kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.yaml 1.4 éƒ¨ç½²Kserve # éœ€ä¿®æ”¹kserve.yamlä¸­ingressClassNameä¸ºåˆ›å»ºçš„IngressClassï¼ˆæœ¬ä¾‹ä¸ºnginxï¼‰ ingress: |- { \u0026#34;ingressClassName\u0026#34; : \u0026#34;nginx\u0026#34;, } # ä¸‹è½½ wget https://github.com/kserve/kserve/releases/download/v0.10.0/kserve.yaml # ä¿®æ”¹ä»¥åéƒ¨ç½² kubectl apply -f kserve.yaml # ä¸‹è½½ wget https://github.com/kserve/kserve/releases/download/v0.10.0/kserve-runtimes.yaml kubectl apply -f kserve-runtimes.yaml ä¿®æ”¹inferenceservice-configéƒ¨ç½²æ¨¡å¼ä¸ºRawDeployment kubectl patch configmap/inferenceservice-config -n kserve --type=strategic -p \u0026#39;{\u0026#34;data\u0026#34;: {\u0026#34;deploy\u0026#34;: \u0026#34;{\\\u0026#34;defaultDeploymentMode\\\u0026#34;: \\\u0026#34;RawDeployment\\\u0026#34;}\u0026#34;}}\u0026#39; 1.5 æµ‹è¯• # 1.5.1 é…ç½®æ¨¡å‹crd # demo-tensorflow.yaml nameï¼štensorflow-kserve storageUriï¼šhttp://172.16.2.132:9999/00000123.tarï¼ˆé‡‡ç”¨æ–‡ä»¶æœåŠ¡å™¨å½¢å¼æä¾›æ¨¡å‹æ–‡ä»¶taråŒ…æˆ–zipåŒ…ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨è§£å‹ï¼‰ æ¨¡å‹ä¸‹è½½é“¾æ¥ï¼Œtags2 4 apiVersion: \u0026#34;serving.kserve.io/v1beta1\u0026#34; kind: \u0026#34;InferenceService\u0026#34; metadata: name: \u0026#34;tensorflow-kserve\u0026#34; spec: predictor: tensorflow: storageUri: \u0026#34;http://172.16.2.132:9999/00000123.tar\u0026#34; 1.5.2 ä½¿ç”¨ingressæµ‹è¯• # INGRESS_HOSTï¼š10.96.1.200ï¼ˆIngress-nginxåœ°å€ï¼‰ MODEL_NAMEï¼š1.5.1å®šä¹‰çš„name INPUT_PATHï¼šæ¨¡å‹å…¥å‚ #!/bin/bash # nginx ingress çš„è®¿é—®åœ°å€ INGRESS_HOST=10.96.1.200 INGRESS_PORT=80 MODEL_NAME=tensorflow-kserve INPUT_PATH=@./input.json SERVICE_HOSTNAME=$(kubectl get inferenceservice ${MODEL_NAME} -o jsonpath=\u0026#39;{.status.url}\u0026#39; | cut -d \u0026#34;/\u0026#34; -f 3) curl -H \u0026#34;Host: ${SERVICE_HOSTNAME}\u0026#34; http://${INGRESS_HOST}:${INGRESS_PORT}/v1/models/$MODEL_NAME:predict -d $INPUT_PATH input.json { \u0026#34;instances\u0026#34;:[1,2,3] } ç»“æœå¦‚ä¸‹ 2. kserve-0.13.0ç‰ˆæœ¬å®‰è£… # 2.1 kserveä¸ä¾èµ–ç‰ˆæœ¬å¯¹åº” # K8s v1.29.7 KServe v0.13.0 Cert-manager v1.15.3 Ingress-nginxï¼ˆä¸k8sç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼‰ v1.11.2 2.2 éƒ¨ç½²ingress-nginx # é‡‡ç”¨RawDeploymentæ¨¡å¼ï¼Œå› æ­¤ä¸éœ€è¦æŒ‰ç…§å®˜ç½‘è¦æ±‚å®‰è£…Istioï¼ˆIstioè¾ƒé‡ï¼‰\né€šè¿‡ç®¡ç†Ingressï¼Œæ§åˆ¶è·¯ç”±ï¼Œå› æ­¤éƒ¨ç½² Ingress-Nginx å³å¯ã€‚ æœ¬ç‰ˆæœ¬ingress-nginxé‡‡ç”¨helmå®‰è£… wget https://github.com/kubernetes/ingress-nginx/releases/download/helm-chart-4.11.2/ingress-nginx-4.11.2.tgz tar -zxf ingress-nginx-4.11.2.tgz helm install ingress-nginx ./ingress-nginx --namespace ingress-nginx --create-namespace å®‰è£…æˆåŠŸä¿¡æ¯ (base) [root@node77 ingress-nginx]# kubectl get service --namespace ingress-nginx ingress-nginx-controller --output wide --watch NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR ingress-nginx-controller LoadBalancer 10.96.1.190 \u0026lt;pending\u0026gt; 80:32702/TCP,443:32064/TCP 37s app.kubernetes.io/component=controller,app.kubernetes.io/instance=ingress-nginx,app.kubernetes.io/name=ingress-nginx 2.3 éƒ¨ç½² CertManager # kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.15.3/cert-manager.yaml 2.4 éƒ¨ç½²Kserve # éœ€ä¿®æ”¹kserve.yamlä¸­ingressClassNameä¸ºåˆ›å»ºçš„IngressClassï¼ˆæœ¬ä¾‹ä¸ºnginxï¼‰ ingress: |- { \u0026#34;ingressClassName\u0026#34; : \u0026#34;nginx\u0026#34;, } éœ€è¦æ³¨æ„çš„æ˜¯åœ¨kserve v0.13.0ç‰ˆæœ¬ä¸­kserve-runtimes.yamlç»„ä»¶æ”¹åä¸ºkserve-cluster-resources.yaml # ä¸‹è½½ wget https://github.com/kserve/kserve/releases/download/v0.13.0/kserve.yaml # ä¿®æ”¹ä»¥åéƒ¨ç½² kubectl apply -f kserve.yaml # ä¸‹è½½ wget https://github.com/kserve/kserve/releases/download/v0.13.0/kserve-cluster-resources.yaml kubectl apply -f kserve-cluster-resources.yaml ä¿®æ”¹inferenceservice-configéƒ¨ç½²æ¨¡å¼ä¸ºRawDeployment kubectl patch configmap/inferenceservice-config -n kserve --type=strategic -p \u0026#39;{\u0026#34;data\u0026#34;: {\u0026#34;deploy\u0026#34;: \u0026#34;{\\\u0026#34;defaultDeploymentMode\\\u0026#34;: \\\u0026#34;RawDeployment\\\u0026#34;}\u0026#34;}}\u0026#39; 2.5 æµ‹è¯• # 2.5.1 é…ç½®æ¨¡å‹crd # åˆ›å»ºnamespace kubectl create namespace test demo-tensorflow.yaml æ³¨æ„ï¼šåœ¨kserve v0.13.0ç‰ˆæœ¬ä¸­ï¼Œæ¨¡å‹å‘å¸ƒéœ€è¦å‘å¸ƒåœ¨édefaultå‘½åç©ºé—´æˆ–æ˜¯kserveå…·æœ‰æƒé™çš„å‘½åç©ºé—´ä¸­ï¼Œå¦åˆ™æ¨¡å‹å¯¹åº”Podä¼šæŠ¥é”™No such file or directory: '/mnt/models'ï¼Œåˆæ­¥æ€€ç–‘è·Ÿ2.3éƒ¨ç½²çš„CertManageré…ç½®æœ‰å…³ç³»ï¼Œæš‚æœªæ·±ç©¶ æ³¨æ„ï¼škserveåˆ›å»ºçš„æ¨¡å‹å‘å¸ƒä¸èƒ½å‘å¸ƒåœ¨kserveå‘½åç©ºé—´ä»¥åŠæ²¡æœ‰æƒé™çš„å‘½åç©ºé—´ä¸­ï¼Œå¦åˆ™æ¨¡å‹å¯¹åº”Podä¼šæŠ¥é”™No such file or directory: '/mnt/models'ï¼Œè¿™æ˜¯kserveçš„webhookæ£€æŸ¥å¯¼è‡´çš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ªissue nameï¼štensorflow-kserve storageUriï¼šhttp://172.16.2.132:9999/00000123.tarï¼ˆé‡‡ç”¨æ–‡ä»¶æœåŠ¡å™¨å½¢å¼æä¾›æ¨¡å‹æ–‡ä»¶taråŒ…æˆ–zipåŒ…ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨è§£å‹ï¼‰ æ¨¡å‹ä¸‹è½½é“¾æ¥ï¼Œtags2 4 apiVersion: \u0026#34;serving.kserve.io/v1beta1\u0026#34; kind: \u0026#34;InferenceService\u0026#34; metadata: name: \u0026#34;tensorflow-kserve\u0026#34; namespace: \u0026#34;test\u0026#34; spec: predictor: tensorflow: storageUri: \u0026#34;http://172.16.2.132:9999/00000123.tar\u0026#34; 2.5.2 ä½¿ç”¨ingressæµ‹è¯• # INGRESS_HOSTï¼š10.96.0.158ï¼ˆIngress-nginxåœ°å€ï¼‰ MODEL_NAMEï¼š2.5.1å®šä¹‰çš„name INPUT_PATHï¼šæ¨¡å‹å…¥å‚ #!/bin/bash # nginx ingress çš„è®¿é—®åœ°å€ INGRESS_HOST=10.96.0.158 INGRESS_PORT=80 MODEL_NAME=tensorflow-kserve INPUT_PATH=@./input.json SERVICE_HOSTNAME=$(kubectl -n test get inferenceservice ${MODEL_NAME} -o jsonpath=\u0026#39;{.status.url}\u0026#39; | cut -d \u0026#34;/\u0026#34; -f 3) curl -H \u0026#34;Host: ${SERVICE_HOSTNAME}\u0026#34; http://${INGRESS_HOST}:${INGRESS_PORT}/v1/models/$MODEL_NAME:predict -d $INPUT_PATH input.json { \u0026#34;instances\u0026#34;:[1,2,3] } ç»“æœå¦‚ä¸‹ ","date":"2024-09-02","externalUrl":null,"permalink":"/cloudai/20240902-1/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"\u003ch5 id=\"typeit-975418dc18a096f280744c8894f6f973\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-975418dc18a096f280744c8894f6f973\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003eæ³¨æ„ \n    \u003cdiv id=\"%E6%B3%A8%E6%84%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eéœ€è¦æ³¨æ„çš„æ˜¯kserveä½¿ç”¨çš„æ¨¡å‹ä¸‹è½½é“¾æ¥\u003ccode\u003estorageUri: \u0026quot;http://172.16.2.132:9999/00000123.tar\u0026quot;\u003c/code\u003eå¯¹åº”çš„æ¨¡å‹å‹ç¼©åŒ…ï¼šåº”è¯¥æ˜¯è§£å‹åæ¨¡å‹åŠé…ç½®æ–‡ä»¶å¹³é“ºå¼€æ¥çš„ï¼Œè€Œä¸æ˜¯è§£å‹åè¿˜æœ‰ä¸€å±‚ç›®å½•åŒ…è£¹çš„\u003c/li\u003e\n\u003cli\u003eåŒæ—¶å¯¹äº\u003ccode\u003estorageUri: \u0026quot;http://172.16.2.132:9999/00000123\u0026quot;\u003c/code\u003eçš„æ¨¡å‹é“¾æ¥ï¼Œ00000123é‡Œé¢çš„å†…å®¹åº”è¯¥ç›´æ¥æ˜¯æ¨¡å‹åŠé…ç½®æ–‡ä»¶ï¼Œè€Œä¸åº”è¯¥å†æœ‰æ·±å±‚æ¬¡çš„ç›®å½•\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e1. kserve-0.10.0ç‰ˆæœ¬å®‰è£… \n    \u003cdiv id=\"1-kserve-0100%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-kserve-0100%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 kserveä¸ä¾èµ–ç‰ˆæœ¬å¯¹åº” \n    \u003cdiv id=\"11-kserve%E4%B8%8E%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-kserve%E4%B8%8E%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: left\"\u003eK8s\u003c/th\u003e\n          \u003cth style=\"text-align: left\"\u003ev1.22.15\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"https://github.com/kserve/kserve/releases/download/v0.10.0/kserve.yaml/\" target=\"_blank\"\u003eKServe\u003c/a\u003e\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev0.10.0\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"\"\u003eCert-manager\u003c/a\u003e\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev1.11.0\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"https://kubernetes.github.io/ingress-nginx/deploy/#quick-start\" target=\"_blank\"\u003eIngress-nginx\u003c/a\u003eï¼ˆ\u003ca href=\"https://github.com/kubernetes/ingress-nginx#supported-versions-table\" target=\"_blank\"\u003eä¸k8sç‰ˆæœ¬å¯¹åº”å…³ç³»\u003c/a\u003eï¼‰\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev1.3.0\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.2 éƒ¨ç½²ingress-nginx \n    \u003cdiv id=\"12-%E9%83%A8%E7%BD%B2ingress-nginx\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#12-%E9%83%A8%E7%BD%B2ingress-nginx\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eé‡‡ç”¨RawDeploymentæ¨¡å¼ï¼Œå› æ­¤ä¸éœ€è¦æŒ‰ç…§å®˜ç½‘è¦æ±‚å®‰è£…Istioï¼ˆIstioè¾ƒé‡ï¼‰\u003c/p\u003e","title":"kserveå®‰è£…ä½¿ç”¨","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/machinelearning/","section":"Tags","summary":"","title":"Machinelearning","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/cloudnative/","section":"äº‘åŸç”Ÿ","summary":"","title":"äº‘åŸç”Ÿ","type":"cloudnative"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/cloudai/","section":"äº‘åŸç”ŸAIæŠ€æœ¯","summary":"","title":"äº‘åŸç”ŸAIæŠ€æœ¯","type":"cloudai"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/containerd/","section":"Tags","summary":"","title":"Containerd","type":"tags"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/k8s-solve/","section":"k8sé—®é¢˜è§£å†³ä¸è®°å½•","summary":"","title":"k8sé—®é¢˜è§£å†³ä¸è®°å½•","type":"k8s-solve"},{"content":"kubernetesé—®é¢˜è§£å†³é›†åˆã€‚\n1. å®¿ä¸»æœºä¿®æ”¹æ—¶DNSï¼ˆ/etc/resolv.confï¼‰é…ç½® # å®¿ä¸»æœºé›†ç¾¤æ›´æ”¹DNSæœåŠ¡(/etc/resolv.conf), éœ€åŒæ—¶é‡å¯nodelocaldns(éƒ¨åˆ†é›†ç¾¤é«˜é…nodelocaldns)åŠcorednsæœåŠ¡ 2. è¿›å…¥CoreDNSå®¹å™¨å†…éƒ¨æ“ä½œ # 2.1 è¿›å…¥k8sçš„corednså®¹å™¨æŸ¥çœ‹ä¿¡æ¯: # æ‚¨å¯ä»¥æŒ‰ç…§æ­¤å¤„çš„è¯´æ˜ä½¿ç”¨ sidecar æ¨¡å¼:https://support.rancher.com/hc/en-us/articles/360041568712-How-to-troubleshoot-using-the-namespace-of-a-container#sidecar-container-0-2\n2.2 ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ªè¿è¡Œ coredns pod çš„èŠ‚ç‚¹: # kubectl -n kube-system get po -o wide | grep coredns ssh åˆ°è¿™äº›èŠ‚ç‚¹ä¹‹ä¸€ï¼Œç„¶å: docker ps -a | grep coredns å°†å®¹å™¨ ID å¤åˆ¶åˆ°å‰ªè´´æ¿å¹¶è¿è¡Œ: ID=\u0026lt;paste ID here\u0026gt; docker run -it --net=container:$ID --pid=container:$ID --volumes-from=$ID alpine sh æ‚¨ç°åœ¨å°†ä½äºâ€œsidecarâ€å®¹å™¨å†…ï¼Œå¯ä»¥å››å¤„æŸ¥çœ‹ã€‚ cat /etc/coredns/Corefile 3. å¸¦æœ‰nodelocaldnsé›†ç¾¤é‡å¯ådnså¼‚å¸¸ # nodenocaldnsæ—¥å¿—æŠ¥é”™å¦‚ä¸‹ï¼š\ncoredns HINFO: read tcp 10.233.90.147:44370-\u0026gt;172.16.1.207:53: i/o timeout é€šè¿‡æ’æŸ¥å‘ç°æ˜¯nolocaldnsçš„53æŒ‡å‘ä¸æ˜¯é›†ç¾¤çš„dnsæœåŠ¡å™¨\nä¿®æ”¹nodecaldnsçš„corefile\nå°†å…¶ä¸­ forward . 10.233.90.242 æ‰‹åŠ¨æ”¹ä¸ºforward . 10.233.0.3 10.233.0.3ä¸ºcorednsçš„vipåœ°å€ 10.233.90.242ä¸ºcorednsçš„pod ipåœ°å€ï¼Œé‡å¯podåå‘ç”Ÿå˜åŠ¨ï¼Œå› æ­¤é‡‡ç”¨vipä½œä¸ºæŒ‡å‘ cluster.local:53 { errors cache { success 9984 30 denial 9984 5 } reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 health 169.254.25.10:9254 } in-addr.arpa:53 { errors cache 30 reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 } ip6.arpa:53 { errors cache 30 reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 } .:53 { errors cache 30 reload loop bind 169.254.25.10 forward . /etc/resolv.conf prometheus :9253 } é‡æ–°è§‚å¯Ÿnodelocaldnsæ—¥å¿—ï¼ŒæœåŠ¡æ­£å¸¸\n4. K8Sç‰ˆæœ¬ä¸Linuxå†…æ ¸ä¸å…¼å®¹å¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ # 4.1 èƒŒæ™¯ # kubeletè¯¯æŠ¥å†…å­˜å‹åŠ›(å®é™…å†…å­˜ä½¿ç”¨ç‡å¾ˆå°)-\u0026gt;èŠ‚ç‚¹è¢«æ‰“æ±¡ç‚¹-\u0026gt;èŠ‚ç‚¹ä¸Špodå¤„äºé©±é€çŠ¶æ€-\u0026gt;é‡å¯kubeletä¼šæ¢å¤\nmkdir /sys/fs/cgroup/memory/kubepods/besteffort/pod54ca8314-ae1a-4d22-8564-fdd73215f1cc: cannot allocate memory Normal Scheduled 7m19s default-scheduler Successfully assigned default/kt-rectifier-rulla to node133 Warning FailedCreatePodContainer 2m1s (x26 over 7m20s) kubelet unable to ensure pod container exists: failed to create container for [kubepods besteffort pod54ca8314-ae1a-4d22-8564-fdd73215f1cc] : mkdir /sys/fs/cgroup/memory/kubepods/besteffort/pod54ca8314-ae1a-4d22-8564-fdd73215f1cc: cannot allocate memory 4.2 Cgroup # åœ¨å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼ˆ3.xï¼‰ä¸‹ï¼Œå¼€å¯äº†kmem accountingåŠŸèƒ½ï¼Œä¼šå¯¼è‡´memory cgroupçš„æ¡ç›®æ³„æ¼æ— æ³•å›æ”¶ã€‚\n4.3 è§£å†³æ–¹æ¡ˆ # 4.3.1 é‡å¯å†…å­˜æ³„éœ²æœåŠ¡å™¨ï¼ˆä¸´æ—¶è§£å†³ï¼‰ # 4.3.2 å‡çº§å†…æ ¸ç‰ˆæœ¬-4.xï¼ˆæ°¸ä¹…è§£å†³ï¼‰ # å…·ä½“å‡çº§æ–¹æ¡ˆå‚è€ƒã€ŠCentos7å†…æ ¸å‡çº§ã€‹ä¸€æ–‡ ","date":"2024-09-01","externalUrl":null,"permalink":"/k8s-solve/20240901-3/","section":"k8sé—®é¢˜è§£å†³ä¸è®°å½•","summary":"\u003cp\u003ekubernetesé—®é¢˜è§£å†³é›†åˆã€‚\u003c/p\u003e","title":"kubernetesé—®é¢˜è§£å†³é›†åˆ","type":"blog"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/question/","section":"Tags","summary":"","title":"Question","type":"tags"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/solve/","section":"Tags","summary":"","title":"Solve","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/crd/","section":"Tags","summary":"","title":"Crd","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/download/","section":"Tags","summary":"","title":"Download","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/file/","section":"Tags","summary":"","title":"File","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/gs/","section":"Tags","summary":"","title":"Gs","type":"tags"},{"content":"æœ¬æ–‡è§£å†³äº†k8sèµ„æºåˆ é™¤æŠ¥Terminatingå¡ä½çš„é—®é¢˜ã€‚\n1.æ–¹æ¡ˆä¸€ # é€‚ç”¨èµ„æºç±»å‹ï¼špodã€deployã€namespacesã€crd\nä½¿ç”¨kubectl delete crdå¡ä½ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°è¯¥èµ„æºçš„çŠ¶æ€ï¼š kubectl patch crd/inferenceservices.serving.kserve.io -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:[]}}\u0026#39; --type=merge 2.æ–¹æ¡ˆ2(ä¼˜å…ˆæ–¹æ¡ˆä¸€) # # 1.å¯¼å‡ºé…ç½® kubectl get ns rook-ceph -o json \u0026gt; tmp.json # 2.åˆ é™¤tmp.jsonä¸­specåŠstatuséƒ¨åˆ†çš„å†…å®¹ # 3.å¯åŠ¨ä»£ç† kubectl proxy # 4.è°ƒç”¨æ¥å£åˆ é™¤ curl -k -H \u0026#34;Content-Type: application/json\u0026#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/rook-ceph/finalize ","date":"2024-08-29","externalUrl":null,"permalink":"/k8s-solve/20240829-2/","section":"k8sé—®é¢˜è§£å†³ä¸è®°å½•","summary":"\u003cp\u003eæœ¬æ–‡è§£å†³äº†k8sèµ„æºåˆ é™¤æŠ¥Terminatingå¡ä½çš„é—®é¢˜ã€‚\u003c/p\u003e","title":"k8sèµ„æºåˆ é™¤æŠ¥Terminatingå¡ä½","type":"blog"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/namespace/","section":"Tags","summary":"","title":"Namespace","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/terminating/","section":"Tags","summary":"","title":"Terminating","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/filedown/","section":"æ–‡ä»¶ä¸‹è½½","summary":"","title":"æ–‡ä»¶ä¸‹è½½","type":"filedown"},{"content":"æœ¬æ–‡æä¾›äº†ä¸‹è½½gsåè®®çš„æ–‡ä»¶æ–¹æ¡ˆã€‚\né€šè¿‡å°†gs://åçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹åœ°å€æ‹¼æ¥åˆ°https://storage.googleapis.comå³å¯\n1. åŸå§‹æ–‡ä»¶åœ°å€ # gs://kfserving-examples/models/sklearn/1.0/model/model.joblib 2. è½¬æ¢åçš„ä¸‹è½½åœ°å€ # https://storage.googleapis.com/kfserving-examples/models/sklearn/1.0/model/model.joblib ","date":"2024-08-29","externalUrl":null,"permalink":"/filedown/20240829-1/","section":"æ–‡ä»¶ä¸‹è½½","summary":"\u003cp\u003eæœ¬æ–‡æä¾›äº†ä¸‹è½½gsåè®®çš„æ–‡ä»¶æ–¹æ¡ˆã€‚\u003c/p\u003e","title":"ä¸‹è½½gsåè®®çš„æ–‡ä»¶","type":"blog"},{"content":"","date":"2024-08-26","externalUrl":null,"permalink":"/calico/","section":"calico","summary":"","title":"calico","type":"calico"},{"content":" è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜ # ","date":"2024-08-26","externalUrl":null,"permalink":"/calico/20240826-1/","section":"calico","summary":"\u003ch5 id=\"typeit-ccaa400c54080eb69775b832cdd583dd\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-ccaa400c54080eb69775b832cdd583dd\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003eè¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜ \n    \u003cdiv id=\"%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e","title":"First","type":"calico"},{"content":" è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜ # ","date":"2024-08-26","externalUrl":null,"permalink":"/ceph/20240826-1/","section":"RookCephå­˜å‚¨","summary":"\u003ch5 id=\"typeit-4b3b2247ac91943a2fe576ae718ab317\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-4b3b2247ac91943a2fe576ae718ab317\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003eè¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜ \n    \u003cdiv id=\"%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e","title":"First","type":"ceph"},{"content":"","date":"2024-08-26","externalUrl":null,"permalink":"/ceph/","section":"RookCephå­˜å‚¨","summary":"","title":"RookCephå­˜å‚¨","type":"ceph"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/archives/","section":"Tags","summary":"","title":"Archives","type":"tags"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/blowfish/","section":"Tags","summary":"","title":"Blowfish","type":"tags"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/hugo/","section":"Tags","summary":"","title":"Hugo","type":"tags"},{"content":"æ·»åŠ æ—¶é—´è½´ï¼Œå½’æ¡£åšå®¢ã€‚\n1. åˆ›å»ºæ—¶é—´è½´ç›¸å…³æ–‡ä»¶ # 1.1 åˆ›å»ºarchives.htmlæ–‡ä»¶ # å¤åˆ¶layouts/defaultç›®å½•ä¸‹çš„single.htmlæ–‡ä»¶ä¸ºarchives.html,å¹¶ç”¨ä»¥ä¸‹ä»£ç æ›¿ä»£htmlä¸­çš„{{ .Content }} {{ range (where .Pages \u0026ldquo;Type\u0026rdquo; \u0026ldquo;blog\u0026rdquo;) }}ï¼šç”¨äºä»…å±•ç¤ºcontentç›®å½•ä¸‹ç±»å‹ä¸ºblogçš„mdæ–‡ä»¶ {{ range (.Site.RegularPages.GroupByDate \u0026#34;2006\u0026#34;) }} \u0026lt;h3\u0026gt;{{ .Key }}\u0026lt;/h3\u0026gt; \u0026lt;ul class=\u0026#34;archive-list\u0026#34;\u0026gt; {{ range (where .Pages \u0026#34;Type\u0026#34; \u0026#34;blog\u0026#34;) }} \u0026lt;li\u0026gt; {{ .PublishDate.Format \u0026#34;2006-01-02\u0026#34; }} -\u0026gt; \u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34;\u0026gt;{{ .Title }}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; {{ end }} \u0026lt;/ul\u0026gt; {{ end }} 1.2 åˆ›å»ºarchives.mdæ–‡ä»¶ # åœ¨contentç›®å½•ä¸‹åˆ›å»ºarchives.mdæ–‡ä»¶ --- title: \u0026#34;æ—¶é—´è½´\u0026#34; layout: \u0026#34;archives\u0026#34; date: 2017-07-17 description: \u0026#34;å†å²æ–‡ç« æŒ‰ç…§å¹´å½’æ¡£.\u0026#34; type: \u0026#34;archives\u0026#34; cascade: showDate: true showAuthor: true invertPagination: true --- 2. æ·»åŠ é…ç½® # åœ¨config/_default/menus.zh-cn.tomlä¸­æ·»åŠ å¦‚ä¸‹é…ç½® [[main]] name = \u0026#34;æ—¶é—´è½´\u0026#34; pageRef = \u0026#34;archives\u0026#34; weight = 300 ","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/20240825-3/","section":"Hugoåšå®¢ç›¸å…³","summary":"\u003cp\u003eæ·»åŠ æ—¶é—´è½´ï¼Œå½’æ¡£åšå®¢ã€‚\u003c/p\u003e","title":"hugoåšå®¢-blowfishä¸»é¢˜æ·»åŠ æ—¶é—´è½´","type":"blog"},{"content":"æ·»åŠ éŸ³ä¹ç»„ä»¶ï¼Œå¹¶åœ¨åˆ‡æ¢é¡µé¢æ—¶ä¿æŒéŸ³ä¹æ’­æ”¾ã€‚\n1. æ·»åŠ éŸ³ä¹ç»„ä»¶ # 1.1 åˆ›å»ºmusic.htmlæ–‡ä»¶ # åœ¨layouts/partialsç›®å½•ä¸‹åˆ›å»ºmusic.htmlæ–‡ä»¶ï¼Œæ·»åŠ éŸ³ä¹å¯¹åº”å‚æ•°è¯´æ˜ name: éŸ³ä¹åï¼Œ #\u0026lsquo;æ¢æ•…çŸ¥\u0026rsquo; url: éŸ³ä¹å¤–é“¾åœ°å€ï¼Œ#\u0026lsquo;http://music.163.com/song/media/outer/url?id=2613724903.mp3' artist: éŸ³ä¹å®¶ï¼Œ#\u0026lsquo;å‰æ³½æ ‘\u0026rsquo; cover: éŸ³ä¹å°é¢ï¼Œ#\u0026lsquo;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp' \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- require APlayer --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- require MetingJS --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;demo\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;player1\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var ap = new APlayer ({ element: document.getElementById(\u0026#39;player1\u0026#39;), fixed: true, showlrc: false, autoplay: false, mini: true, theme: \u0026#39;#f8f4fc\u0026#39;, loop: \u0026#39;all\u0026#39;, order: \u0026#39;random\u0026#39;, preload: \u0026#39;auto\u0026#39;, volume: 0.4, mutex: true, listFolded: true, listMaxHeight: \u0026#39;500px\u0026#39;, lrcType: 0, music: [ { name: \u0026#39;æ¢æ•…çŸ¥\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2613724903.mp3\u0026#39;, artist: \u0026#39;å‰æ³½æ ‘\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;å¦‚æœå½“æ—¶2020\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=1488737309.mp3\u0026#39;, artist: \u0026#39;è®¸åµ©,æœ±å©·å©·\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;å¦‚æœäº‘çŸ¥é“\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2109099118.mp3\u0026#39;, artist: \u0026#39;è®¸èŒ¹èŠ¸\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;ä¸€ç”Ÿæœ‰ä½ \u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2017129217.mp3\u0026#39;, artist: \u0026#39;æ°´æœ¨å¹´å\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;è§‰æ‚Ÿ\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2030542462.mp3\u0026#39;, artist: \u0026#39;ç‹å°å¸…\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, ] }); //ap.init(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; 2. é…ç½®éŸ³ä¹ç»„ä»¶åœ¨åˆ‡æ¢é¡µé¢åä»ä¿æŒæ’­æ”¾ # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- require APlayer --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- require MetingJS --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;demo\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;player1\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var ap = new APlayer ({ element: document.getElementById(\u0026#39;player1\u0026#39;), fixed: true, showlrc: false, autoplay: false, mini: true, theme: \u0026#39;#f8f4fc\u0026#39;, loop: \u0026#39;all\u0026#39;, order: \u0026#39;random\u0026#39;, preload: \u0026#39;auto\u0026#39;, volume: 0.4, mutex: true, listFolded: true, listMaxHeight: \u0026#39;500px\u0026#39;, lrcType: 0, music: [ { name: \u0026#39;æ¢æ•…çŸ¥\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2613724903.mp3\u0026#39;, artist: \u0026#39;å‰æ³½æ ‘\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;å¦‚æœå½“æ—¶2020\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=1488737309.mp3\u0026#39;, artist: \u0026#39;è®¸åµ©,æœ±å©·å©·\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;å¦‚æœäº‘çŸ¥é“\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2109099118.mp3\u0026#39;, artist: \u0026#39;è®¸èŒ¹èŠ¸\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;ä¸€ç”Ÿæœ‰ä½ \u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2017129217.mp3\u0026#39;, artist: \u0026#39;æ°´æœ¨å¹´å\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;è§‰æ‚Ÿ\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2030542462.mp3\u0026#39;, artist: \u0026#39;ç‹å°å¸…\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, ] }); //ap.init(); isRecover = false; function ready(){ ap.on(\u0026#39;canplay\u0026#39;, function () { if(!isRecover){ if(localStorage.getItem(\u0026#34;musicIndex\u0026#34;) != null){ musicIndex = localStorage.getItem(\u0026#34;musicIndex\u0026#34;); musicTime = localStorage.getItem(\u0026#34;musicTime\u0026#34;); if(ap.list.index != musicIndex){ ap.list.switch(musicIndex); }else{ ap.seek(musicTime); ap.play(); localStorage.clear(); isRecover = true; } }else{ isRecover = true; } } }); } window.onbeforeunload = function(event) { if(!ap.audio.paused){ musicIndex = ap.list.index; musicTime = ap.audio.currentTime; localStorage.setItem(\u0026#34;musicIndex\u0026#34;,musicIndex); localStorage.setItem(\u0026#34;musicTime\u0026#34;,musicTime); } }; \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; ","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/20240825-2/","section":"Hugoåšå®¢ç›¸å…³","summary":"\u003cp\u003eæ·»åŠ éŸ³ä¹ç»„ä»¶ï¼Œå¹¶åœ¨åˆ‡æ¢é¡µé¢æ—¶ä¿æŒéŸ³ä¹æ’­æ”¾ã€‚\u003c/p\u003e","title":"hugoåšå®¢-blowfishä¸»é¢˜æ·»åŠ éŸ³ä¹ç»„ä»¶","type":"blog"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/","section":"Hugoåšå®¢ç›¸å…³","summary":"","title":"Hugoåšå®¢ç›¸å…³","type":"hugos"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/music/","section":"Tags","summary":"","title":"Music","type":"tags"},{"content":"","date":"2024-08-23","externalUrl":null,"permalink":"/tags/comments/","section":"Tags","summary":"","title":"Comments","type":"tags"},{"content":"æ·»åŠ giscusï¼Œç”¨äºåšå®¢äº¤æµã€‚\n1. åˆ›å»ºè¯„è®ºç›¸å…³æ–‡ä»¶ # 1.1 åˆ›å»ºcomments.htmlæ–‡ä»¶ # åœ¨layouts/partialsç›®å½•ä¸‹åˆ›å»ºcomments.html ä»¥ä¸‹å‚æ•°æ¥è‡ªgiscusï¼Œå…·ä½“å‚è€ƒå®˜ç½‘https://giscus.app/zh-CN \u0026lt;script src=\u0026#34;https://giscus.app/client.js\u0026#34; data-repo=\u0026#34;xxx/xxx\u0026#34; data-repo-id=\u0026#34;xxxx\u0026#34; data-category=\u0026#34;Announcements\u0026#34; data-category-id=\u0026#34;xxxx\u0026#34; data-mapping=\u0026#34;pathname\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; data-loading=\u0026#34;lazy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; 2. æ·»åŠ é…ç½® # 2.1 config.tomlä¸­æ·»åŠ é…ç½® # åœ¨themes/blowfish/config.tomlä¸­æ·»åŠ å¦‚ä¸‹é…ç½® ä»¥ä¸‹å‚æ•°æ¥è‡ªgiscusï¼Œå…·ä½“å‚è€ƒå®˜ç½‘https://giscus.app/zh-CN [params.giscus] data-repo=\u0026#34;xxx/xxxx\u0026#34; data-repo-id=\u0026#34;xxx\u0026#34; data-category=\u0026#34;Announcements\u0026#34; data-category-id=\u0026#34;xxx\u0026#34; data-mapping=\u0026#34;pathname\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; data-loading=\u0026#34;lazy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; 2.2 params.tomlä¸­æ·»åŠ é…ç½® # config/_default/params.tomlä¸­æ·»åŠ å¦‚ä¸‹é…ç½® showComments = true [article] showDate = true ... showWordCount = true showComments = true ","date":"2024-08-23","externalUrl":null,"permalink":"/hugos/20240823-1/","section":"Hugoåšå®¢ç›¸å…³","summary":"\u003cp\u003eæ·»åŠ giscusï¼Œç”¨äºåšå®¢äº¤æµã€‚\u003c/p\u003e","title":"hugoåšå®¢-blowfishä¸»é¢˜æ·»åŠ giscusä½œä¸ºè¯„è®ºç³»ç»Ÿ","type":"blog"},{"content":"æœ¬æ–‡è§£å†³äº†k8så¥åº·æ£€æŸ¥æ—¶æç¤ºunhealthyçš„é—®é¢˜ã€‚\n1.kubectl get csç»„ä»¶çŠ¶æ€å¼‚å¸¸ # æŠ¥é”™ä¿¡æ¯æç¤º10251ç«¯å£æ‹’ç»è¿æ¥ Get \u0026#34;http://127.0.0.1:10251/healthz\u0026#34;: dial tcp 127.0.0.1:10251: connect: connection refused 2. æŸ¥çœ‹ç«¯å£çŠ¶æ€ # æœåŠ¡ç¡®å®æœªå¯åŠ¨ netstat -lnpt |grep 1025 3. ä¿®æ”¹kube-scheduler.yaml,æ³¨é‡Šport=0 # æŸ¥çœ‹scheduleré…ç½®æ–‡ä»¶æ˜¯å¦ç¦ç”¨éå®‰å…¨ç«¯å£ã€‚æ–‡ä»¶è·¯å¾„åœ¨/etc/kubernetes/manifests\ncd /etc/kubernetes/manifests vim kube-scheduler.yaml 4. å†æ¬¡æ£€æŸ¥ç«¯å£åŠæœåŠ¡ # ä¸€åˆ‡æ­£å¸¸ netstat -lnpt |grep 1025 kubectl get cs 5.å…¶å®ƒæƒ…å†µ # å› ä¸ºæœ¬æ¬¡ä»…é‡åˆ°äº†schedulerçš„unhealthyçš„é—®é¢˜ï¼Œæ‰€ä»¥ä»…ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ ¹æ®ç»éªŒä¹‹è°ˆï¼Œå¦‚æœcontollerä¹Ÿæ˜¯unhealthyçš„æƒ…å†µ\n5.1 contollerä¹Ÿæ˜¯unhealthyè§£å†³æ–¹æ¡ˆ # å…¶å®ƒæ­¥éª¤åŒä¸Šï¼Œæ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼Œæ³¨é‡Šport=0\n/etc/kubernetes/manifests/ 5.2 é‡å¯æœåŠ¡ # æœ¬æ–‡æ“ä½œæ—¶å¹¶æœªé‡å¯æœåŠ¡ï¼Œä¿®æ”¹æ–‡ä»¶å³å¯ï¼Œå¦‚ä¿®æ”¹æ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Œå¯æ‰‹åŠ¨é‡å¯æœåŠ¡\nsystemctl restart kubelet.service ","date":"2024-08-11","externalUrl":null,"permalink":"/k8s-solve/20240811-1/","section":"k8sé—®é¢˜è§£å†³ä¸è®°å½•","summary":"\u003cp\u003eæœ¬æ–‡è§£å†³äº†k8så¥åº·æ£€æŸ¥æ—¶æç¤ºunhealthyçš„é—®é¢˜ã€‚\u003c/p\u003e","title":"k8sï¼ˆkubectl get csï¼‰å¥åº·æ£€æŸ¥æŠ¥é”™","type":"blog"},{"content":"","date":"2024-08-11","externalUrl":null,"permalink":"/tags/unhealthy/","section":"Tags","summary":"","title":"Unhealthy","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/https/","section":"Tags","summary":"","title":"Https","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/os/","section":"Tags","summary":"","title":"Os","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/tools/","section":"Tags","summary":"","title":"Tools","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/wifi/","section":"Tags","summary":"","title":"Wifi","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"windowsç¬”è®°æœ¬wifiè¿æ¥æ­£å¸¸ä¸Šä¸äº†ç½‘ã€‚\n1. ç°è±¡ # ç¬”è®°æœ¬ç”µè„‘ä¸Šä¸€æ¬¡å…³æœºå‰å¯æ­£å¸¸è¿æ¥wifiä¸Šç½‘ å…³æœºåï¼Œä¸‹ä¸€æ¬¡å†å¼€æœºå‘ç°è¿æ¥wifiæ­£å¸¸ï¼Œä½†æ˜¯é€šè¿‡æµè§ˆå™¨æ— æ³•æ‰“å¼€ç½‘é¡µäº† 2. åŸå›  # æŸäº›æ“ä½œæˆ–è€…ä»£ç†è½¯ä»¶ä¼šè‡ªåŠ¨è®¾ç½®å±€åŸŸç½‘ä»£ç†å¯¼è‡´ç½‘ç»œä¸é€š 3. è§£å†³ # å³é”®æ¡Œé¢å³ä¸‹è§’çš„wifiæ ‡å¿—ï¼Œé€‰æ‹©ç½‘ç»œå’ŒInterneté€‰é¡¹ é€‰æ‹©æœ€ä¸‹é¢çš„Interneté€‰é¡¹ é€‰æ‹©ç¬¬äº”é¡¹è¿æ¥é‡Œé¢çš„å±€åŸŸç½‘è®¾ç½®ï¼Œå°†ä»£ç†æœåŠ¡å™¨ä¸‹é¢æ‰€æœ‰çš„å‹¾é€‰å–æ¶ˆ ","date":"2024-07-29","externalUrl":null,"permalink":"/windows/20240729-1/","section":"windowsé—®é¢˜è§£å†³","summary":"\u003cp\u003ewindowsç¬”è®°æœ¬wifiè¿æ¥æ­£å¸¸ä¸Šä¸äº†ç½‘ã€‚\u003c/p\u003e","title":"windowsç¬”è®°æœ¬wifiè¿æ¥æ­£å¸¸ä¸Šä¸äº†ç½‘","type":"blog"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/windows/","section":"windowsé—®é¢˜è§£å†³","summary":"","title":"windowsé—®é¢˜è§£å†³","type":"windows"},{"content":"å„ç±»å·¥å…·ç½‘å€è®°å½•ã€‚\n1. å·¥å…·ç±»ç½‘å€ # 1.1 pdfåŠ é”æ–‡ä»¶è§£é”ç½‘å€ # 1.1.1 ç°è±¡ # ä¸€äº›pdfæ–‡ä»¶åŠ é”åå¿˜è®°å¯†ç ä»è€Œæ— æ³•ç¼–è¾‘ 1.1.2 è§£å†³ # é€šè¿‡åœ¨çº¿ç½‘ç«™è¿›è¡Œè§£é” https://smallpdf.com/cn/unlock-pdf 1.2 çŸ¢é‡å›¾æ ‡ä¸‹è½½ # é˜¿é‡Œå…è´¹çŸ¢é‡å›¾æ ‡ä¸‹è½½ https://www.iconfont.cn/ 1.3 åœ¨çº¿éŸ³ä¹èšåˆæœç´¢ # èšåˆéŸ³ä¹æœç´¢ https://mp3.ltyuanfang.cn/ 1.4 å›¾ç‰‡è£å‰ªåœ†å½¢ç½‘å€ # https://bigimage.11zon.com/zh-cn/crop-circle-image/ https://crop.imageonline.co/cn/ 1.5 å›¾ç‰‡å‹ç¼© # åœ¨çº¿å‹ç¼©ï¼š\nhttp://v.yalijuda.com:32723/%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9-%e5%89%af%e6%9c%ac-2/ https://www.youcompress.com/zh-cn/ å‹ç¼©è½¯ä»¶ï¼š\n1.5.1 Imagine # Imagine 7 æ˜¯ä¸€æ¬¾ç”¨äºå‹ç¼© PNG å’Œ JPEG çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·ç•Œé¢ç°ä»£è€Œå‹å¥½ã€‚\nç‰¹ç‚¹ï¼š å¤šç§æ ¼å¼ï¼ˆJPEGã€PNGã€WebPï¼‰ æ ¼å¼è½¬æ¢ è·¨å¹³å° GUI å›¾å½¢ç”¨æˆ·ç•Œé¢ æ‰¹é‡ä¼˜åŒ– (English, ç®€ä½“ä¸­æ–‡, Nederlands, EspaÃ±ol, FranÃ§ais, Italiano, Deutsch) https://github.com/meowtec/Imagine 1.6 windowsæ–‡ä»¶å¤¹é˜²ä¸¢å°åŠ©æ‰‹ï¼ˆDirTagï¼‰ # è¿è¡ŒDirTagåï¼Œå½“ä½ æ‰“å¼€æŸæ–‡ä»¶å¤¹ï¼ˆç›®æ ‡æ˜¯æ›´æ·±å¤„çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œå¦‚æœå­˜åœ¨æ·±å¤„å­æ–‡ä»¶å¤¹å·²å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šè·³å‡ºèœå•ï¼Œå•å‡»èœå•é¡¹å³å¯è½¬åˆ°ã€‚\nåŸæ–‡åœ°å€ï¼šå°ä¼—è®ºå› http://dogbean.ysepan.com/ 2. å­¦ä¹ ç±»ç½‘å€ # ","date":"2024-07-29","externalUrl":null,"permalink":"/tools/20240729-1/","section":"å·¥å…·åˆé›†","summary":"\u003cp\u003eå„ç±»å·¥å…·ç½‘å€è®°å½•ã€‚\u003c/p\u003e","title":"å„ç±»å·¥å…·ç½‘å€è®°å½•","type":"blog"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/centos7/","section":"Tags","summary":"","title":"Centos7","type":"tags"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/gitlab-ce/","section":"Tags","summary":"","title":"Gitlab-Ce","type":"tags"},{"content":" 1. å¯åŠ¨ä¸­æ–‡ç‰ˆgitlab-ceå®¹å™¨ # 1.1 è‡ªåŠ¨å¯åŠ¨æ¨¡å¼ # docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh:11.1 1.2 æ‰‹åŠ¨å¯åŠ¨è°ƒè¯•æ¨¡å¼ # docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh:11.1 /bin/bash -c \u0026#34;while true;do sleep 100; done\u0026#34; è°ƒè¯•å®Œæˆåï¼Œå¯åŠ¨å‘½ä»¤\n/assets/wrapper æ‰§è¡Œå¯åŠ¨å‘½ä»¤æœ‰å¯èƒ½ä¼šé‡åˆ°é…ç½®ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€é‡æ–°åŠ è½½é…ç½®\ngitlab-ctl reconfigure 2. gitlab-ceå¼‚å¸¸æ–­ç”µè°ƒè¯• # 2.1 GitLab external URL must include a schema and FQDN, e.g. http://gitlab.example.com/ # è§£å†³åŠæ³•ï¼š\nvim /etc/gitlab/gitlab.rb å°†\nexternal_url \u0026#39;YYY\u0026#39; æ”¹æˆ\nexternal_url= \u0026#39;httpï¼š//æœ¬æœºIP\u0026#39; 2.2 Failed asserting that mode permissions on \u0026ldquo;/var/opt/gitlab/git-data/repositories\u0026rdquo; is 2770 # è§£å†³åŠæ³•\nchmod 2770 /var/opt/gitlab/git-data/repositories ","date":"2024-03-29","externalUrl":null,"permalink":"/linux/20240329-2/","section":"Linuxé—®é¢˜è§£å†³","summary":"\u003ch1 class=\"relative group\"\u003e1. å¯åŠ¨ä¸­æ–‡ç‰ˆgitlab-ceå®¹å™¨ \n    \u003cdiv id=\"1-%E5%90%AF%E5%8A%A8%E4%B8%AD%E6%96%87%E7%89%88gitlab-ce%E5%AE%B9%E5%99%A8\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%90%AF%E5%8A%A8%E4%B8%AD%E6%96%87%E7%89%88gitlab-ce%E5%AE%B9%E5%99%A8\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 è‡ªåŠ¨å¯åŠ¨æ¨¡å¼ \n    \u003cdiv id=\"11-%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e twang2218/gitlab-ce-zh:11.1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch2 class=\"relative group\"\u003e1.2 æ‰‹åŠ¨å¯åŠ¨è°ƒè¯•æ¨¡å¼ \n    \u003cdiv id=\"12-%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#12-%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e twang2218/gitlab-ce-zh:11.1 /bin/bash -c \u003cspan class=\"s2\"\u003e\u0026#34;while true;do sleep 100; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè°ƒè¯•å®Œæˆåï¼Œå¯åŠ¨å‘½ä»¤\u003c/p\u003e","title":"Gitlab-ceä¸­æ–‡ç‰ˆå®‰è£…åŠç»´æŠ¤","type":"blog"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/kernel/","section":"Tags","summary":"","title":"Kernel","type":"tags"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/linux/","section":"Linuxé—®é¢˜è§£å†³","summary":"","title":"Linuxé—®é¢˜è§£å†³","type":"linux"},{"content":" 1. å‚è€ƒç½‘ç«™ # centos7 ç¦»çº¿å‡çº§/åœ¨çº¿å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸_centos7 red hat enterprise-CSDNåšå®¢\n2. å†…æ ¸ä¸‹è½½ç½‘ç«™ # http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/\n3. é…ç½®rpmä»“åº“åŠä¸‹è½½å†…æ ¸rpmåŒ… # å†…æ ¸åŒ…ä¸‹è½½å¥½ï¼Œkernel-mlä»£è¡¨ä¸»çº¿ç‰ˆæœ¬ï¼Œæ€»æ˜¯ä¿æŒä¸»çº¿æœ€æ–°çš„å†…æ ¸ï¼Œkernel-ltä»£è¡¨é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæ”¯æŒå‘¨æœŸæ›´é•¿ï¼Œå¦‚æœä½ è¦è¿½æ±‚æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç›´æ¥é€‰æ‹©å¸¦mlçš„rpmåŒ…å³å¯ï¼Œå¦‚æœä½ è¦è¿½æ±‚ç¨³å®šä¸”æ›´é•¿çš„æ”¯æŒå‘¨æœŸï¼Œç›´æ¥é€‰æ‹©ltç‰ˆæœ¬å³å¯ã€‚ rpm -Uvh http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/elrepo-release-7.0-8.el7.elrepo.noarch.rpm # 6.9.7ç‰ˆæœ¬ï¼šhttp://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-6.9.7-1.el7.elrepo.x86_64.rpm wget http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm 4. å®‰è£…(Centos7ç³»ç»Ÿ) # rpm -ivh kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm 4.1 ä¿®æ”¹å†…æ ¸å¯åŠ¨é¡ºåº # ä¿®æ”¹æ–‡ä»¶ï¼š/etc/default/grub ä½¿ GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=\u0026#34;$(sed \u0026#39;s, release .*$,,g\u0026#39; /etc/system-release)\u0026#34; # æ”¹GRUB_DEFAULT=savedä¸º0 GRUB_DEFAULT=0 GRUB_DISABLE_SUBMENU=true GRUB_TERMINAL_OUTPUT=\u0026#34;gfxterm\u0026#34; GRUB_CMDLINE_LINUX=\u0026#34;rhgb quiet nomodeset\u0026#34; GRUB_DISABLE_RECOVERY=\u0026#34;true\u0026#34; è®¾ç½®é»˜è®¤å¯åŠ¨å†…æ ¸ï¼Œgrub2-set-default 0å’Œ/etc/default/grubæ–‡ä»¶é‡Œçš„GRUB_DEFAULT=0æ„æ€ä¸€æ · grub2-set-default 0 æŸ¥çœ‹æ‰€æœ‰å†…æ ¸ awk -F\\\u0026#39; \u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39; /boot/grub2/grub.cfg é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶ grub2-mkconfig -o /boot/grub2/grub.cfg é‡å¯å¹¶æŸ¥çœ‹å†…æ ¸æ¿æ¿ reboot uname -r 4.2 å¤šä½™å†…æ ¸åˆ é™¤ # åœ¨ CentOS 7 ä¸­åˆ é™¤å¤šä½™å†…æ ¸çš„æ­¥éª¤é€šå¸¸å¦‚ä¸‹ï¼š\nåœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶åŠ¡å¿…å°å¿ƒï¼Œç¡®ä¿ä½ ä¸ä¼šè¯¯åˆ å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚å¦‚æœä¸ç¡®å®šå“ªäº›å†…æ ¸å¯ä»¥å®‰å…¨åˆ é™¤ï¼Œå»ºè®®ä»…åˆ é™¤æ˜ç¡®æ ‡è®°ä¸ºæ—§ç‰ˆæœ¬ä¸”ç¡®è®¤æœªè¢«å½“å‰ç³»ç»Ÿä½¿ç”¨çš„å†…æ ¸ã€‚ 4.3 ç¡®è®¤å½“å‰ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ # æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼š uname -r 4.4 æŸ¥è¯¢å·²å®‰è£…çš„æ‰€æœ‰å†…æ ¸ç‰ˆæœ¬ # ä½¿ç”¨ rpm å‘½ä»¤åˆ—å‡ºæ‰€æœ‰ä¸å†…æ ¸ç›¸å…³çš„åŒ…ï¼š rpm -qa | grep kernel è¿™å°†åˆ—å‡ºåŒ…æ‹¬å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸åœ¨å†…çš„æ‰€æœ‰å†…æ ¸ç‰ˆæœ¬ã€‚ 4.5 ç¡®å®šè¦åˆ é™¤çš„å†…æ ¸ # ç¡®ä¿ä¸è¦åˆ é™¤å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ã€‚é€šå¸¸ï¼Œå®‰å…¨çš„åšæ³•æ˜¯è‡³å°‘ä¿ç•™ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ—§å†…æ ¸ä½œä¸ºå¤‡ç”¨ã€‚ åˆ é™¤å¤šä½™çš„å†…æ ¸\nä½¿ç”¨ yum å‘½ä»¤æ¥åˆ é™¤ä¸å†éœ€è¦çš„å†…æ ¸ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¦åˆ é™¤ kernel-3.10.0-1127.el7.x86_64 è¿™ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥è¿è¡Œï¼š sudo yum remove kernel-ml-6.9.7-1.el7.elrepo.x86_64 å¯¹äºæ¯ä¸ªä¸éœ€è¦çš„å†…æ ¸é‡å¤æ­¤æ­¥éª¤ã€‚\n4.6 æ›´æ–°å¼•å¯¼åŠ è½½å™¨é…ç½® # åˆ é™¤å†…æ ¸åï¼Œéœ€è¦æ›´æ–° GRUB é…ç½®ä»¥åæ˜ è¿™äº›æ›´æ”¹ï¼š sudo grub2-mkconfig -o /boot/grub2/grub.cfg 4.7 é‡å¯ç³»ç»Ÿ # -ï¼ˆå¯é€‰ï¼‰å¦‚æœä½ ç¡®ä¿¡æ²¡æœ‰åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ï¼Œå¹¶ä¸”æ‰€æœ‰æ“ä½œéƒ½å·²å®Œæˆï¼Œå¯ä»¥é€‰æ‹©é‡å¯ç³»ç»Ÿä»¥åº”ç”¨æ›´æ”¹\nreboot ","date":"2024-03-29","externalUrl":null,"permalink":"/linux/20240329-1/","section":"Linuxé—®é¢˜è§£å†³","summary":"\u003ch1 class=\"relative group\"\u003e1. å‚è€ƒç½‘ç«™ \n    \u003cdiv id=\"1-%E5%8F%82%E8%80%83%E7%BD%91%E7%AB%99\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%8F%82%E8%80%83%E7%BD%91%E7%AB%99\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/yaxuan88521/article/details/129946104?spm=1001.2101.3001.6650.2\u0026amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-129946104-blog-136274022.235%5Ev43%5Econtrol\u0026amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-129946104-blog-136274022.235%5Ev43%5Econtrol\u0026amp;utm_relevant_index=5\" target=\"_blank\"\u003ecentos7 ç¦»çº¿å‡çº§/åœ¨çº¿å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸_centos7 red hat enterprise-CSDNåšå®¢\u003c/a\u003e\u003c/p\u003e","title":"Linuxç³»ç»Ÿå†…æ ¸å‡çº§","type":"blog"},{"content":"OwnerReferenceå’ŒFinalizers.\n1.OwnerReference # è®¾ç½®äº†OwnerReferenceä»¥åï¼Œä¼šåœ¨k8sèµ„æºé—´å»ºç«‹ä»å±å…³ç³»ï¼Œå½“åˆ é™¤å±ä¸»ï¼ˆå³çˆ¶èµ„æºï¼‰æ—¶ï¼Œå…¶ä»å±èµ„æºï¼ˆå³å­èµ„æºï¼‰ä¹Ÿä¼šè·Ÿç€åˆ é™¤ï¼Œè¿™å°±æ˜¯k8sä¸­çš„çº§è”åˆ é™¤\n1.1 OwnerReferenceä¸­çš„å±æ€§ # ApiVersionï¼šå±ä¸»èµ„æºçš„apiç‰ˆæœ¬ Kindï¼šå±ä¸»èµ„æºçš„ç±»å‹ï¼Œä¾‹å¦‚deploymentï¼Œpodç­‰ Nameï¼šå±ä¸»èµ„æºçš„åç§° Uidï¼šå±ä¸»èµ„æºçš„å”¯ä¸€æ ‡è¯† Controllerï¼šå½“Controllerå±æ€§ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºèµ„æºå¯¹è±¡æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼ˆå¦‚Deploymentã€ReplicaSetç­‰ï¼‰ï¼Œå®ƒç®¡ç†ç€å…¶ä»–èµ„æºå¯¹è±¡ï¼ˆå¦‚Podã€Serviceç­‰ï¼‰çš„åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸã€‚ä¸ªäººç†è§£ä¸ºï¼šå½“ä¸€ä¸ªèµ„æºæœ‰å¤šä¸ªå±ä¸»æ—¶ï¼Œå…¶ä¸­ä¸ºtrueçš„å±ä¸»ä¼šç›‘è§†è¯¥èµ„æºçš„å˜åŒ– BlockOwnerDeletionï¼šæ ¹æ®å®ƒæ¥åˆ¤æ–­ä»å±èµ„æºçš„åˆ é™¤æ˜¯å¦ä¼šé˜»å¡å±ä¸»èµ„æºçš„åˆ é™¤ï¼›å½“BlockOwnerDeletionä¸ºtrueï¼Œå¹¶ä¸”åˆ é™¤ç­–ç•¥ä¸ºå‰å°åˆ é™¤ï¼ˆforegroundï¼‰æ—¶ï¼Œå±ä¸»èµ„æºä¼šç­‰å¾…ä»å±èµ„æºåˆ å®Œåï¼Œæ‰ä¼šåˆ é™¤ï¼Œè¡¨ç°åœ¨go-clientæ¥å£ä¸­å³ä¸ºè¦ç­‰å¾…è¯¥å±ä¸»èµ„æºåŠå…¶æ‰€æœ‰ä»å±èµ„æºå®Œå…¨åˆ é™¤åï¼Œæ‰ä¼šè¿”å›è¯¥åˆ é™¤æ¥å£çš„ç»“æœï¼›å½“BlockOwnerDeletionè®¾ç½®ä¸ºfalseæ—¶ï¼Œä»å±èµ„æºçš„åˆ é™¤ä¸ä¼šé˜»å¡å±ä¸»èµ„æºçš„åˆ é™¤ã€‚ 1.2 k8sä¸­çš„åˆ é™¤ç­–ç•¥ # foregroundï¼ˆå‰å°åˆ é™¤ï¼‰ï¼šå…ˆåˆ é™¤ä»å±èµ„æºï¼Œå†åˆ é™¤å±ä¸»èµ„æºï¼ˆä¸€èˆ¬ä¸BlockOwnerDeletion=trueç»“åˆä½¿ç”¨ï¼‰ backgroundï¼ˆåå°åˆ é™¤ï¼‰ï¼šå…ˆåˆ é™¤å±ä¸»èµ„æºï¼Œå†åœ¨åå°åˆ é™¤ä»å±èµ„æºï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ orphanï¼ˆå­¤å„¿åˆ é™¤ï¼‰ï¼šä¸è€ƒè™‘OwnerReferenceï¼Œåªåˆ é™¤è¯¥èµ„æºï¼Œä¸çº§è”åˆ é™¤ 1.3 BlockOwnerDeletionä¸åˆ é™¤ç­–ç•¥ç»“åˆä½¿ç”¨ # ä»å±èµ„æºçš„BlockOwnerDeletionä¸ºtrueï¼Œåˆ é™¤ç­–ç•¥ä¸ºå‰å°åˆ é™¤ï¼šåˆ é™¤å±ä¸»èµ„æºæ—¶ï¼Œä¼šç­‰å¾…ä»å±èµ„æºè¢«åˆ é™¤åï¼Œæ‰ä¼šåˆ é™¤å±ä¸»èµ„æºï¼Œç„¶åè¿”å›åˆ é™¤ç»“æœï¼›ä¸go-clientç»“åˆæ¥çœ‹å°±æ˜¯ï¼Œç­‰å±ä¸»èµ„æºå’Œå…¶æ‰€æœ‰çš„ä»å±èµ„æºéƒ½è¢«åˆ é™¤åï¼Œåˆ é™¤æ¥å£æ‰ä¼šè¿”å›ç»“æœ ä»å±èµ„æºçš„BlockOwnerDeletionä¸ºfalseï¼Œåˆ é™¤ç­–ç•¥ä¸ºå‰å°åˆ é™¤æ—¶ï¼šåˆ é™¤å±ä¸»èµ„æºæ—¶ï¼Œä¸ä¼šç­‰å¾…ä»å±èµ„æºçš„åˆ é™¤ï¼Œä¼šç›´æ¥è¿”å›åˆ é™¤ç»“æœï¼›ä¸go-clientç»“åˆæ¥çœ‹å°±æ˜¯ï¼Œåˆ é™¤æ¥å£ä¼šç«‹å³è¿”å›ç»“æœ åˆ é™¤ç­–ç•¥ä¸ºåå°åˆ é™¤æ—¶ï¼Œéƒ½ä¼šç›´æ¥è¿”å›åˆ é™¤ç»“æœï¼Œåå°åˆ é™¤ä¸ä¼šç­‰å¾…ä»å±èµ„æºçš„åˆ é™¤ 2.Finalizers # Finalizersæ˜¯metadataä¸­çš„ä¸€ä¸ªæ•°ç»„ç±»å‹çš„æ ‡ç­¾ï¼Œå½“k8sèµ„æºå­˜åœ¨Finalizersæ ‡ç­¾ï¼Œåˆ é™¤è¯¥èµ„æºæ—¶ï¼Œä¼šé˜»å¡è¯¥èµ„æºçš„åˆ é™¤ï¼Œç›´åˆ°Finalizersä¸ºç©ºæ—¶ï¼Œæ‰ä¼šå°†è¯¥èµ„æºçœŸæ­£åˆ é™¤\n2.1 Finalizersçš„å·¥ä½œåŸç† # å½“åˆ é™¤å­˜åœ¨Finalizersæ ‡ç­¾çš„èµ„æºæ—¶ï¼Œå¤„ç†åˆ é™¤è¯·æ±‚çš„apiä¼šä¸ºè¯¥èµ„æºçš„metadataæ ‡ç­¾ä¸­æ·»åŠ DeletionTimeStampæ ‡ç­¾ï¼ˆè¯¥æ ‡ç­¾ä¸ºä¸‹å‘åˆ é™¤è¯·æ±‚çš„æ—¶é—´ï¼‰ï¼Œå¹¶ä¸”ä¼šæ›´æ”¹è¯¥èµ„æºçš„çŠ¶æ€ä¸ºTerminatingçŠ¶æ€ï¼Œæ­¤æ—¶è¯¥èµ„æºå¹¶æ²¡æœ‰è¢«å®Œå…¨åˆ é™¤ï¼Œå¤„äºåªå¯è§çŠ¶æ€ï¼›æ­¤æ—¶æ§åˆ¶å™¨ä¼šå°½é‡æ»¡è¶³è¯¥èµ„æºçš„Finalizersçš„è¦æ±‚ï¼Œæ¯è¾¾åˆ°ä¸€ä¸ªè¦æ±‚ï¼Œå°±ä¼šåˆ å»è¯¥Finalizersï¼Œç›´åˆ°æ‰€æœ‰çš„Finalizerså…¨è¢«åˆ é™¤æ—¶ï¼Œè¯¥èµ„æºæ‰ä¼šè¢«çœŸæ­£åˆ é™¤\n","date":"2024-03-11","externalUrl":null,"permalink":"/kubernetes/20240311-4/","section":"Kubernetes","summary":"\u003cp\u003eOwnerReferenceå’ŒFinalizers.\u003c/p\u003e","title":"ã€KubernetesçŸ¥è¯†ã€‘OwnerReferenceå’ŒFinalizers","type":"blog"},{"content":"","date":"2024-03-11","externalUrl":null,"permalink":"/tags/pod/","section":"Tags","summary":"","title":"Pod","type":"tags"},{"content":"","date":"2024-03-11","externalUrl":null,"permalink":"/tags/spec/","section":"Tags","summary":"","title":"Spec","type":"tags"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/tags/longhorn/","section":"Tags","summary":"","title":"Longhorn","type":"tags"},{"content":" 1. å‰è¨€ # Longhorné‡‡ç”¨å®¹å™¨å’Œå¾®æœåŠ¡æŠ€æœ¯å®ç°äº†åˆ†å¸ƒå¼å—å­˜å‚¨ã€‚Longhornä¸ºæ¯ä¸ªå—è®¾å¤‡å·åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å­˜å‚¨æ§åˆ¶å™¨ï¼Œå¹¶ä¸”å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨å‰¯æœ¬ä¸­çš„å·è¿›è¡Œå®æ—¶å¤åˆ¶ã€‚\nLonghornçš„å·å¯ä»¥ä½œä¸ºKubernetesé›†ç¾¤ä¸­åˆ†å¸ƒå¼æœ‰çŠ¶æ€åº”ç”¨çš„å­˜å‚¨ã€‚ å¯ä»¥å°†å—å­˜å‚¨åˆ’åˆ†ä¸ºLonghornå·ï¼Œä»¥ä¾¿åœ¨æœ‰æˆ–æ²¡æœ‰äº‘æä¾›å•†çš„æƒ…å†µä¸‹ä½¿ç”¨Kuberneteså·ã€‚ å¯ä»¥è·¨èŠ‚ç‚¹å’Œæ•°æ®ä¸­å¿ƒå¤åˆ¶å—å­˜å‚¨ï¼Œä»è€Œæé«˜å¯ç”¨æ€§ã€‚ å¯ä»¥åœ¨å¤–éƒ¨å­˜å‚¨ä¸Šå­˜å‚¨å¤‡ä»½æ•°æ®ï¼Œä¾‹å¦‚ï¼šNFSæˆ–AWS S3ã€‚ å¯ä»¥åˆ›å»ºè·¨ç¾¤é›†ç¾éš¾æ¢å¤å·ï¼Œä»¥ä¾¿ä»å¤‡ç”¨çš„Kubernetesé›†ç¾¤çš„å¤‡ä»½ä¸­å¿«é€Ÿæ¢å¤æ¥è‡ªä¸»Kubernetesç¾¤é›†çš„æ•°æ®ã€‚ å¯ä»¥ä¸ºå·è®¾ç½®è®¡åˆ’ï¼Œå¯¹å·å®šæœŸç”Ÿæˆå¿«ç…§ï¼Œå¹¶æŠŠå¿«ç…§å¤‡ä»½åˆ°NFSæˆ–è€…å…¼å®¹S3çš„å¤‡ç”¨å­˜å‚¨ä¸­ã€‚ æ”¯æŒä»å¤‡ä»½ä¸­æ¢å¤å·ã€‚ æ”¯æŒä¸ä¸­æ–­å·æœåŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œå‡çº§ã€‚ 1.1 å‰æ # ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„Kubernetesé›†ç¾¤ é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹å·²ç»å®‰è£…ä¸‹åˆ—è½¯ä»¶åŒ…ï¼Œå¹¶æ­£å¸¸å¯åŠ¨ open-iscsiï¼ˆiscsidæœåŠ¡ï¼‰ å®‰è£…ï¼š yum install iscsi-initiator-utils 2. å®‰è£… # é‡‡ç”¨helmå®‰è£…\n2.1 æ·»åŠ helmæº # helm repo add longhorn https://charts.longhorn.io 2,2 æ›´æ–°helmæº # helm repo update 2.3ä¸‹è½½helmåŒ…å¹¶ä¿®æ”¹é…ç½® # ä¸‹è½½å¹¶è§£å‹ # ä¸‹è½½åŒ… helm fetch longhorn/longhorn # è§£å‹åŒ… tar xf longhorn-1.6.2.tgz ä¿®æ”¹é…ç½®æ–‡ä»¶ values.yaml # Default values for longhorn. # This is a YAML-formatted file. # Declare variables to be passed into your templates. global: cattle: # -- Default system registry. systemDefaultRegistry: \u0026#34;\u0026#34; windowsCluster: # -- Setting that allows Longhorn to run on a Rancher Windows cluster. enabled: false # -- Toleration for Linux nodes that can run user-deployed Longhorn components. tolerations: - key: \u0026#34;cattle.io/os\u0026#34; value: \u0026#34;linux\u0026#34; effect: \u0026#34;NoSchedule\u0026#34; operator: \u0026#34;Equal\u0026#34; # -- Node selector for Linux nodes that can run user-deployed Longhorn components. nodeSelector: kubernetes.io/os: \u0026#34;linux\u0026#34; defaultSetting: # -- Toleration for system-managed Longhorn components. taintToleration: cattle.io/os=linux:NoSchedule # -- Node selector for system-managed Longhorn components. systemManagedComponentsNodeSelector: kubernetes.io/os:linux networkPolicies: # -- Setting that allows you to enable network policies that control access to Longhorn pods. enabled: false # -- Distribution that determines the policy for allowing access for an ingress. (Options: \u0026#34;k3s\u0026#34;, \u0026#34;rke2\u0026#34;, \u0026#34;rke1\u0026#34;) type: \u0026#34;k3s\u0026#34; image: longhorn: engine: # -- Repository for the Longhorn Engine image. repository: longhornio/longhorn-engine # -- Specify Longhorn engine image tag tag: v1.6.2 manager: # -- Repository for the Longhorn Manager image. repository: longhornio/longhorn-manager # -- Specify Longhorn manager image tag tag: v1.6.2 ui: # -- Repository for the Longhorn UI image. repository: longhornio/longhorn-ui # -- Specify Longhorn ui image tag tag: v1.6.2 instanceManager: # -- Repository for the Longhorn Instance Manager image. repository: longhornio/longhorn-instance-manager # -- Specify Longhorn instance manager image tag tag: v1.6.2 shareManager: # -- Repository for the Longhorn Share Manager image. repository: longhornio/longhorn-share-manager # -- Specify Longhorn share manager image tag tag: v1.6.2 backingImageManager: # -- Repository for the Backing Image Manager image. When unspecified, Longhorn uses the default value. repository: longhornio/backing-image-manager # -- Specify Longhorn backing image manager image tag tag: v1.6.2 supportBundleKit: # -- Repository for the Longhorn Support Bundle Manager image. repository: longhornio/support-bundle-kit # -- Tag for the Longhorn Support Bundle Manager image. tag: v0.0.37 csi: attacher: # -- Repository for the CSI attacher image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-attacher # -- Tag for the CSI attacher image. When unspecified, Longhorn uses the default value. tag: v4.5.1 provisioner: # -- Repository for the CSI Provisioner image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-provisioner # -- Tag for the CSI Provisioner image. When unspecified, Longhorn uses the default value. tag: v3.6.4 nodeDriverRegistrar: # -- Repository for the CSI Node Driver Registrar image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-node-driver-registrar # -- Tag for the CSI Node Driver Registrar image. When unspecified, Longhorn uses the default value. tag: v2.9.2 resizer: # -- Repository for the CSI Resizer image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-resizer # -- Tag for the CSI Resizer image. When unspecified, Longhorn uses the default value. tag: v1.10.1 snapshotter: # -- Repository for the CSI Snapshotter image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-snapshotter # -- Tag for the CSI Snapshotter image. When unspecified, Longhorn uses the default value. tag: v6.3.4 livenessProbe: # -- Repository for the CSI liveness probe image. When unspecified, Longhorn uses the default value. repository: longhornio/livenessprobe # -- Tag for the CSI liveness probe image. When unspecified, Longhorn uses the default value. tag: v2.12.0 openshift: oauthProxy: # -- Repository for the OAuth Proxy image. This setting applies only to OpenShift users. repository: longhornio/openshift-origin-oauth-proxy # -- Tag for the OAuth Proxy image. This setting applies only to OpenShift users. Specify OCP/OKD version 4.1 or later. The latest stable version is 4.14. tag: 4.14 # -- Image pull policy that applies to all user-deployed Longhorn components, such as Longhorn Manager, Longhorn driver, and Longhorn UI. pullPolicy: IfNotPresent # ä¿®æ”¹uiç•Œé¢çš„serviceç±»å‹ä¸ºNodePort service: ui: # -- Service type for Longhorn UI. (Options: \u0026#34;ClusterIP\u0026#34;, \u0026#34;NodePort\u0026#34;, \u0026#34;LoadBalancer\u0026#34;, \u0026#34;Rancher-Proxy\u0026#34;) type: NodePort # -- NodePort port number for Longhorn UI. When unspecified, Longhorn selects a free port between 30000 and 32767. nodePort: null manager: # -- Service type for Longhorn Manager. type: ClusterIP # -- NodePort port number for Longhorn Manager. When unspecified, Longhorn selects a free port between 30000 and 32767. nodePort: \u0026#34;\u0026#34; # çœ‹éœ€æ±‚è®¾ç½®æ˜¯å¦ä¸ºé»˜è®¤storageclassï¼ˆdefaultClassï¼‰ï¼Œä¿®æ”¹pvcç­–ç•¥ä¸ºRetain persistence: # -- Setting that allows you to specify the default Longhorn StorageClass. defaultClass: true # -- Filesystem type of the default Longhorn StorageClass. defaultFsType: ext4 # -- mkfs parameters of the default Longhorn StorageClass. defaultMkfsParams: \u0026#34;\u0026#34; # -- Replica count of the default Longhorn StorageClass. defaultClassReplicaCount: 1 # -- Data locality of the default Longhorn StorageClass. (Options: \u0026#34;disabled\u0026#34;, \u0026#34;best-effort\u0026#34;) defaultDataLocality: disabled # -- Reclaim policy that provides instructions for handling of a volume after its claim is released. (Options: \u0026#34;Retain\u0026#34;, \u0026#34;Delete\u0026#34;) reclaimPolicy: Retain # -- Setting that allows you to enable live migration of a Longhorn volume from one node to another. migratable: false # -- Set NFS mount options for Longhorn StorageClass for RWX volumes nfsOptions: \u0026#34;\u0026#34; recurringJobSelector: # -- Setting that allows you to enable the recurring job selector for a Longhorn StorageClass. enable: false # -- Recurring job selector for a Longhorn StorageClass. Ensure that quotes are used correctly when specifying job parameters. (Example: `[{\u0026#34;name\u0026#34;:\u0026#34;backup\u0026#34;, \u0026#34;isGroup\u0026#34;:true}]`) jobList: [] backingImage: # -- Setting that allows you to use a backing image in a Longhorn StorageClass. enable: false # -- Backing image to be used for creating and restoring volumes in a Longhorn StorageClass. When no backing images are available, specify the data source type and parameters that Longhorn can use to create a backing image. name: ~ # -- Data source type of a backing image used in a Longhorn StorageClass. # If the backing image exists in the cluster, Longhorn uses this setting to verify the image. # If the backing image does not exist, Longhorn creates one using the specified data source type. dataSourceType: ~ # -- Data source parameters of a backing image used in a Longhorn StorageClass. # You can specify a JSON string of a map. (Example: `\u0026#39;{\\\u0026#34;url\\\u0026#34;:\\\u0026#34;https://backing-image-example.s3-region.amazonaws.com/test-backing-image\\\u0026#34;}\u0026#39;`) dataSourceParameters: ~ # -- Expected SHA-512 checksum of a backing image used in a Longhorn StorageClass. expectedChecksum: ~ defaultNodeSelector: # -- Setting that allows you to enable the node selector for the default Longhorn StorageClass. enable: false # -- Node selector for the default Longhorn StorageClass. Longhorn uses only nodes with the specified tags for storing volume data. (Examples: \u0026#34;storage,fast\u0026#34;) selector: \u0026#34;\u0026#34; # -- Setting that allows you to enable automatic snapshot removal during filesystem trim for a Longhorn StorageClass. (Options: \u0026#34;ignored\u0026#34;, \u0026#34;enabled\u0026#34;, \u0026#34;disabled\u0026#34;) removeSnapshotsDuringFilesystemTrim: ignored preUpgradeChecker: # -- Setting that allows Longhorn to perform pre-upgrade checks. Disable this setting when installing Longhorn using Argo CD or other GitOps solutions. jobEnabled: true # -- Setting that allows Longhorn to perform upgrade version checks after starting the Longhorn Manager DaemonSet Pods. Disabling this setting also disables `preUpgradeChecker.jobEnabled`. Longhorn recommends keeping this setting enabled. upgradeVersionCheck: true csi: # -- kubelet root directory. When unspecified, Longhorn uses the default value. kubeletRootDir: ~ # -- Replica count of the CSI Attacher. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). attacherReplicaCount: ~ # -- Replica count of the CSI Provisioner. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). provisionerReplicaCount: ~ # -- Replica count of the CSI Resizer. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). resizerReplicaCount: ~ # -- Replica count of the CSI Snapshotter. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). snapshotterReplicaCount: ~ defaultSettings: # -- Endpoint used to access the backupstore. (Options: \u0026#34;NFS\u0026#34;, \u0026#34;CIFS\u0026#34;, \u0026#34;AWS\u0026#34;, \u0026#34;GCP\u0026#34;, \u0026#34;AZURE\u0026#34;) backupTarget: ~ # -- Name of the Kubernetes secret associated with the backup target. backupTargetCredentialSecret: ~ # -- Setting that allows Longhorn to automatically attach a volume and create snapshots or backups when recurring jobs are run. allowRecurringJobWhileVolumeDetached: ~ # -- Setting that allows Longhorn to automatically create a default disk only on nodes with the label \u0026#34;node.longhorn.io/create-default-disk=true\u0026#34; (if no other disks exist). When this setting is disabled, Longhorn creates a default disk on each node that is added to the cluster. createDefaultDiskLabeledNodes: true # -- Default path for storing data on a host. The default value is \u0026#34;/var/lib/longhorn/\u0026#34;. # è®¾ç½®longhornæŒ‚è½½çš„æœ¬åœ°å­˜å‚¨è·¯å¾„ï¼Œ/data/longhorn defaultDataPath: /data1/longhorn # -- Default data locality. A Longhorn volume has data locality if a local replica of the volume exists on the same node as the pod that is using the volume. defaultDataLocality: ~ # -- Setting that allows scheduling on nodes with healthy replicas of the same volume. This setting is disabled by default. replicaSoftAntiAffinity: ~ # -- Setting that automatically rebalances replicas when an available node is discovered. replicaAutoBalance: ~ # -- Percentage of storage that can be allocated relative to hard drive capacity. The default value is \u0026#34;100\u0026#34;. storageOverProvisioningPercentage: ~ # -- Percentage of minimum available disk capacity. When the minimum available capacity exceeds the total available capacity, the disk becomes unschedulable until more space is made available for use. The default value is \u0026#34;25\u0026#34;. storageMinimalAvailablePercentage: ~ # -- Percentage of disk space that is not allocated to the default disk on each new Longhorn node. storageReservedPercentageForDefaultDisk: ~ # -- Upgrade Checker that periodically checks for new Longhorn versions. When a new version is available, a notification appears on the Longhorn UI. This setting is enabled by default upgradeChecker: ~ # -- Default number of replicas for volumes created using the Longhorn UI. For Kubernetes configuration, modify the `numberOfReplicas` field in the StorageClass. The default value is \u0026#34;3\u0026#34;. defaultReplicaCount: ~ # -- Default Longhorn StorageClass. \u0026#34;storageClassName\u0026#34; is assigned to PVs and PVCs that are created for an existing Longhorn volume. \u0026#34;storageClassName\u0026#34; can also be used as a label, so it is possible to use a Longhorn StorageClass to bind a workload to an existing PV without creating a Kubernetes StorageClass object. The default value is \u0026#34;longhorn-static\u0026#34;. defaultLonghornStaticStorageClass: ~ # -- Number of seconds that Longhorn waits before checking the backupstore for new backups. The default value is \u0026#34;300\u0026#34;. When the value is \u0026#34;0\u0026#34;, polling is disabled. backupstorePollInterval: ~ # -- Number of minutes that Longhorn keeps a failed backup resource. When the value is \u0026#34;0\u0026#34;, automatic deletion is disabled. failedBackupTTL: ~ # -- Setting that restores recurring jobs from a backup volume on a backup target and creates recurring jobs if none exist during backup restoration. restoreVolumeRecurringJobs: ~ # -- Maximum number of successful recurring backup and snapshot jobs to be retained. When the value is \u0026#34;0\u0026#34;, a history of successful recurring jobs is not retained. recurringSuccessfulJobsHistoryLimit: ~ # -- Maximum number of failed recurring backup and snapshot jobs to be retained. When the value is \u0026#34;0\u0026#34;, a history of failed recurring jobs is not retained. recurringFailedJobsHistoryLimit: ~ # -- Maximum number of snapshots or backups to be retained. recurringJobMaxRetention: ~ # -- Maximum number of failed support bundles that can exist in the cluster. When the value is \u0026#34;0\u0026#34;, Longhorn automatically purges all failed support bundles. supportBundleFailedHistoryLimit: ~ # -- Taint or toleration for system-managed Longhorn components. # Specify values using a semicolon-separated list in `kubectl taint` syntax (Example: key1=value1:effect; key2=value2:effect). taintToleration: ~ # -- Node selector for system-managed Longhorn components. systemManagedComponentsNodeSelector: ~ # -- PriorityClass for system-managed Longhorn components. # This setting can help prevent Longhorn components from being evicted under Node Pressure. # Notice that this will be applied to Longhorn user-deployed components by default if there are no priority class values set yet, such as `longhornManager.priorityClass`. priorityClass: \u0026amp;defaultPriorityClassNameRef \u0026#34;longhorn-critical\u0026#34; # -- Setting that allows Longhorn to automatically salvage volumes when all replicas become faulty (for example, when the network connection is interrupted). Longhorn determines which replicas are usable and then uses these replicas for the volume. This setting is enabled by default. autoSalvage: ~ # -- Setting that allows Longhorn to automatically delete a workload pod that is managed by a controller (for example, daemonset) whenever a Longhorn volume is detached unexpectedly (for example, during Kubernetes upgrades). After deletion, the controller restarts the pod and then Kubernetes handles volume reattachment and remounting. autoDeletePodWhenVolumeDetachedUnexpectedly: ~ # -- Setting that prevents Longhorn Manager from scheduling replicas on a cordoned Kubernetes node. This setting is enabled by default. disableSchedulingOnCordonedNode: ~ # -- Setting that allows Longhorn to schedule new replicas of a volume to nodes in the same zone as existing healthy replicas. Nodes that do not belong to any zone are treated as existing in the zone that contains healthy replicas. When identifying zones, Longhorn relies on the label \u0026#34;topology.kubernetes.io/zone=\u0026lt;Zone name of the node\u0026gt;\u0026#34; in the Kubernetes node object. replicaZoneSoftAntiAffinity: ~ # -- Setting that allows scheduling on disks with existing healthy replicas of the same volume. This setting is enabled by default. replicaDiskSoftAntiAffinity: ~ # -- Policy that defines the action Longhorn takes when a volume is stuck with a StatefulSet or Deployment pod on a node that failed. nodeDownPodDeletionPolicy: ~ # -- Policy that defines the action Longhorn takes when a node with the last healthy replica of a volume is drained. nodeDrainPolicy: ~ # -- Setting that allows automatic detaching of manually-attached volumes when a node is cordoned. detachManuallyAttachedVolumesWhenCordoned: ~ # -- Number of seconds that Longhorn waits before reusing existing data on a failed replica instead of creating a new replica of a degraded volume. replicaReplenishmentWaitInterval: ~ # -- Maximum number of replicas that can be concurrently rebuilt on each node. concurrentReplicaRebuildPerNodeLimit: ~ # -- Maximum number of volumes that can be concurrently restored on each node using a backup. When the value is \u0026#34;0\u0026#34;, restoration of volumes using a backup is disabled. concurrentVolumeBackupRestorePerNodeLimit: ~ # -- Setting that disables the revision counter and thereby prevents Longhorn from tracking all write operations to a volume. When salvaging a volume, Longhorn uses properties of the \u0026#34;volume-head-xxx.img\u0026#34; file (the last file size and the last time the file was modified) to select the replica to be used for volume recovery. This setting applies only to volumes created using the Longhorn UI. disableRevisionCounter: ~ # -- Image pull policy for system-managed pods, such as Instance Manager, engine images, and CSI Driver. Changes to the image pull policy are applied only after the system-managed pods restart. systemManagedPodsImagePullPolicy: ~ # -- Setting that allows you to create and attach a volume without having all replicas scheduled at the time of creation. allowVolumeCreationWithDegradedAvailability: ~ # -- Setting that allows Longhorn to automatically clean up the system-generated snapshot after replica rebuilding is completed. autoCleanupSystemGeneratedSnapshot: ~ # -- Setting that allows Longhorn to automatically clean up the snapshot generated by a recurring backup job. autoCleanupRecurringJobBackupSnapshot: ~ # -- Maximum number of engines that are allowed to concurrently upgrade on each node after Longhorn Manager is upgraded. When the value is \u0026#34;0\u0026#34;, Longhorn does not automatically upgrade volume engines to the new default engine image version. concurrentAutomaticEngineUpgradePerNodeLimit: ~ # -- Number of minutes that Longhorn waits before cleaning up the backing image file when no replicas in the disk are using it. backingImageCleanupWaitInterval: ~ # -- Number of seconds that Longhorn waits before downloading a backing image file again when the status of all image disk files changes to \u0026#34;failed\u0026#34; or \u0026#34;unknown\u0026#34;. backingImageRecoveryWaitInterval: ~ # -- Percentage of the total allocatable CPU resources on each node to be reserved for each instance manager pod when the V1 Data Engine is enabled. The default value is \u0026#34;12\u0026#34;. guaranteedInstanceManagerCPU: ~ # -- Setting that notifies Longhorn that the cluster is using the Kubernetes Cluster Autoscaler. kubernetesClusterAutoscalerEnabled: ~ # -- Setting that allows Longhorn to automatically delete an orphaned resource and the corresponding data (for example, stale replicas). Orphaned resources on failed or unknown nodes are not automatically cleaned up. orphanAutoDeletion: ~ # -- Storage network for in-cluster traffic. When unspecified, Longhorn uses the Kubernetes cluster network. storageNetwork: ~ # -- Flag that prevents accidental uninstallation of Longhorn. deletingConfirmationFlag: ~ # -- Timeout between the Longhorn Engine and replicas. Specify a value between \u0026#34;8\u0026#34; and \u0026#34;30\u0026#34; seconds. The default value is \u0026#34;8\u0026#34;. engineReplicaTimeout: ~ # -- Setting that allows you to enable and disable snapshot hashing and data integrity checks. snapshotDataIntegrity: ~ # -- Setting that allows disabling of snapshot hashing after snapshot creation to minimize impact on system performance. snapshotDataIntegrityImmediateCheckAfterSnapshotCreation: ~ # -- Setting that defines when Longhorn checks the integrity of data in snapshot disk files. You must use the Unix cron expression format. snapshotDataIntegrityCronjob: ~ # -- Setting that allows Longhorn to automatically mark the latest snapshot and its parent files as removed during a filesystem trim. Longhorn does not remove snapshots containing multiple child files. removeSnapshotsDuringFilesystemTrim: ~ # -- Setting that allows fast rebuilding of replicas using the checksum of snapshot disk files. Before enabling this setting, you must set the snapshot-data-integrity value to \u0026#34;enable\u0026#34; or \u0026#34;fast-check\u0026#34;. fastReplicaRebuildEnabled: ~ # -- Number of seconds that an HTTP client waits for a response from a File Sync server before considering the connection to have failed. replicaFileSyncHttpClientTimeout: ~ # -- Log levels that indicate the type and severity of logs in Longhorn Manager. The default value is \u0026#34;Info\u0026#34;. (Options: \u0026#34;Panic\u0026#34;, \u0026#34;Fatal\u0026#34;, \u0026#34;Error\u0026#34;, \u0026#34;Warn\u0026#34;, \u0026#34;Info\u0026#34;, \u0026#34;Debug\u0026#34;, \u0026#34;Trace\u0026#34;) logLevel: ~ # -- Setting that allows you to specify a backup compression method. backupCompressionMethod: ~ # -- Maximum number of worker threads that can concurrently run for each backup. backupConcurrentLimit: ~ # -- Maximum number of worker threads that can concurrently run for each restore operation. restoreConcurrentLimit: ~ # -- Setting that allows you to enable the V1 Data Engine. v1DataEngine: ~ # -- Setting that allows you to enable the V2 Data Engine, which is based on the Storage Performance Development Kit (SPDK). The V2 Data Engine is a preview feature and should not be used in production environments. v2DataEngine: ~ # -- Setting that allows you to configure maximum huge page size (in MiB) for the V2 Data Engine. v2DataEngineHugepageLimit: ~ # -- Setting that allows rebuilding of offline replicas for volumes using the V2 Data Engine. offlineReplicaRebuilding: ~ # -- Number of millicpus on each node to be reserved for each Instance Manager pod when the V2 Data Engine is enabled. The default value is \u0026#34;1250\u0026#34;. v2DataEngineGuaranteedInstanceManagerCPU: ~ # -- Setting that allows scheduling of empty node selector volumes to any node. allowEmptyNodeSelectorVolume: ~ # -- Setting that allows scheduling of empty disk selector volumes to any disk. allowEmptyDiskSelectorVolume: ~ # -- Setting that allows Longhorn to periodically collect anonymous usage data for product improvement purposes. Longhorn sends collected data to the [Upgrade Responder](https://github.com/longhorn/upgrade-responder) server, which is the data source of the Longhorn Public Metrics Dashboard (https://metrics.longhorn.io). The Upgrade Responder server does not store data that can be used to identify clients, including IP addresses. allowCollectingLonghornUsageMetrics: ~ # -- Setting that temporarily prevents all attempts to purge volume snapshots. disableSnapshotPurge: ~ # -- Maximum snapshot count for a volume. The value should be between 2 to 250 snapshotMaxCount: ~ privateRegistry: # -- Setting that allows you to create a private registry secret. createSecret: ~ # -- URL of a private registry. When unspecified, Longhorn uses the default system registry. registryUrl: ~ # -- User account used for authenticating with a private registry. registryUser: ~ # -- Password for authenticating with a private registry. registryPasswd: ~ # -- Kubernetes secret that allows you to pull images from a private registry. This setting applies only when creation of private registry secrets is enabled. You must include the private registry name in the secret name. registrySecret: ~ longhornManager: log: # -- Format of Longhorn Manager logs. (Options: \u0026#34;plain\u0026#34;, \u0026#34;json\u0026#34;) format: plain # -- PriorityClass for Longhorn Manager. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn Manager on nodes allowed to run Longhorn Manager. tolerations: [] ## If you want to set tolerations for Longhorn Manager DaemonSet, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn Manager. Specify the nodes allowed to run Longhorn Manager. nodeSelector: {} ## If you want to set node selector for Longhorn Manager DaemonSet, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; # -- Annotation for the Longhorn Manager service. serviceAnnotations: {} ## If you want to set annotations for the Longhorn Manager service, delete the `{}` in the line above ## and uncomment this example block # annotation-key1: \u0026#34;annotation-value1\u0026#34; # annotation-key2: \u0026#34;annotation-value2\u0026#34; longhornDriver: # -- PriorityClass for Longhorn Driver. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn Driver on nodes allowed to run Longhorn components. tolerations: [] ## If you want to set tolerations for Longhorn Driver Deployer Deployment, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn Driver. Specify the nodes allowed to run Longhorn Driver. nodeSelector: {} ## If you want to set node selector for Longhorn Driver Deployer Deployment, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; longhornUI: # -- Replica count for Longhorn UI. replicas: 1 # -- PriorityClass for Longhorn UI. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn UI on nodes allowed to run Longhorn components. tolerations: [] ## If you want to set tolerations for Longhorn UI Deployment, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn UI. Specify the nodes allowed to run Longhorn UI. nodeSelector: {} ## If you want to set node selector for Longhorn UI Deployment, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; ingress: # -- Setting that allows Longhorn to generate ingress records for the Longhorn UI service. enabled: false # -- IngressClass resource that contains ingress configuration, including the name of the Ingress controller. # ingressClassName can replace the kubernetes.io/ingress.class annotation used in earlier Kubernetes releases. ingressClassName: ~ # -- Hostname of the Layer 7 load balancer. host: sslip.io # -- Setting that allows you to enable TLS on ingress records. tls: false # -- Setting that allows you to enable secure connections to the Longhorn UI service via port 443. secureBackends: false # -- TLS secret that contains the private key and certificate to be used for TLS. This setting applies only when TLS is enabled on ingress records. tlsSecret: longhorn.local-tls # -- Default ingress path. You can access the Longhorn UI by following the full ingress path {{host}}+{{path}}. path: / ## If you\u0026#39;re using kube-lego, you will want to add: ## kubernetes.io/tls-acme: true ## ## For a full list of possible ingress annotations, please see ## ref: https://github.com/kubernetes/ingress-nginx/blob/master/docs/annotations.md ## ## If tls is set to true, annotation ingress.kubernetes.io/secure-backends: \u0026#34;true\u0026#34; will automatically be set # -- Ingress annotations in the form of key-value pairs. annotations: # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: true # -- Secret that contains a TLS private key and certificate. Use secrets if you want to use your own certificates to secure ingresses. secrets: ## If you\u0026#39;re providing your own certificates, please use this to add the certificates as secrets ## key and certificate should start with -----BEGIN CERTIFICATE----- or ## -----BEGIN RSA PRIVATE KEY----- ## ## name should line up with a tlsSecret set further up ## If you\u0026#39;re using kube-lego, this is unneeded, as it will create the secret for you if it is not set ## ## It is also possible to create and manage the certificates outside of this helm chart ## Please see README.md for more information # - name: longhorn.local-tls # key: # certificate: # -- Setting that allows you to enable pod security policies (PSPs) that allow privileged Longhorn pods to start. This setting applies only to clusters running Kubernetes 1.25 and earlier, and with the built-in Pod Security admission controller enabled. enablePSP: false # -- Specify override namespace, specifically this is useful for using longhorn as sub-chart and its release namespace is not the `longhorn-system`. namespaceOverride: \u0026#34;\u0026#34; # -- Annotation for the Longhorn Manager DaemonSet pods. This setting is optional. annotations: {} serviceAccount: # -- Annotations to add to the service account annotations: {} metrics: serviceMonitor: # -- Setting that allows the creation of a Prometheus ServiceMonitor resource for Longhorn Manager components. enabled: false ## openshift settings openshift: # -- Setting that allows Longhorn to integrate with OpenShift. enabled: false ui: # -- Route for connections between Longhorn and the OpenShift web console. route: \u0026#34;longhorn-ui\u0026#34; # -- Port for accessing the OpenShift web console. port: 443 # -- Port for proxy that provides access to the OpenShift web console. proxy: 8443 # -- Setting that allows Longhorn to generate code coverage profiles. enableGoCoverDir: false 2.4 éƒ¨ç½² # 2.4.1 longhornå®‰è£…å‡†å¤‡å·¥ä½œ # å„å­˜å‚¨èŠ‚ç‚¹åˆ›å»ºç›®å½•åŠæŒ‚è½½ # å°†å­˜å‚¨ç›˜æŒ‚è½½åˆ°/data1æ‰€åœ¨ç›®å½•ï¼Œå¹¶åˆ›å»ºlonghornç›®å½• mkdir /home/data1/longhorn å­˜å‚¨èŠ‚ç‚¹ä½¿ç”¨å‘½ä»¤æ‰“æ ‡ç­¾ï¼š kubectl label nodes node75 node77 node78 node.longhorn.io/create-default-disk=true å®‰è£…longhornæ‰€éœ€ç³»ç»Ÿä¾èµ– yum install -y nfs-utils yum --setopt=tsflags=noscripts install iscsi-initiator-utils echo \u0026#34;InitiatorName=$(/sbin/iscsi-iname)\u0026#34; \u0026gt; /etc/iscsi/initiatorname.iscsi systemctl enable iscsid systemctl start iscsid wget https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 -O /usr/local/bin/jq chmod +x /usr/local/bin/jq longhornç¯å¢ƒæ£€æŸ¥è„šæœ¬ æ£€æŸ¥ç¯å¢ƒæ˜¯å¦å‡†å¤‡å¥½äº†longhornæ‰€éœ€ä¾èµ– #!/bin/bash NVME_CLI_VERSION=\u0026#34;1.12\u0026#34; ###################################################### # Log ###################################################### export RED=\u0026#39;\\x1b[0;31m\u0026#39; export GREEN=\u0026#39;\\x1b[38;5;22m\u0026#39; export CYAN=\u0026#39;\\x1b[36m\u0026#39; export YELLOW=\u0026#39;\\x1b[33m\u0026#39; export NO_COLOR=\u0026#39;\\x1b[0m\u0026#39; if [ -z \u0026#34;${LOG_TITLE}\u0026#34; ]; then LOG_TITLE=\u0026#39;\u0026#39; fi if [ -z \u0026#34;${LOG_LEVEL}\u0026#34; ]; then LOG_LEVEL=\u0026#34;INFO\u0026#34; fi debug() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${GREEN}[DEBUG]${log_title} ${NO_COLOR}$1\u0026#34; fi } info() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${CYAN}[INFO] ${log_title} ${NO_COLOR}$1\u0026#34; fi } warn() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;WARN\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${YELLOW}[WARN] ${log_title} ${NO_COLOR}$1\u0026#34; fi } error() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;WARN\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;ERROR\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${RED}[ERROR]${log_title} ${NO_COLOR}$1\u0026#34; fi } ###################################################### # Check logics ###################################################### set_packages_and_check_cmd() { case $OS in *\u0026#34;debian\u0026#34;* | *\u0026#34;ubuntu\u0026#34;* ) CHECK_CMD=\u0026#39;dpkg -l | grep -w\u0026#39; PACKAGES=(nfs-common open-iscsi cryptsetup dmsetup) ;; *\u0026#34;centos\u0026#34;* | *\u0026#34;fedora\u0026#34;* | *\u0026#34;rocky\u0026#34;* | *\u0026#34;ol\u0026#34;* ) CHECK_CMD=\u0026#39;rpm -q\u0026#39; PACKAGES=(nfs-utils iscsi-initiator-utils cryptsetup device-mapper) ;; *\u0026#34;suse\u0026#34;* ) CHECK_CMD=\u0026#39;rpm -q\u0026#39; PACKAGES=(nfs-client open-iscsi cryptsetup device-mapper) ;; *\u0026#34;arch\u0026#34;* ) CHECK_CMD=\u0026#39;pacman -Q\u0026#39; PACKAGES=(nfs-utils open-iscsi cryptsetup device-mapper) ;; *\u0026#34;gentoo\u0026#34;* ) CHECK_CMD=\u0026#39;qlist -I\u0026#39; PACKAGES=(net-fs/nfs-utils sys-block/open-iscsi sys-fs/cryptsetup sys-fs/lvm2) ;; *) CHECK_CMD=\u0026#39;\u0026#39; PACKAGES=() warn \u0026#34;Stop the environment check because \u0026#39;$OS\u0026#39; is not supported in the environment check script.\u0026#34; exit 1 ;; esac } detect_node_kernel_release() { local pod=\u0026#34;$1\u0026#34; KERNEL_RELEASE=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;uname -r\u0026#39;) echo \u0026#34;$KERNEL_RELEASE\u0026#34; } detect_node_os() { local pod=\u0026#34;$1\u0026#34; OS=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -E \u0026#34;^ID_LIKE=\u0026#34; /etc/os-release | cut -d= -f2\u0026#39;) if [[ -z \u0026#34;${OS}\u0026#34; ]]; then OS=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -E \u0026#34;^ID=\u0026#34; /etc/os-release | cut -d= -f2\u0026#39;) fi echo \u0026#34;$OS\u0026#34; } check_local_dependencies() { local targets=($@) local all_found=true for ((i=0; i\u0026lt;${#targets[@]}; i++)); do local target=${targets[$i]} if [ \u0026#34;$(which $target)\u0026#34; = \u0026#34;\u0026#34; ]; then all_found=false error \u0026#34;Not found: $target\u0026#34; fi done if [ \u0026#34;$all_found\u0026#34; = \u0026#34;false\u0026#34; ]; then msg=\u0026#34;Please install missing dependencies: ${targets[@]}.\u0026#34; info \u0026#34;$msg\u0026#34; exit 2 fi msg=\u0026#34;Required dependencies \u0026#39;${targets[@]}\u0026#39; are installed.\u0026#34; info \u0026#34;$msg\u0026#34; } create_ds() { cat \u0026lt;\u0026lt;EOF \u0026gt; $TEMP_DIR/environment_check.yaml apiVersion: apps/v1 kind: DaemonSet metadata: labels: app: longhorn-environment-check name: longhorn-environment-check spec: selector: matchLabels: app: longhorn-environment-check template: metadata: labels: app: longhorn-environment-check spec: hostPID: true containers: - name: longhorn-environment-check image: alpine:3.12 args: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;sleep 1000000000\u0026#34;] volumeMounts: - name: mountpoint mountPath: /tmp/longhorn-environment-check mountPropagation: Bidirectional securityContext: privileged: true volumes: - name: mountpoint hostPath: path: /tmp/longhorn-environment-check EOF kubectl create -f $TEMP_DIR/environment_check.yaml \u0026gt; /dev/null } cleanup() { info \u0026#34;Cleaning up longhorn-environment-check pods...\u0026#34; kubectl delete -f $TEMP_DIR/environment_check.yaml \u0026gt; /dev/null rm -rf $TEMP_DIR info \u0026#34;Cleanup completed.\u0026#34; } wait_ds_ready() { while true; do local ds=$(kubectl get ds/longhorn-environment-check -o json) local numberReady=$(echo $ds | jq .status.numberReady) local desiredNumberScheduled=$(echo $ds | jq .status.desiredNumberScheduled) if [ \u0026#34;$desiredNumberScheduled\u0026#34; = \u0026#34;$numberReady\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$desiredNumberScheduled\u0026#34; != \u0026#34;0\u0026#34; ]; then info \u0026#34;All longhorn-environment-check pods are ready ($numberReady/$desiredNumberScheduled).\u0026#34; return fi info \u0026#34;Waiting for longhorn-environment-check pods to become ready ($numberReady/$desiredNumberScheduled)...\u0026#34; sleep 3 done } check_mount_propagation() { local allSupported=true local pods=$(kubectl -l app=longhorn-environment-check get po -o json) local ds=$(kubectl get ds/longhorn-environment-check -o json) local desiredNumberScheduled=$(echo $ds | jq .status.desiredNumberScheduled) for ((i=0; i\u0026lt;desiredNumberScheduled; i++)); do local pod=$(echo $pods | jq .items[$i]) local nodeName=$(echo $pod | jq -r .spec.nodeName) local mountPropagation=$(echo $pod | jq -r \u0026#39;.spec.containers[0].volumeMounts[] | select(.name==\u0026#34;mountpoint\u0026#34;) | .mountPropagation\u0026#39;) if [ \u0026#34;$mountPropagation\u0026#34; != \u0026#34;Bidirectional\u0026#34; ]; then allSupported=false error \u0026#34;node $nodeName: MountPropagation is disabled\u0026#34; fi done if [ \u0026#34;$allSupported\u0026#34; != \u0026#34;true\u0026#34; ]; then error \u0026#34;MountPropagation is disabled on at least one node. As a result, CSI driver and Base image cannot be supported\u0026#34; exit 1 else info \u0026#34;MountPropagation is enabled\u0026#34; fi } check_hostname_uniqueness() { hostnames=$(kubectl get nodes -o jsonpath=\u0026#39;{.items[*].status.addresses[?(@.type==\u0026#34;Hostname\u0026#34;)].address}\u0026#39;) if [ $? -ne 0 ]; then error \u0026#34;kubectl get nodes failed - check KUBECONFIG setup\u0026#34; exit 1 fi if [[ ! ${hostnames[@]} ]]; then error \u0026#34;kubectl get nodes returned empty list - check KUBECONFIG setup\u0026#34; exit 1 fi deduplicate_hostnames=() num_nodes=0 for hostname in ${hostnames}; do num_nodes=$((num_nodes+1)) if ! echo \u0026#34;${deduplicate_hostnames[@]}\u0026#34; | grep -q \u0026#34;\\\u0026lt;${hostname}\\\u0026gt;\u0026#34;; then deduplicate_hostnames+=(\u0026#34;${hostname}\u0026#34;) fi done if [ \u0026#34;${#deduplicate_hostnames[@]}\u0026#34; != \u0026#34;${num_nodes}\u0026#34; ]; then error \u0026#34;Nodes do not have unique hostnames.\u0026#34; exit 2 fi info \u0026#34;All nodes have unique hostnames.\u0026#34; } check_nodes() { local name=$1 local callback=$2 shift shift info \u0026#34;Checking $name...\u0026#34; local all_passed=true local pods=$(kubectl get pods -o name -l app=longhorn-environment-check) for pod in ${pods}; do eval \u0026#34;${callback} ${pod} $@\u0026#34; if [ $? -ne 0 ]; then all_passed=false fi done if [ \u0026#34;$all_passed\u0026#34; = \u0026#34;false\u0026#34; ]; then return 1 fi } verlte() { printf \u0026#39;%s\\n\u0026#39; \u0026#34;$1\u0026#34; \u0026#34;$2\u0026#34; | sort -C -V } verlt() { ! verlte \u0026#34;$2\u0026#34; \u0026#34;$1\u0026#34; } kernel_in_range() { verlte \u0026#34;$2\u0026#34; \u0026#34;$1\u0026#34; \u0026amp;\u0026amp; verlt \u0026#34;$1\u0026#34; \u0026#34;$3\u0026#34; } check_kernel_release() { local pod=$1 local node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) recommended_kernel_release=\u0026#34;5.8\u0026#34; local kernel=$(detect_node_kernel_release ${pod}) if verlt \u0026#34;$kernel\u0026#34; \u0026#34;$recommended_kernel_release\u0026#34; ; then warn \u0026#34;Node $node has outdated kernel release: $kernel. Recommending kernel release \u0026gt;= $recommended_kernel_release\u0026#34; return 1 fi local broken_kernel=(\u0026#34;5.15.0-94\u0026#34; \u0026#34;6.5.6\u0026#34;) local fixed_kernel=(\u0026#34;5.15.0-100\u0026#34; \u0026#34;6.5.7\u0026#34;) for i in ${!broken_kernel[@]}; do if kernel_in_range \u0026#34;$kernel\u0026#34; \u0026#34;${broken_kernel[$i]}\u0026#34; \u0026#34;${fixed_kernel[$i]}\u0026#34; ; then warn \u0026#34;Node $node has a kernel version $kernel known to have a breakage that affects Longhorn. See description and solution at https://longhorn.io/kb/troubleshooting-rwx-volume-fails-to-attached-caused-by-protocol-not-supported\u0026#34; return 1 fi done } check_iscsid() { local pod=$1 kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager iscsid.service\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager iscsid.socket\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;Neither iscsid.service nor iscsid.socket is running on ${node}\u0026#34; return 1 fi fi } check_multipathd() { local pod=$1 kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager multipathd.service\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? = 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) warn \u0026#34;multipathd is running on ${node} known to have a breakage that affects Longhorn. See description and solution at https://longhorn.io/kb/troubleshooting-volume-with-multipath\u0026#34; return 1 fi } check_packages() { local pod=$1 OS=$(detect_node_os ${pod}) if [ x\u0026#34;$OS\u0026#34; = x\u0026#34;\u0026#34; ]; then error \u0026#34;Failed to detect OS on node ${node}\u0026#34; return 1 fi set_packages_and_check_cmd for ((i=0; i\u0026lt;${#PACKAGES[@]}; i++)); do check_package ${PACKAGES[$i]} if [ $? -ne 0 ]; then return 1 fi done } check_package() { local package=$1 kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- timeout 30 bash -c \u0026#34;$CHECK_CMD $package\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;$package is not found in $node.\u0026#34; return 1 fi } check_nfs_client() { local pod=$1 local node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) local options=(\u0026#34;CONFIG_NFS_V4_2\u0026#34; \u0026#34;CONFIG_NFS_V4_1\u0026#34; \u0026#34;CONFIG_NFS_V4\u0026#34;) local kernel=$(detect_node_kernel_release ${pod}) if [ \u0026#34;x${kernel}\u0026#34; = \u0026#34;x\u0026#34; ]; then warn \u0026#34;Failed to check NFS client installation, because unable to detect kernel release on node ${node}\u0026#34; return 1 fi for option in \u0026#34;${options[@]}\u0026#34;; do kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;[ -f /boot/config-${kernel} ]\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then warn \u0026#34;Failed to check $option on node ${node}, because /boot/config-${kernel} does not exist on node ${node}\u0026#34; continue fi check_kernel_module ${pod} ${option} nfs if [ $? = 0 ]; then return 0 fi done error \u0026#34;NFS clients ${options[*]} not found. At least one should be enabled\u0026#34; return 1 } check_kernel_module() { local pod=$1 local option=$2 local module=$3 local kernel=$(detect_node_kernel_release ${pod}) if [ \u0026#34;x${kernel}\u0026#34; = \u0026#34;x\u0026#34; ]; then warn \u0026#34;Failed to check kernel config option ${option}, because unable to detect kernel release on node ${node}\u0026#34; return 1 fi kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;[ -e /boot/config-${kernel} ]\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then warn \u0026#34;Failed to check kernel config option ${option}, because /boot/config-${kernel} does not exist on node ${node}\u0026#34; return 1 fi value=$(kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;grep \u0026#34;^$option=\u0026#34; /boot/config-${kernel} | cut -d= -f2\u0026#34;) if [ -z \u0026#34;${value}\u0026#34; ]; then error \u0026#34;Failed to find kernel config $option on node ${node}\u0026#34; return 1 elif [ \u0026#34;${value}\u0026#34; = \u0026#34;m\u0026#34; ]; then kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;lsmod | grep ${module}\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;kernel module ${module} is not enabled on ${node}\u0026#34; return 1 fi elif [ \u0026#34;${value}\u0026#34; = \u0026#34;y\u0026#34; ]; then return 0 else warn \u0026#34;Unknown value for $option: $value\u0026#34; return 1 fi } check_hugepage() { local pod=$1 local expected_nr_hugepages=$2 nr_hugepages=$(kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;cat /proc/sys/vm/nr_hugepages\u0026#39;) if [ $? -ne 0 ]; then error \u0026#34;Failed to check hugepage size on node ${node}\u0026#34; return 1 fi if [ $nr_hugepages -lt $expected_nr_hugepages ]; then error \u0026#34;Hugepage size is not enough on node ${node}. Expected: ${expected_nr_hugepages}, Actual: ${nr_hugepages}\u0026#34; return 1 fi } function check_sse42_support() { local pod=$1 node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) machine=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;uname -m\u0026#39; 2\u0026gt;/dev/null) if [ $? -ne 0 ]; then error \u0026#34;Failed to check machine on node ${node}\u0026#34; return 1 fi if [ \u0026#34;$machine\u0026#34; = \u0026#34;x86_64\u0026#34; ]; then sse42_support=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -o sse4_2 /proc/cpuinfo | wc -l\u0026#39; 2\u0026gt;/dev/null) if [ $? -ne 0 ]; then error \u0026#34;Failed to check SSE4.2 instruction set on node ${node}\u0026#34; return 1 fi if [ \u0026#34;$sse42_support\u0026#34; -ge 1 ]; then return 0 fi error \u0026#34;CPU does not support SSE4.2\u0026#34; return 1 else warn \u0026#34;Skip SSE4.2 instruction set check on node ${node} because it is not x86_64\u0026#34; fi } function show_help() { cat \u0026lt;\u0026lt;EOF Usage: $0 [OPTIONS] Options: -s, --enable-spdk Enable checking SPDK prerequisites -p, --expected-nr-hugepages Expected number of 2 MiB hugepages for SPDK. Default: 1024 -h, --help Show this help message and exit EOF exit 0 } enable_spdk=false expected_nr_hugepages=1024 while [[ $# -gt 0 ]]; do opt=\u0026#34;$1\u0026#34; case $opt in -s|--enable-spdk) enable_spdk=true ;; -p|--expected-nr-hugepages) expected_nr_hugepages=\u0026#34;$2\u0026#34; shift ;; -h|--help) show_help ;; *) instance_manager_options+=(\u0026#34;$1\u0026#34;) ;; esac shift done ###################################################### # Main logics ###################################################### DEPENDENCIES=(\u0026#34;kubectl\u0026#34; \u0026#34;jq\u0026#34; \u0026#34;mktemp\u0026#34; \u0026#34;sort\u0026#34; \u0026#34;printf\u0026#34;) check_local_dependencies \u0026#34;${DEPENDENCIES[@]}\u0026#34; # Check the each host has a unique hostname (for RWX volume) check_hostname_uniqueness # Create a daemonset for checking the requirements in each node TEMP_DIR=$(mktemp -d) trap cleanup EXIT create_ds wait_ds_ready check_mount_propagation check_nodes \u0026#34;kernel release\u0026#34; check_kernel_release check_nodes \u0026#34;iscsid\u0026#34; check_iscsid check_nodes \u0026#34;multipathd\u0026#34; check_multipathd check_nodes \u0026#34;packages\u0026#34; check_packages check_nodes \u0026#34;nfs client\u0026#34; check_nfs_client if [ \u0026#34;$enable_spdk\u0026#34; = \u0026#34;true\u0026#34; ]; then check_nodes \u0026#34;x86-64 SSE4.2 instruction set\u0026#34; check_sse42_support check_nodes \u0026#34;kernel module nvme_tcp\u0026#34; check_kernel_module CONFIG_NVME_TCP nvme_tcp check_nodes \u0026#34;kernel module uio_pci_generic\u0026#34; check_kernel_module CONFIG_UIO_PCI_GENERIC uio_pci_generic check_nodes \u0026#34;hugepage\u0026#34; check_hugepage ${expected_nr_hugepages} fi exit 0 2.4.2 å®‰è£… # åœ¨çº¿ç¯å¢ƒå®‰è£…å‘½ä»¤\nè¿›å…¥åˆ°longhornçš„helmç›®å½•ä¸‹ helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace -f ./values.yaml ç¦»çº¿ç¯å¢ƒå®‰è£…å‘½ä»¤ï¼ˆå¤‡é€‰ï¼‰ è¿›å…¥åˆ°longhornçš„helmç›®å½•ä¸‹ helm install longhorn --namespace longhorn-system --create-namespace -f ./ 2.4.3 æŸ¥çœ‹ # kubectl get all -n longhorn-system 3. æµ‹è¯•è¯´æ˜ # åŸºäºhttps://github.com/yasker/kbenché¡¹ç›®è¿›è¡Œæ€§èƒ½æµ‹è¯• å¯¹äºå®˜æ–¹åŸºå‡†æµ‹è¯•ï¼š\nSIZEç¯å¢ƒå˜é‡ï¼šå¤§å°åº”è‡³å°‘ä¸ºè¯»/å†™å¸¦å®½çš„ 25 å€ï¼Œä»¥é¿å…ç¼“å­˜å½±å“ç»“æœã€‚ å¦‚æœè¦æµ‹è¯•åƒ Longhorn è¿™æ ·çš„åˆ†å¸ƒå¼å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œè¯·å§‹ç»ˆé¦–å…ˆé’ˆå¯¹æœ¬åœ°å­˜å‚¨è¿›è¡Œæµ‹è¯•ï¼Œä»¥äº†è§£åŸºçº¿æ˜¯ä»€ä¹ˆã€‚ å¦‚æœæ‚¨ä½¿ç”¨ Kubernetes è¿›è¡Œæµ‹è¯•ï¼Œåˆ™å¯ä»¥ä¸ºæœ¬åœ°å­˜å‚¨å®‰è£…å­˜å‚¨æä¾›ç¨‹åºï¼Œä¾‹å¦‚æœ¬åœ°è·¯å¾„é…ç½®å™¨ï¼Œç”¨äºæ­¤æµ‹è¯•ã€‚ CPU_IDLE_PROFç¯å¢ƒå˜é‡ï¼šCPU ç©ºé—²åº¦åˆ†ææµ‹é‡ CPU ç©ºé—²ï¼Œä½†å®ƒä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€å¹¶é™ä½å­˜å‚¨æ€§èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ ‡å¿—å¤„äºç¦ç”¨çŠ¶æ€ã€‚ 3.1 å‚æ•°è§£æ # IOPSï¼šæ¯ç§’ IO æ“ä½œæ•°ã€‚è¶Šé«˜è¶Šå¥½ã€‚ å®ƒæ˜¯è¡¡é‡è®¾å¤‡åœ¨ä¸€ç§’é’Ÿå†…å¯ä»¥å¤„ç†å¤šå°‘ IO æ“ä½œçš„åº¦é‡ï¼Œä¸»è¦æ¶‰åŠè¾ƒå°çš„ IO å—ï¼Œä¾‹å¦‚ 4kã€‚ å¸¦å®½ï¼šä¹Ÿç§°ä¸ºååé‡ã€‚è¶Šé«˜è¶Šå¥½ã€‚ å®ƒæ˜¯è®¾å¤‡åœ¨ä¸€ç§’é’Ÿå†…å¯ä»¥è¯»å–/å†™å…¥å¤šå°‘æ•°æ®çš„åº¦é‡ã€‚å®ƒä¸»è¦æ˜¯å¤„ç†è¾ƒå¤§çš„IOå—ï¼Œä¾‹å¦‚128kã€‚ å»¶è¿Ÿï¼šæ¯ä¸ªè¯·æ±‚åœ¨ IO è·¯å¾„ä¸­èŠ±è´¹çš„æ€»æ—¶é—´ã€‚è¶Š_ä½è¶Šå¥½ã€‚_ å®ƒæ˜¯å­˜å‚¨ç³»ç»Ÿå¤„ç†æ¯ä¸ªè¯·æ±‚çš„æ•ˆç‡çš„åº¦é‡ã€‚ å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®è·¯å¾„å¼€é”€å¯ä»¥è¡¨ç¤ºä¸ºå®ƒåœ¨æœ¬æœºå­˜å‚¨ç³»ç»Ÿ ï¼ˆSSD/NVMeï¼‰ ä¹‹ä¸Šå¢åŠ çš„å»¶è¿Ÿã€‚ CPU ç©ºé—²ï¼šè¿è¡Œæµ‹è¯•çš„èŠ‚ç‚¹ä¸Šçš„ CPU ç©ºé—²ç¨‹åº¦ã€‚è¶Šé«˜è¶Šå¥½ã€‚ å®ƒæ˜¯å­˜å‚¨è®¾å¤‡ç”Ÿæˆçš„ CPU è´Ÿè½½/å¼€é”€çš„åº¦é‡ã€‚ è¯·æ³¨æ„ï¼Œè¿™æ˜¯ç©ºé—²ï¼Œå› æ­¤å¦‚æœè¯¥å€¼æ›´é«˜ï¼Œåˆ™æ„å‘³ç€è¯¥èŠ‚ç‚¹ä¸Šçš„ CPU å…·æœ‰æ›´å¤šçš„ç©ºé—²å‘¨æœŸã€‚ ä¸å¹¸çš„æ˜¯ï¼Œæ­¤æµ‹é‡å€¼ç›®å‰æ— æ³•åæ˜ åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿæ•´ä¸ªç¾¤é›†ä¸Šçš„è´Ÿè½½ã€‚ä½†æ˜¯ï¼Œåœ¨åŸºå‡†æµ‹è¯•æ—¶ï¼Œå®ƒä»ç„¶æ˜¯å­˜å‚¨å®¢æˆ·ç«¯çš„CPUè´Ÿè½½çš„å€¼å¾—å‚è€ƒï¼ˆå–å†³äºåˆ†å¸ƒå¼å­˜å‚¨çš„æ¶æ„æ–¹å¼ï¼‰ã€‚ å¯¹äº_æ¯”è¾ƒåŸºå‡†_ï¼Œè¯¥åˆ—æŒ‡ç¤ºå°†ç¬¬äºŒä¸ªå·ä¸ç¬¬ä¸€ä¸ªå·è¿›è¡Œæ¯”è¾ƒæ—¶çš„ç™¾åˆ†æ¯”å·®å¼‚ã€‚ å¯¹äº **IOPSã€å¸¦å®½ã€CPU ç©ºé—²ï¼Œ**æ­£ç™¾åˆ†æ¯”æ›´å¥½ã€‚ å¯¹äºå»¶è¿Ÿï¼Œè´Ÿç™¾åˆ†æ¯”æ›´å¥½ã€‚ å¯¹äº **CPU ç©ºé—²ï¼Œ**æˆ‘ä»¬æ˜¾ç¤ºçš„ä¸æ˜¯å˜åŒ–çš„ç™¾åˆ†æ¯”ï¼Œè€Œæ˜¯å·®å¼‚ã€‚ 3.1.1 äº†è§£åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„ç»“æœ # å¯¹äºåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œå§‹ç»ˆéœ€è¦å…ˆæµ‹è¯•æœ¬åœ°å­˜å‚¨ä½œä¸ºåŸºå‡†ã€‚ åœ¨ä»¥ä¸‹_æƒ…å†µä¸‹å‡ºç°é—®é¢˜ï¼š\nè¯»å–_å»¶è¿Ÿä½äºæœ¬åœ°å­˜å‚¨_ã€‚ æ‚¨å¯èƒ½ä¼šè·å¾—æ¯”æœ¬åœ°å­˜å‚¨æ›´é«˜çš„è¯»å– IOPS/å¸¦å®½ï¼Œå› ä¸ºå­˜å‚¨å¼•æ“å¯ä»¥èšåˆæ¥è‡ªä¸åŒèŠ‚ç‚¹/ç£ç›˜çš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œä¸æœ¬åœ°å­˜å‚¨ç›¸æ¯”ï¼Œæ‚¨åº”è¯¥æ— æ³•è·å¾—æ›´ä½çš„è¯»å–å»¶è¿Ÿã€‚ å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå¾ˆå¯èƒ½æ˜¯ç”±äºå­˜åœ¨ç¼“å­˜ã€‚å¢åŠ ä»¥é¿å…è¿™ç§æƒ…å†µã€‚SIZE å†™å…¥ IOPS/å¸¦å®½/å»¶è¿Ÿæ¯”æœ¬åœ°å­˜å‚¨æ›´å¥½ã€‚ ä¸åˆ†å¸ƒå¼å­˜å‚¨è§£å†³æ–¹æ¡ˆçš„æœ¬åœ°å­˜å‚¨ç›¸æ¯”ï¼Œå‡ ä¹ä¸å¯èƒ½è·å¾—æ›´å¥½çš„å†™å…¥æ€§èƒ½ï¼Œé™¤éåœ¨æœ¬åœ°å­˜å‚¨å‰é¢æœ‰ä¸€ä¸ªæŒä¹…æ€§ç¼“å­˜è®¾å¤‡ã€‚ å¦‚æœå¾—åˆ°æ­¤ç»“æœï¼Œåˆ™å­˜å‚¨è§£å†³æ–¹æ¡ˆå¯èƒ½ä¸æ˜¯å´©æºƒä¸€è‡´çš„ï¼Œå› æ­¤å®ƒä¸ä¼šåœ¨å“åº”ä¹‹å‰å°†æ•°æ®æäº¤åˆ°ç£ç›˜ä¸­ï¼Œè¿™æ„å‘³ç€åœ¨å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚ æ‚¨å°†è·å¾—å»¶è¿Ÿ_åŸºå‡†çš„ä½ CPU ç©ºé—²ç‡_ï¼Œä¾‹å¦‚ \u0026lt;40%ã€‚ å¯¹äºå»¶è¿Ÿï¼ŒCPU ç©ºé—²åº”è‡³å°‘ä¸º 40%ï¼Œä»¥ç¡®ä¿æµ‹è¯•ä¸ä¼šå—åˆ° CPU ä¸è¶³çš„å½±å“ã€‚ å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¯·å‘èŠ‚ç‚¹æ·»åŠ æ›´å¤š CPUï¼Œæˆ–ç§»åŠ¨åˆ°å¢å¼ºè®¡ç®—æœºã€‚ 3.1.2 éƒ¨ç½² FIO åŸºå‡† # 3.1.2.1 åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²å•å·åŸºå‡†æµ‹è¯• # é»˜è®¤æƒ…å†µä¸‹ï¼š\nåŸºå‡†æµ‹è¯•å°†ä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ã€‚ æ‚¨å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ YAML æŒ‡å®šå­˜å‚¨ç±»ã€‚ å°†ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¨¡å¼ã€‚ æ‚¨å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ YAML åˆ‡æ¢åˆ°é˜»æ­¢æ¨¡å¼ã€‚ è¯¥æµ‹è¯•æš‚æ—¶éœ€è¦ 33G PVCã€‚ å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ YAML æ›´æ”¹æµ‹è¯•å¤§å°ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºæ­£å¼åŸºå‡†æµ‹è¯•ï¼Œå¤§å°åº”è‡³å°‘ä¸ºè¯»/å†™å¸¦å®½çš„ 25 å€ï¼Œä»¥é¿å…ç¼“å­˜å½±å“ç»“æœã€‚ 3.2 æµ‹è¯•æ­¥éª¤ # 3.2.1 LonghornåŸºå‡†æµ‹è¯• # kubectl apply -f https://raw.githubusercontent.com/yasker/kbench/main/deploy/fio.yaml kind: PersistentVolumeClaim apiVersion: v1 metadata: name: kbench-pvc spec: volumeMode: Filesystem #volumeMode: Block #storageClassName: longhorn # replace with your storage class #storageClassName: local-path accessModes: - ReadWriteOnce resources: requests: storage: 33Gi --- apiVersion: batch/v1 kind: Job metadata: name: kbench spec: template: metadata: labels: kbench: fio spec: containers: - name: kbench image: yasker/kbench:latest imagePullPolicy: Always env: #- name: QUICK_MODE # for debugging # value: \u0026#34;1\u0026#34; - name: FILE_NAME value: \u0026#34;/volume/test\u0026#34; - name: SIZE value: \u0026#34;30G\u0026#34; # must be 10% smaller than the PVC size due to filesystem also took space - name: CPU_IDLE_PROF value: \u0026#34;disabled\u0026#34; # must be \u0026#34;enabled\u0026#34; or \u0026#34;disabled\u0026#34; volumeMounts: - name: vol mountPath: /volume/ #volumeDevices: #- name: vol # devicePath: /volume/test restartPolicy: Never volumes: - name: vol persistentVolumeClaim: claimName: kbench-pvc backoffLimit: 0 3.2.2 ç»“æœå±•ç¤º # 3.3 æ¯”è¾ƒåŸºå‡†æµ‹è¯• # 4. longhornå¸è½½ # æ³¨æ„ï¼šå¸è½½å‰æœ€å¥½å°†æ‰€æœ‰pvcåŠpvéƒ½é€ä¸ªåˆ é™¤\n4.1 åˆ é™¤æ ‡å¿—è®¾ç½®ï¼šæ–¹å¼ä¸€ï¼Œç»ˆç«¯ # kubectl -n longhorn-system patch -p \u0026#39;{\u0026#34;value\u0026#34;: \u0026#34;true\u0026#34;}\u0026#39; --type=merge lhs deleting-confirmation-flag 4.2 åˆ é™¤æ ‡å¿—è®¾ç½®ï¼šæ–¹å¼äºŒï¼Œç•Œé¢ # å‹¾é€‰Deleting Confirmation Flagé€‰é¡¹ 4.3 åˆ é™¤æ“ä½œ # helm uninstall longhorn -n longhorn-system ","date":"2023-08-26","externalUrl":null,"permalink":"/longhorn/20230826-1/","section":"longhornå­˜å‚¨","summary":"\u003ch1 class=\"relative group\"\u003e1. å‰è¨€ \n    \u003cdiv id=\"1-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%89%8D%E8%A8%80\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003eLonghorné‡‡ç”¨å®¹å™¨å’Œå¾®æœåŠ¡æŠ€æœ¯å®ç°äº†åˆ†å¸ƒå¼å—å­˜å‚¨ã€‚Longhornä¸ºæ¯ä¸ªå—è®¾å¤‡å·åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å­˜å‚¨æ§åˆ¶å™¨ï¼Œå¹¶ä¸”å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨å‰¯æœ¬ä¸­çš„å·è¿›è¡Œå®æ—¶å¤åˆ¶ã€‚\u003c/p\u003e","title":"Longhornéƒ¨ç½²åŠä½¿ç”¨","type":"blog"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/longhorn/","section":"longhornå­˜å‚¨","summary":"","title":"longhornå­˜å‚¨","type":"longhorn"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/tags/storage/","section":"Tags","summary":"","title":"Storage","type":"tags"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/api/","section":"Tags","summary":"","title":"Api","type":"tags"},{"content":"å®ç°dockeråŠcontainerdé•œåƒä»£ç†é…ç½®ã€‚\n1. dockeré…ç½®ä»£ç† # ä¿®æ”¹dockeré…ç½®ï¼š /etc/docker/daemon.json \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://xxx.xxx.xxx\u0026#34; ], é‡å¯æœåŠ¡ systemctl daemon-reload systemctl restart docker æ‹‰å–é•œåƒæµ‹è¯•\ndocker pull nginx 2. containerdé…ç½®ä»£ç† # ä¿®æ”¹dockeré…ç½®ï¼š /etc/containerd/config.toml [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;] endpoint = [\u0026#34;https://xxx.xxx.xxx\u0026#34;] é‡å¯æœåŠ¡ systemctl daemon-reload systemctl restart containerd æ‹‰å–é•œåƒæµ‹è¯•\ncrictl pull nginx ","date":"2023-03-11","externalUrl":null,"permalink":"/kubernetes/20230311-1/","section":"Kubernetes","summary":"\u003cp\u003eå®ç°dockeråŠcontainerdé•œåƒä»£ç†é…ç½®ã€‚\u003c/p\u003e","title":"dockeråŠcontainerdé•œåƒä»£ç†é…ç½®","type":"blog"},{"content":"å®ç°dockerè¿œç¨‹æ“ä½œapiï¼ˆ2375ç«¯å£ï¼‰å¼€æ”¾ã€‚\n1. æ£€æŸ¥2375ç«¯å£æ˜¯å¦å¼€å¯ # netstat -tuln | grep 2375 å¦‚æœå·²å¼€å¯ï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹æ—¥å¿—\nroot@work01:~# netstat -tuln | grep 2375 tcp6 0 0 :::2375 :::* LISTEN å¦‚æœæœªè¾“å‡ºä»¥ä¸Šæ—¥å¿—ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥å¼€å¯2375ç«¯å£\n2. å¼€å¯2375ç«¯å£ # 2.1 ä¿®æ”¹dockeré…ç½®æ–‡ä»¶: /etc/docker/daemon.json # æ–°å¢å¦‚ä¸‹é…ç½® è¿™æ®µé…ç½®çš„æ„æ€æ˜¯å…è®¸Dockerç›‘å¬åœ¨0.0.0.0çš„2375ç«¯å£ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥è¿œç¨‹è®¿é—®Docker { \u0026#34;hosts\u0026#34;: [\u0026#34;tcp://0.0.0.0:2375\u0026#34;, \u0026#34;unix:///var/run/docker.sock\u0026#34;] } 2.2 é‡å¯docker # systemctl restart docker ","date":"2023-03-11","externalUrl":null,"permalink":"/kubernetes/20230311-2/","section":"Kubernetes","summary":"\u003cp\u003eå®ç°dockerè¿œç¨‹æ“ä½œapiï¼ˆ2375ç«¯å£ï¼‰å¼€æ”¾ã€‚\u003c/p\u003e","title":"dockerå¼€æ”¾è¿œç¨‹æ“ä½œapiï¼ˆ2375ï¼‰","type":"blog"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/pvc/","section":"Tags","summary":"","title":"Pvc","type":"tags"},{"content":" ä»…é™PVCç»‘å®šå…¶å®ƒæœªåˆ é™¤PODä¸”è‡ªèº«å¤„äºterminatingçŠ¶æ€ã€‚\n1. ä¿®æ”¹pvcå¯¹åº”pvçš„å›æ”¶ç­–ç•¥ä¸ºRetain # 1.1 ç¼–è¾‘å¯¹åº”pvc # kubectl edit pv pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 ä¿®æ”¹ç­–ç•¥ä¸ºRetainåï¼Œä¿å­˜å¹¶é€€å‡º 2. åœæ­¢ç›¸å…³pod # 2.1 å•podæœåŠ¡ï¼ˆç›´æ¥åˆ é™¤æœåŠ¡ï¼‰ # 2.2 å¤šå‰¯æœ¬podæœåŠ¡ï¼ˆé™ä½å‰¯æœ¬æ•°é‡ä¸º0ï¼‰ # 2.3 åˆ é™¤pvæ‰€ç»‘å®šçš„æ—§pvcä¿¡æ¯ # kubectl edit pv pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 åˆ é™¤å¯¹åº”7è¡Œä¿¡æ¯ï¼Œä¿å­˜å¹¶é€€å‡º claimRef: apiVersion: v1 kind: PersistentVolumeClaim name: system-minio namespace: ai-education resourceVersion: \u0026#34;87954836\u0026#34; uid: 18c818e0-3e4c-45b0-8156-5d61fbfd6296 3. é‡æ–°ç”³è¯·pvcç»‘å®šæŒ‡å®špv # 3.1 æŸ¥çœ‹pvçŠ¶æ€ä¸ºavailable # 3.2 ç”³è¯·pvc # kubectl apply -f k8s-pvc2.yaml k8s-pvc2.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: system-minio # åŸpvc name namespace: ai-education # åŸpvc namespace spec: accessModes: - ReadWriteOnce # åŸpv è¯»å†™æ¨¡å¼ resources: requests: storage: 8Gi # åŸpv å®¹é‡ volumeName: pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 # åŸpv name ","date":"2023-03-11","externalUrl":null,"permalink":"/volume-solve/20230311-1/","section":"äº‘å­˜å‚¨é—®é¢˜è§£å†³","summary":"\u003cblockquote\u003e\n\u003cp\u003eä»…é™PVCç»‘å®šå…¶å®ƒæœªåˆ é™¤PODä¸”è‡ªèº«å¤„äºterminatingçŠ¶æ€ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e","title":"PVCè¯¯åˆ é™¤åæ¢å¤æ“ä½œ","type":"blog"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/volume/","section":"Tags","summary":"","title":"Volume","type":"tags"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/volume-solve/","section":"äº‘å­˜å‚¨é—®é¢˜è§£å†³","summary":"","title":"äº‘å­˜å‚¨é—®é¢˜è§£å†³","type":"volume-solve"},{"content":"k8sç½‘ç»œé—®é¢˜è§£å†³è®°å½•\n1. k8s(1):calicoç½‘ç»œé—®é¢˜æ’æŸ¥ï¼ŒIP_AUTODETECTION_METHOD # å¼•ç”¨ï¼š https://zhuanlan.zhihu.com/p/488034895?utm_id=0\né—®é¢˜æè¿°ï¼š 4ä¸ªèŠ‚ç‚¹çš„k8sé›†ç¾¤ï¼Œå¿½ç„¶æœ‰ä¸ªèŠ‚ç‚¹ä¸Šçš„podæ— æ³•è®¿é—®å…¶ä»–èŠ‚ç‚¹çš„k8såŸŸåäº†\næ’æŸ¥ â‘ æŸ¥çœ‹corednsæœåŠ¡çŠ¶æ€ï¼Œå‘ç°æ­£å¸¸ï¼Œæ’é™¤å†…éƒ¨dnsè§£æé—®é¢˜ â‘¡æŸ¥çœ‹å‘ç°å¼‚å¸¸podèŠ‚ç‚¹å¯¹åº”çš„calico-node-rdw97æœåŠ¡å¼‚å¸¸ï¼Œå‡ºç°äº†éæ­£å¸¸ä½¿ç”¨ç½‘å¡ä¿¡æ¯ â‘¢æŸ¥çœ‹calicoé…ç½®å‘ç°ï¼Œç½‘å¡é…ç½®ä¸ºP_AUTODETECTION_METHODï¼š first_foundï¼Œè¿™æ ·å¾ˆå®¹æ˜“é€‰é”™ç½‘å¡ è§£å†³ï¼šæŸ¥çœ‹å¹¶ä¿®æ”¹calico nodeçš„daemonseté…ç½®ï¼š(vimç¯å¢ƒ) kubectl edit DaemonSet calico-node -n calico-system\nå‘ç°: IP_AUTODETECTION_METHOD è¿™ä¸ªç¯å¢ƒå˜é‡\nçš„å€¼æ˜¯first_foundï¼Œæˆ‘çš„æœºå™¨ç½‘ä¸Šeth0å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªï¼Œè¿™æ ·å¯èƒ½æœ‰é—®é¢˜ã€‚å› æ­¤ä¿®æ”¹æˆ value: \u0026ldquo;interface=eth0\u0026rdquo; å¹¶ä¿å­˜é€€å‡ºï¼Œå±…ç„¶æ²¡ç”Ÿæ•ˆã€‚\nåŸå› æ˜¯ï¼š\nè¯¥æ–¹æ³•å‘½ä»¤è™½ç„¶å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘è¿™é‡Œdsä¹ˆæ²¡æœ‰ç”Ÿæ•ˆã€‚k8s 1.22ï¼Œé€šè¿‡operatorç”Ÿæˆçš„calicoï¼Œä¸æ˜¯calico.yamlï¼Œå¦‚æœæ˜¯calico.yamlï¼Œç›´æ¥ä¿®æ”¹æ–‡ä»¶ä¸­çš„å‚æ•°å³å¯ã€‚ï¼ˆcalico-nodeæŠ¥é”™Readiness probe failed: calico/node is not ready: BIRD is not ready: Error querying BIRD: unable to connect to BIRDv4 socket - Wghdr\u0026rsquo;s Blog!ï¼‰\nè§£å†³2ï¼š å› æ­¤è¦ç”¨å¦ä¸€ç§æ–¹æ³•æ¥ä¿®æ”¹ï¼š\næˆ‘çš„custom-resources.yaml å¦‚ä¸‹ï¼ŒåŠ ä¸Šçº¢è‰²éƒ¨åˆ†ï¼š\ncustom-resources.yaml nodeAddressAutodetectionV4: interface: eno.* # This section includes base Calico installation configuration. # For more information, see: https://projectcalico.docs.tigera.io/v3.22/reference/installation/api#operator.tigera.io/v1.Installation apiVersion: operator.tigera.io/v1 kind: Installation metadata: name: default spec: # Configures Calico networking. registry: sea.hub:5000 calicoNetwork: # Note: The ipPools section cannot be modified post-install. ipPools: - blockSize: 26 cidr: 100.64.0.0/10 encapsulation: VXLANCrossSubnet natOutgoing: Enabled nodeSelector: all() nodeAddressAutodetectionV4: interface: eno.* --- # This section configures the Calico API server. # For more information, see: https://projectcalico.docs.tigera.io/v3.22/reference/installation/api#operator.tigera.io/v1.APIServer apiVersion: operator.tigera.io/v1 kind: APIServer metadata: name: default spec: {} ç„¶åé‡æ–°æ‰§è¡Œï¼š kubectl apply -f custom-resources.yaml ç„¶åå†ï¼š\nkubectl set env ds/calico-node -n calico-system IP_AUTODETECTION_METHOD=interface=eno3 å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼Œcalico-apiserver-5787fcd448-s56vzå‡ºç°å¼‚å¸¸ï¼Œå¹¶æŠ¥ImageNameError,æŸ¥æ‰¾å‘ç°yamlä¸­å®šä¹‰çš„ImageNameä¸çŸ¥ä¸ºä½•å°‘äº†ä¸€ä¸ª/ï¼Œæ·»åŠ åé‡å¯æœåŠ¡å³å¯ ","date":"2023-02-11","externalUrl":null,"permalink":"/cloudnetissues/20230211-3/","section":"äº‘åŸç”Ÿç½‘ç»œçŸ¥è¯†é›†åˆ","summary":"\u003cp\u003ek8sç½‘ç»œé—®é¢˜è§£å†³è®°å½•\u003c/p\u003e","title":"k8sç½‘ç»œé—®é¢˜è§£å†³è®°å½•","type":"blog"},{"content":"","date":"2023-02-11","externalUrl":null,"permalink":"/tags/service/","section":"Tags","summary":"","title":"Service","type":"tags"},{"content":"","date":"2023-02-11","externalUrl":null,"permalink":"/cloudnetissues/","section":"äº‘åŸç”Ÿç½‘ç»œçŸ¥è¯†é›†åˆ","summary":"","title":"äº‘åŸç”Ÿç½‘ç»œçŸ¥è¯†é›†åˆ","type":"cloudnetissues"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/command/","section":"Tags","summary":"","title":"Command","type":"tags"},{"content":"æ”¶é›†å„ç±»å¸¸è§kuberneteså‘½ä»¤ã€‚\n1. å–æ¶ˆä¸»èŠ‚ç‚¹ç¦æ­¢è°ƒåº¦æ±¡ç‚¹ # â— è¾ƒæ—§ç‰ˆæœ¬\nkubectl taint node k3s01 node-role.kubernetes.io/master:NoSchedule- â— è¾ƒæ–°ç‰ˆæœ¬ï¼š\nkubectl taint node k3s01 node-role.kubernetes.io/control-plane:NoSchedule- ","date":"2022-03-12","externalUrl":null,"permalink":"/kubernetes/20220312-3/","section":"Kubernetes","summary":"\u003cp\u003eæ”¶é›†å„ç±»å¸¸è§kuberneteså‘½ä»¤ã€‚\u003c/p\u003e","title":"Kuberneteså‘½ä»¤é›†åˆ","type":"blog"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/sh/","section":"Tags","summary":"","title":"Sh","type":"tags"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/shell/","section":"Tags","summary":"","title":"Shell","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/coding/","section":"Tags","summary":"","title":"Coding","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/go/","section":"Tags","summary":"","title":"Go","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/go/","section":"Goè¯­è¨€","summary":"","title":"Goè¯­è¨€","type":"go"},{"content":" å®ç°k8sç«¯å£å·å®šä¹‰åŠåˆ†é…\n1. NodePort èŒƒå›´ # åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒNodePort é»˜è®¤èŒƒå›´æ˜¯ 30000-32767\n2. å¢å¤§NodePortèŒƒå›´ # ä¿®æ”¹kube-apiserver.yamlæ–‡ä»¶\nâ— ä½¿ç”¨ kubeadm å®‰è£… K8S é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œæ‚¨çš„ Master èŠ‚ç‚¹ä¸Šä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶ /etc/kubernetes/manifests/kube-apiserver.yamlï¼Œä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œå‘å…¶ä¸­æ·»åŠ  \u0026ndash;service-node-port-range=20000-22767 ï¼ˆå®šä¹‰éœ€è¦çš„ç«¯å£èŒƒå›´ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\napiVersion: v1 kind: Pod ... ... ... ... - --service-account-key-file=/etc/kubernetes/pki/sa.pub - --service-node-port-range=20000-22767 - --service-cluster-ip-range=10.96.0.0/22 ... ... ... ... 3. é‡å¯kube-apiserver # # è·å¾— apiserver çš„ pod åå­— export apiserver_pods=$(kubectl get pods --selector=component=kube-apiserver -n kube-system --output=jsonpath={.items..metadata.name}) # åˆ é™¤ apiserver çš„ pod kubectl delete pod $apiserver_pods -n kube-system 4.éªŒè¯ç»“æœ # â— æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç›¸å…³pod\nkubectl describe pod $apiserver_pods -n kube-system æ³¨æ„:\nâ— å¯¹äºå·²ç»åˆ›å»ºçš„NodePortç±»å‹çš„Serviceï¼Œéœ€è¦åˆ é™¤é‡æ–°åˆ›å»º\nâ— å¦‚æœé›†ç¾¤æœ‰å¤šä¸ª Master èŠ‚ç‚¹ï¼Œéœ€è¦é€ä¸ªä¿®æ”¹æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ /etc/kubernetes/manifests/kube-apiserver.yaml æ–‡ä»¶ï¼Œå¹¶é‡å¯ apiserver\n","date":"2022-03-11","externalUrl":null,"permalink":"/cloudnetissues/20220311-1/","section":"äº‘åŸç”Ÿç½‘ç»œçŸ¥è¯†é›†åˆ","summary":"\u003ch5 id=\"typeit-c2ef07445b197a99457be36a816dd2c7\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-c2ef07445b197a99457be36a816dd2c7\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\u003cp\u003eå®ç°k8sç«¯å£å·å®šä¹‰åŠåˆ†é…\u003c/p\u003e","title":"k8sç«¯å£å·å®šä¹‰åŠåˆ†é…","type":"blog"},{"content":" å®ç°k8så®¹å™¨é—´å…å¯†è®¿é—®æ–¹æ¡ˆ\nPod ä½¿ç”¨åŒæ ·çš„ç§é’¥/å…¬é’¥ï¼Œå¯ä»¥äº’ç›¸å…å¯†è®¿é—® åªéœ€ç”ŸæˆåŒæ ·çš„ id_rsaå’Œ id_rsa.pubï¼Œç„¶åå°† authorized_keysçš„å†…å®¹è®¾ä¸ºid_rsa.pubä¸€è‡´ã€‚ä¹Ÿå³å°†ç›¸åŒçš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°ä¸åŒçš„Podä¸Šå³å¯\nconfigæ–‡ä»¶é…ç½®\nå°† id_rsa,id_rsa.pub,authorized_keys,configä½œä¸º configmapçš„å†…å®¹ã€‚ # ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œæ— éœ€ç¡®è®¤ï¼Œç›´æ¥è¿æ¥ StrictHostKeyChecking no UserKnownHostsFile /dev/null # pod é—´æ— æ³•é€šè¿‡ hostname ç›´æ¥è®¿é—®å¯¹æ–¹çš„ï¼Œå› æ­¤éœ€è¦ service Host pod-hostname-1 HostName pod-hostname-1.service-name Host pod-hostname-2 HostName pod-hostname-2.service-name 1. Pod ä¸»æœºåè§£æ # 1.1 pod é—´æ— æ³•é€šè¿‡ hostname ç›´æ¥è®¿é—®å¯¹æ–¹çš„ï¼Œå› æ­¤éœ€è¦ serviceï¼š # å¯ä»¥å‚è€ƒ Pod é—´é€šä¿¡ï¼› 1.1.1 å¯åŠ¨å¸¦ Pod é—´é€šä¿¡çš„ Job # è¦åœ¨æŸ Job ä¸­å¯ç”¨ä½¿ç”¨ Pod ä¸»æœºåçš„ Pod é—´é€šä¿¡ï¼Œä½ å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\nå¯¹äº Job æ‰€åˆ›å»ºçš„é‚£äº› Podï¼Œ ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡ç­¾é€‰æ‹©ç®—ç¬¦åˆ›å»ºæ— å¤´æœåŠ¡ã€‚ è¯¥æ— å¤´æœåŠ¡å¿…é¡»ä½äºä¸è¯¥ Job ç›¸åŒçš„åå­—ç©ºé—´å†…ã€‚ å®ç°è¿™ä¸€ç›®çš„çš„ä¸€ç§ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ job-name: \u0026lt;ä»»åŠ¡åç§°\u0026gt; ä½œä¸ºé€‰æ‹©ç®—ç¬¦ï¼Œ å› ä¸º job-name æ ‡ç­¾å°†ç”± Kubernetes è‡ªåŠ¨æ·»åŠ ã€‚ æ­¤é…ç½®å°†è§¦å‘ DNS ç³»ç»Ÿä¸ºè¿è¡Œ Job çš„ Pod åˆ›å»ºå…¶ä¸»æœºåçš„è®°å½•ã€‚ é€šè¿‡å°†ä»¥ä¸‹å€¼åŒ…æ‹¬åˆ°ä½ çš„ Job æ¨¡æ¿è§„çº¦ä¸­ï¼Œé’ˆå¯¹è¯¥ Job çš„ Podï¼Œå°†æ— å¤´æœåŠ¡é…ç½®ä¸ºå…¶å­åŸŸæœåŠ¡ï¼š subdomain: \u0026lt;æ— å¤´æœåŠ¡çš„åç§°\u0026gt; ç¤ºä¾‹:ä»¥ä¸‹æ˜¯å¯ç”¨é€šè¿‡ Pod ä¸»æœºåæ¥å®Œæˆ Pod é—´é€šä¿¡çš„ Job ç¤ºä¾‹ã€‚ åªæœ‰åœ¨ä½¿ç”¨ä¸»æœºåæˆåŠŸ ping é€šæ‰€æœ‰ Pod ä¹‹åï¼Œæ­¤ Job æ‰ä¼šç»“æŸã€‚\nè¯´æ˜ï¼š # åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„æ¯ä¸ª Pod ä¸­æ‰§è¡Œçš„ Bash è„šæœ¬ä¸­ï¼Œå¦‚æœéœ€è¦ä»åå­—ç©ºé—´å¤–åˆ°è¾¾ Podï¼Œ Pod ä¸»æœºåä¹Ÿå¯ä»¥å¸¦æœ‰è¯¥åå­—ç©ºé—´ä½œä¸ºå‰ç¼€ã€‚\napiVersion: v1 kind: Service metadata: name: headless-svc spec: clusterIP: None # clusterIP å¿…é¡»ä¸º None ä»¥åˆ›å»ºæ— å¤´æœåŠ¡ selector: job-name: example-job # å¿…é¡»ä¸ Job åç§°åŒ¹é… --- apiVersion: batch/v1 kind: Job metadata: name: example-job spec: completions: 3 parallelism: 3 completionMode: Indexed template: spec: subdomain: headless-svc # å¿…é¡»ä¸ Service åç§°åŒ¹é… restartPolicy: Never containers: - name: example-workload image: bash:latest command: - bash - -c - | for i in 0 1 2 do gotStatus=\u0026#34;-1\u0026#34; wantStatus=\u0026#34;0\u0026#34; while [ $gotStatus -ne $wantStatus ] do ping -c 1 example-job-${i}.headless-svc \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 gotStatus=$? if [ $gotStatus -ne $wantStatus ]; then echo \u0026#34;Failed to ping pod example-job-${i}.headless-svc, retrying in 1 second...\u0026#34; sleep 1 fi done echo \u0026#34;Successfully pinged pod: example-job-${i}.headless-svc\u0026#34; done åº”ç”¨ä¸Šè¿°ç¤ºä¾‹ä¹‹åï¼Œä½¿ç”¨ \u0026lt;Pod ä¸»æœºå\u0026gt;.\u0026lt;æ— å¤´æœåŠ¡å\u0026gt; é€šè¿‡ç½‘ç»œåˆ°è¾¾å½¼æ­¤ã€‚ ä½ åº”çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š\nkubectl logs example-job-0-qws42 Failed to ping pod example-job-0.headless-svc, retrying in 1 second... Successfully pinged pod: example-job-0.headless-svc Successfully pinged pod: example-job-1.headless-svc Successfully pinged pod: example-job-2.headless-svc è¯´æ˜ï¼šè°¨è®°æ­¤ä¾‹ä¸­ä½¿ç”¨çš„ \u0026lt;Pod ä¸»æœºå\u0026gt;.\u0026lt;æ— å¤´æœåŠ¡åç§°\u0026gt; åç§°æ ¼å¼ä¸é€‚ç”¨äºè®¾ç½®ä¸º None æˆ– Default çš„ DNS ç­–ç•¥ã€‚ ä½ å¯ä»¥åœ¨æ­¤å¤„äº†è§£æœ‰å…³ Pod DNS ç­–ç•¥çš„æ›´å¤šä¿¡æ¯ã€‚\n1.2 hostname å¿…é¡»æ˜¯è§„åˆ™åŒ–ï¼Œæ‰å¯ä»¥é™æ€ç”Ÿæˆæ‰€æœ‰çš„ä¸»æœºåï¼š # å¯ä»¥ç”¨ Statefulset æˆ–è€… IndexJob æ¥ç”Ÿæˆæœ‰è§„åˆ™çš„ hostnameã€‚ 1.3 Pod æŒ‚è½½ SSH ConfigMap # æƒ³è¦å…å¯†ï¼Œåˆ™ Pod ä¸ŠæŒ‚è½½ç›¸åº”çš„configmap å³å¯ã€‚\nspec: containers: volumeMounts: - name: ssh-config mountPath: /root/.ssh # use subpath to avoid soft link subPath: .ssh volumes: - name: ssh-config configMap: name: ssh-config-cm defaultMode: 0600 items: - key: PRIVATE_KEY path: .ssh/id_rsa - key: PUBLIC_KEY path: .ssh/id_rsa.pub - key: AUTHORIZED_KEYS path: .ssh/authorized_keys - key: CONFIG path: .ssh/config ","date":"2022-03-11","externalUrl":null,"permalink":"/cloudnetissues/20220311-2/","section":"äº‘åŸç”Ÿç½‘ç»œçŸ¥è¯†é›†åˆ","summary":"\u003ch5 id=\"typeit-b20707817a1a961b2a788c0f2e033193\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-b20707817a1a961b2a788c0f2e033193\", {\n        strings: [\"\\\"æ— èŠæœ›è§äº†çŠ¹è±«, è¾¾åˆ°ç†æƒ³ä¸å¤ªæ˜“~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\u003cp\u003eå®ç°k8så®¹å™¨é—´å…å¯†è®¿é—®æ–¹æ¡ˆ\u003c/p\u003e","title":"k8så®¹å™¨é—´å…å¯†è®¿é—®æ–¹æ¡ˆ","type":"blog"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/nossh/","section":"Tags","summary":"","title":"Nossh","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/port/","section":"Tags","summary":"","title":"Port","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/ssh/","section":"Tags","summary":"","title":"Ssh","type":"tags"},{"content":"æœ¬æ–‡æä¾›äº†å¯åœ¨ Blowfish ä¸­ä½¿ç”¨çš„åŸºæœ¬ Markdown æ ¼å¼ç¤ºä¾‹ï¼Œè¿˜å±•ç¤ºäº†å¦‚ä½•åŠ å…¥ä¸€äº›åŸºæœ¬ HTML å…ƒç´ ã€‚\næ ‡é¢˜ # ä»¥ä¸‹ HTML å…ƒç´  \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; è¡¨ç¤ºå…­ä¸ªçº§åˆ«çš„æ ‡é¢˜ã€‚ \u0026lt;h1\u0026gt; æ˜¯æœ€é«˜çš„æ ‡é¢˜çº§åˆ«ï¼Œè€Œ \u0026lt;h6\u0026gt; æ˜¯æœ€ä½çš„ã€‚\nH1 # H2 # H3 # H4 # H5 # H6 # æ®µè½ # Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nå—å¼•ç”¨ # å—å¼•ç”¨è¡¨ç¤ºä»å…¶ä»–æ¥æºå¼•ç”¨çš„å†…å®¹ï¼Œå¯ä»¥ç”¨äºä½äº footer æˆ– cite å…ƒç´ å†…çš„å¼•æ–‡ï¼Œå¹¶ä¸”å¯ä»¥è¡¨ç¤ºä¸€äº›è¡¥å……è¯´æ˜ï¼ˆä¾‹å¦‚æ³¨é‡Šå’Œç¼©å†™ï¼‰ã€‚\næ²¡æœ‰å‚è€ƒé“¾æ¥çš„å—å¼•ç”¨ # Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\næœ‰å‚è€ƒé“¾æ¥çš„å—å¼•ç”¨ # Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\nâ€” Rob Pike1\nè¡¨æ ¼ # è¡¨æ ¼ä¸æ˜¯æ ¸å¿ƒ Markdown è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œä½† Hugo æ”¯æŒæ¸²æŸ“ã€‚\nName Age Bob 27 Alice 23 è¡¨æ ¼å†…å†…è” Markdown # Italics Bold Code italics bold code ä»£ç å— # å¸¦åå¼•å·çš„ä»£ç å— # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç¼©è¿›å››ä¸ªç©ºæ ¼çš„ä»£ç å— # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¸¦æœ‰ Hugo å†…éƒ¨é«˜äº®ç®€ç çš„ä»£ç å— # 1 2 3 4 5 6 7 8 9 10 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; åˆ—è¡¨ # æœ‰åºåˆ—è¡¨ # First item Second item Third item æ— åºåˆ—è¡¨ # List item Another item And another item åµŒå¥—åˆ—è¡¨ # Fruit Apple Orange Banana Dairy Milk Cheese å…¶ä»–å…ƒç´  â€” abbrã€subã€supã€kbdã€mark # GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nä¸Šè¿°å¼•æ–‡æ‘˜è‡ª Rob Pike åœ¨ 2015 å¹´ 11 æœˆ 18 æ—¥ Gopherfest æœŸé—´çš„è°ˆè®ºâ€œä»€ä¹ˆéƒ½æ²¡æœ‰â€ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2022-03-11","externalUrl":null,"permalink":"/go/20220311-1/","section":"Goè¯­è¨€","summary":"\u003cp\u003eæœ¬æ–‡æä¾›äº†å¯åœ¨ Blowfish ä¸­ä½¿ç”¨çš„åŸºæœ¬ Markdown æ ¼å¼ç¤ºä¾‹ï¼Œè¿˜å±•ç¤ºäº†å¦‚ä½•åŠ å…¥ä¸€äº›åŸºæœ¬ HTML å…ƒç´ ã€‚\u003c/p\u003e","title":"Windowsé…ç½®Goç¯å¢ƒ","type":"blog"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/%E7%8E%AF%E5%A2%83/","section":"Tags","summary":"","title":"ç¯å¢ƒ","type":"tags"},{"content":"","date":"2017-07-17","externalUrl":null,"permalink":"/archives/","section":"æ¬¢è¿æ¥åˆ°äº‘ä¸€äºŒä¸‰çŸ¥è¯†åº“! ğŸ‰","summary":"","title":"æ—¶é—´è½´","type":"archives"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/code-languages/","section":"ç¼–ç¨‹è¯­è¨€","summary":"","title":"ç¼–ç¨‹è¯­è¨€","type":"code-languages"},{"content":"","externalUrl":null,"permalink":"/skill-tech/","section":"å¥‡æ·«æŠ€å·§","summary":"","title":"å¥‡æ·«æŠ€å·§","type":"skill-tech"},{"content":"","externalUrl":null,"permalink":"/cloudstorage/","section":"äº‘åŸç”Ÿå­˜å‚¨","summary":"","title":"äº‘åŸç”Ÿå­˜å‚¨","type":"cloudstorage"},{"content":"","externalUrl":null,"permalink":"/cloudnet/","section":"äº‘åŸç”Ÿç½‘ç»œ","summary":"","title":"äº‘åŸç”Ÿç½‘ç»œ","type":"cloudnet"}]