
[{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/argocd/","section":"Tags","summary":"","title":"Argocd","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/auto/","section":"Tags","summary":"","title":"Auto","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/build/","section":"Tags","summary":"","title":"Build","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/cd/","section":"Tags","summary":"","title":"Cd","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/ci/","section":"Tags","summary":"","title":"Ci","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/devops/","section":"Tags","summary":"","title":"Devops","type":"tags"},{"content":" 1. argocd部署使用 # 1.1 服务端安装 # 使用自定义namespace(argo-cd)，而非默认的argocd 会遇到权限问题，所以此步骤部署完成后，需要参考5.1步骤更新clusterrolebinding内的namespace # 下载安装脚本 wget https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml # 创建argocd名空间 kubectl create namespace argo-cd # 执行apply安装 kubectl apply -n argo-cd -f install.yaml # 查看安装镜像下载状态 kubectl describe pod -n argocd |grep Image: |sort |uniq -c # 开启UI的Nodeport kubectl -n argocd expose deployments/argocd-server --type=\u0026#34;NodePort\u0026#34; --port=8080 --name=argocd-server-nodeport # 获取密码，用户名为：admin kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d|xargs -n1 echo 1.2 客户端安装 # #下载最新版本 curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64 sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd rm argocd-linux-amd64 #下载具体版 在下面的命令中设置替换为您要下载的 Argo CD 版本：VERSION\u0026lt;TAG\u0026gt; VERSION=\u0026lt;TAG\u0026gt; # Select desired TAG from https://github.com/argoproj/argo-cd/releases curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64 sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd rm argocd-linux-amd64 #下载最新的稳定版本 #您可以通过执行以下步骤来下载最新的稳定版本： VERSION=$(curl -L -s https://raw.githubusercontent.com/argoproj/argo-cd/stable/VERSION) curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/download/v$VERSION/argocd-linux-amd64 sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd rm argocd-linux-amd64 2. argocd部署结果通知 # 2.1 钉钉群机器人通知 # 钉钉群机器人如何配置略过 部署 钉钉群机器人的webhook配置：https://oapi.dingtalk.com/robot/send?access_token=xxxx argocd-ui地址：argocdUrl namespace：argocd安装的命名空间 apiVersion: v1 kind: ServiceAccount metadata: name: argocd-notifications-controller-dingtalk namespace: argo-cd --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: argocd-notifications-controller-dingtalk namespace: argo-cd rules: - apiGroups: - argoproj.io resources: - applications - appprojects verbs: - get - list - watch - update - patch - apiGroups: - \u0026#34;\u0026#34; resources: - configmaps - secrets verbs: - list - watch - apiGroups: - \u0026#34;\u0026#34; resourceNames: - argocd-notifications-cm resources: - configmaps verbs: - get - apiGroups: - \u0026#34;\u0026#34; resourceNames: - argocd-notifications-secret resources: - secrets verbs: - get --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: argocd-notifications-controller-dingtalk namespace: argo-cd roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: argocd-notifications-controller-dingtalk subjects: - kind: ServiceAccount name: argocd-notifications-controller-dingtalk --- apiVersion: v1 kind: ConfigMap metadata: name: argocd-notifications-cm namespace: argo-cd data: service.webhook.dingtalk: | url: https://oapi.dingtalk.com/robot/send?access_token=xxxx # url: https://open.feishu.cn/open-apis/bot/v2/hook/xxxx headers: - name: Content-Type value: application/json context: | argocdUrl: http://xxx:xxx template.app-sync-change: | webhook: dingtalk: method: POST body: | { \u0026#34;msgtype\u0026#34;: \u0026#34;markdown\u0026#34;, \u0026#34;markdown\u0026#34;: { \u0026#34;title\u0026#34;:\u0026#34;ArgoCD同步状态\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;### ArgoCD同步状态\\n\u0026gt; - app名称: {{.app.metadata.name}}\\n\u0026gt; - app同步状态: {{ .app.status.operationState.phase}}\\n\u0026gt; - 时间:{{.app.status.operationState.startedAt}}\\n\u0026gt; - URL: [点击跳转ArgoCD]({{.context.argocdUrl}}/applications/{{.app.metadata.name}}?operation=true) \\n\u0026#34; } } trigger.on-deployed: | - description: Application is synced and healthy. Triggered once per commit. oncePer: app.status.sync.revision send: [app-sync-change] # template names # trigger condition when: app.status.operationState.phase in [\u0026#39;Succeeded\u0026#39;] and app.status.health.status == \u0026#39;Healthy\u0026#39; trigger.on-health-degraded: | - description: Application has degraded send: [app-sync-change] when: app.status.health.status == \u0026#39;Degraded\u0026#39; trigger.on-sync-failed: | - description: Application syncing has failed send: [app-sync-change] # template names when: app.status.operationState.phase in [\u0026#39;Error\u0026#39;, \u0026#39;Failed\u0026#39;] trigger.on-sync-running: | - description: Application is being synced send: [app-sync-change] # template names when: app.status.operationState.phase in [\u0026#39;Running\u0026#39;] trigger.on-sync-status-unknown: | - description: Application status is \u0026#39;Unknown\u0026#39; send: [app-sync-change] # template names when: app.status.sync.status == \u0026#39;Unknown\u0026#39; trigger.on-sync-succeeded: | - description: Application syncing has succeeded send: [app-sync-change] # template names when: app.status.operationState.phase in [\u0026#39;Succeeded\u0026#39;] subscriptions: | - recipients: [dingtalk] # 可能有bug，正常应该是webhook:dingtalk triggers: [on-sync-running, on-deployed, on-sync-failed, on-sync-succeeded] --- apiVersion: v1 kind: Secret metadata: name: argocd-notifications-secret namespace: argo-cd type: Opaque --- apiVersion: v1 kind: Service metadata: labels: app.kubernetes.io/name: argocd-notifications-controller-dingtalk-metrics name: argocd-notifications-controller-dingtalk-metrics namespace: argo-cd spec: ports: - name: metrics port: 9001 protocol: TCP targetPort: 9001 selector: app.kubernetes.io/name: argocd-notifications-controller-dingtalk --- apiVersion: apps/v1 kind: Deployment metadata: name: argocd-notifications-controller-dingtalk namespace: argo-cd spec: selector: matchLabels: app.kubernetes.io/name: argocd-notifications-controller-dingtalk strategy: type: Recreate template: metadata: labels: app.kubernetes.io/name: argocd-notifications-controller-dingtalk spec: containers: - command: - /app/argocd-notifications-backend - controller image: argoprojlabs/argocd-notifications:v1.2.0 imagePullPolicy: Always livenessProbe: tcpSocket: port: 9001 name: argocd-notifications-controller-dingtalk volumeMounts: - mountPath: /app/config/tls name: tls-certs - mountPath: /app/config/reposerver/tls name: argocd-repo-server-tls workingDir: /app securityContext: runAsNonRoot: true serviceAccountName: argocd-notifications-controller-dingtalk volumes: - configMap: name: argocd-tls-certs-cm name: tls-certs - name: argocd-repo-server-tls secret: items: - key: tls.crt path: tls.crt - key: tls.key path: tls.key - key: ca.crt path: ca.crt optional: true secretName: argocd-repo-server-tls 3. argocd添加集群 # 通过命令行形式添加\n3.1 登陆 # argocd login 172.16.xx.xxx:xxx --username admin --password xxx --insecure 3.2 获取目标k8s集群context信息 # 获取name: kubernetes-admin@kubernetes # 在目标k8s集群执行 root@master01:/xxx/kubesphere# kubectl config get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * kubernetes-admin@kubernetes kubernetes kubernetes-admin 将目标k8s集群config配置发送至argocd客户端所在机器 修改config中的k8s集群域名为目标k8s集群主节点ip scp /root/.kube/config 172.16.xxx.xxx1:/xxx/argocd_files/mem_config 3.3 执行argocd新增k8s集群操作 # add: 3.2步获取的name kubeconfig: 3.2步发送的修改后config name: 为目标集群定义的name argocd cluster add kubernetes-admin@kubernetes --kubeconfig /xxx/argocd_files/mem_config --name mem 4. argocd备份 # 参考链接：Argo CD 实践教程 06-腾讯云开发者社区-腾讯云\n备份 端口号为argocd-server-nodeport/argocd-server的端口号 # 登陆 argocd login 172.16.xx.xxx:xxx # 备份 argocd admin export -n argocd \u0026gt; backup-$(date +\u0026#34;%Y-%m-%d_%H_%M\u0026#34;).yml 恢复 要恢复备份，你需要在目标集群中安装Argo CD。这是因为，在备份中，我们有它的配置，以及所有的配置映射和秘密，所以我们为初始安装所更改的一切都应该存在。但是，备份不会存储实际的部署或状态集。这意味着需要在恢复备份之前安装它们。自定义资源的定义也是如此——我们将有所有的应用程序和应用程序项目的实例，但我们将不会有这些自定义资源的定义。 因此，在新的集群中，执行与之前使用Kustomize部分的HA安装中相同的安装。然后，运行以下命令（你需要更改文件名，使其与你的命令匹配）： # 登陆 argocd login 172.16.xx.xxx:xxx # 恢复 argocd --loglevel debug admin -n argocd import - \u0026lt; backup-2024-08-09_11_02.yml 现在，你应该有一个新的安装，其中包含了你在创建备份时所拥有的所有状态（应用程序、集群和Git回购）。唯一的区别是，现在Redis缓存中没有任何，所以Argo CD需要开始重新计算Git回购的所有清单，这可能会影响系统最初几分钟的性能。在那之后，一切都应该照常进行。\n5. argocd部署问题解决 # 5.1 权限问题 # 报错如下 Failed to load live state: failed to get cluster info for \u0026#34;https://kubernetes.default.svc\u0026#34;: error synchronizing cache state : failed to sync cluster https://10.96.0.1:443: failed to load initial state of resource BGPFilter.projectcalico.org: bgpfilters.projectcalico.org is forbidden: User \u0026#34;system:serviceaccount:argo-cd:argocd-application-controller\u0026#34; cannot list resource \u0026#34;bgpfilters\u0026#34; in API group \u0026#34;projectcalico.org\u0026#34; at the cluster scope 通过排查发现，是因为用了自定义namespace: argo-cd，而 clusterrolebinding 需要命名空间argocd 解决方案 编辑argocd-application-controller和argocd-server对应的clusterrolebinding里面的默认namespace（argocd）为自定义的namespace（argo-cd） kubectl edit clusterrolebinding argocd-application-controller -n \u0026lt;namespace\u0026gt; kubectl edit clusterrolebinding argocd-server -n \u0026lt;namespace\u0026gt; ","date":"2024-09-11","externalUrl":null,"permalink":"/devops/20240911-2/","section":"云原生AI技术","summary":"\u003ch1 class=\"relative group\"\u003e1. argocd部署使用 \n    \u003cdiv id=\"1-argocd%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-argocd%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 服务端安装 \n    \u003cdiv id=\"11-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e使用自定义namespace(\u003ccode\u003eargo-cd\u003c/code\u003e)，而非默认的\u003ccode\u003eargocd\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003e会遇到权限问题，所以此步骤部署完成后，需要参考\u003ccode\u003e5.1\u003c/code\u003e步骤更新\u003ccode\u003eclusterrolebinding\u003c/code\u003e内的namespace\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 下载安装脚本\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 创建argocd名空间\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl create namespace argo-cd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 执行apply安装\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl apply -n argo-cd -f install.yaml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 查看安装镜像下载状态\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl describe pod -n argocd \u003cspan class=\"p\"\u003e|\u003c/span\u003egrep Image: \u003cspan class=\"p\"\u003e|\u003c/span\u003esort \u003cspan class=\"p\"\u003e|\u003c/span\u003euniq -c\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 开启UI的Nodeport\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl -n argocd expose deployments/argocd-server --type\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;NodePort\u0026#34;\u003c/span\u003e --port\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8080\u003c/span\u003e --name\u003cspan class=\"o\"\u003e=\u003c/span\u003eargocd-server-nodeport\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 获取密码，用户名为：admin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl -n argocd get secret argocd-initial-admin-secret -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;{.data.password}\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 -d\u003cspan class=\"p\"\u003e|\u003c/span\u003exargs -n1 \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch2 class=\"relative group\"\u003e1.2 客户端安装 \n    \u003cdiv id=\"12-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#12-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#下载最新版本\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo install -m \u003cspan class=\"m\"\u003e555\u003c/span\u003e argocd-linux-amd64 /usr/local/bin/argocd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#下载具体版\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e在下面的命令中设置替换为您要下载的 Argo CD 版本：VERSION\u0026lt;TAG\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;TAG\u0026gt; \u003cspan class=\"c1\"\u003e# Select desired TAG from https://github.com/argoproj/argo-cd/releases\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/download/\u003cspan class=\"nv\"\u003e$VERSION\u003c/span\u003e/argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo install -m \u003cspan class=\"m\"\u003e555\u003c/span\u003e argocd-linux-amd64 /usr/local/bin/argocd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#下载最新的稳定版本\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#您可以通过执行以下步骤来下载最新的稳定版本：\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecurl -L -s https://raw.githubusercontent.com/argoproj/argo-cd/stable/VERSION\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/download/v\u003cspan class=\"nv\"\u003e$VERSION\u003c/span\u003e/argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo install -m \u003cspan class=\"m\"\u003e555\u003c/span\u003e argocd-linux-amd64 /usr/local/bin/argocd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm argocd-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1 class=\"relative group\"\u003e2. argocd部署结果通知 \n    \u003cdiv id=\"2-argocd%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C%E9%80%9A%E7%9F%A5\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#2-argocd%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C%E9%80%9A%E7%9F%A5\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e2.1 钉钉群机器人通知 \n    \u003cdiv id=\"21-%E9%92%89%E9%92%89%E7%BE%A4%E6%9C%BA%E5%99%A8%E4%BA%BA%E9%80%9A%E7%9F%A5\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#21-%E9%92%89%E9%92%89%E7%BE%A4%E6%9C%BA%E5%99%A8%E4%BA%BA%E9%80%9A%E7%9F%A5\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e钉钉群机器人如何配置略过\u003c/li\u003e\n\u003cli\u003e部署\n\u003cul\u003e\n\u003cli\u003e钉钉群机器人的webhook配置：https://oapi.dingtalk.com/robot/send?access_token=xxxx\u003c/li\u003e\n\u003cli\u003eargocd-ui地址：argocdUrl\u003c/li\u003e\n\u003cli\u003enamespace：argocd安装的命名空间\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eServiceAccount\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erbac.authorization.k8s.io/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRole\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003eapiGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eargoproj.io\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eapplications\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eappprojects\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003everbs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eget\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003elist\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ewatch\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eupdate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003epatch\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003eapiGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003econfigmaps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003esecrets\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003everbs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003elist\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ewatch\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003eapiGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresourceNames\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eargocd-notifications-cm\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003econfigmaps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003everbs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eget\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003eapiGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresourceNames\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eargocd-notifications-secret\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003esecrets\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003everbs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003eget\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erbac.authorization.k8s.io/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRoleBinding\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eroleRef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eapiGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erbac.authorization.k8s.io\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRole\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003esubjects\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eServiceAccount\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eConfigMap\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-cm\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice.webhook.dingtalk\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    url: https://oapi.dingtalk.com/robot/send?access_token=xxxx\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    # url: https://open.feishu.cn/open-apis/bot/v2/hook/xxxx\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    headers:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      - name: Content-Type\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e        value: application/json\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    argocdUrl: http://xxx:xxx\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate.app-sync-change\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    webhook:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      dingtalk:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e        method: POST\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e        body: |\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e          {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e            \u0026#34;msgtype\u0026#34;: \u0026#34;markdown\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e            \u0026#34;markdown\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e                \u0026#34;title\u0026#34;:\u0026#34;ArgoCD同步状态\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e                \u0026#34;text\u0026#34;: \u0026#34;### ArgoCD同步状态\\n\u0026gt; - app名称: {{.app.metadata.name}}\\n\u0026gt; - app同步状态: {{ .app.status.operationState.phase}}\\n\u0026gt; - 时间:{{.app.status.operationState.startedAt}}\\n\u0026gt; - URL: [点击跳转ArgoCD]({{.context.argocdUrl}}/applications/{{.app.metadata.name}}?operation=true) \\n\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e            }\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-deployed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application is synced and healthy. Triggered once per commit.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      oncePer: app.status.sync.revision\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]  # template names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      # trigger condition\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.operationState.phase in [\u0026#39;Succeeded\u0026#39;] and app.status.health.status == \u0026#39;Healthy\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-health-degraded\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application has degraded\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.health.status == \u0026#39;Degraded\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-sync-failed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application syncing has failed\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]  # template names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.operationState.phase in [\u0026#39;Error\u0026#39;, \u0026#39;Failed\u0026#39;]\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-sync-running\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application is being synced\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]  # template names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.operationState.phase in [\u0026#39;Running\u0026#39;]\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-sync-status-unknown\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application status is \u0026#39;Unknown\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]  # template names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.sync.status == \u0026#39;Unknown\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etrigger.on-sync-succeeded\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - description: Application syncing has succeeded\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      send: [app-sync-change]  # template names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      when: app.status.operationState.phase in [\u0026#39;Succeeded\u0026#39;]\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esubscriptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    - recipients: [dingtalk]  # 可能有bug，正常应该是webhook:dingtalk\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      triggers: [on-sync-running, on-deployed, on-sync-failed, on-sync-succeeded]\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eSecret\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-secret\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eOpaque\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eService\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk-metrics\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk-metrics\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emetrics\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e9001\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003etargetPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e9001\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eapps/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargo-cd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ematchLabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRecreate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003e/app/argocd-notifications-backend\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003econtroller\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargoprojlabs/argocd-notifications:v1.2.0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAlways\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003elivenessProbe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003etcpSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e9001\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumeMounts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003emountPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/app/config/tls\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls-certs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003emountPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/app/config/reposerver/tls\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-repo-server-tls\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eworkingDir\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/app\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003esecurityContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003erunAsNonRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eserviceAccountName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-notifications-controller-dingtalk\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003econfigMap\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-tls-certs-cm\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls-certs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-repo-server-tls\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003esecret\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls.crt\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls.crt\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls.key\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etls.key\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eca.crt\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eca.crt\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eoptional\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003esecretName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eargocd-repo-server-tls\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1 class=\"relative group\"\u003e3. argocd添加集群 \n    \u003cdiv id=\"3-argocd%E6%B7%BB%E5%8A%A0%E9%9B%86%E7%BE%A4\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#3-argocd%E6%B7%BB%E5%8A%A0%E9%9B%86%E7%BE%A4\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e通过命令行形式添加\u003c/p\u003e","title":"Devops之ArgoCD部署","type":"blog"},{"content":" 1.自动化构建 # 通过在需要自动化的步骤，指定rules对应commit分支即可，自动触发该步骤 stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;自动化构建\u0026#34; rules: - if: \u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;master\u0026#34;\u0026#39; 2. 半自动化构建(参考友人方案） # 设定好需要执行的commit分支以及触发半自动化构建的变量及值 该变量RUN_PIPELINE初始化值为false variables: RUN_PIPELINE: \u0026#39;false\u0026#39; stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;自动化构建\u0026#34; rules: - if: \u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;dev\u0026#34; \u0026amp;\u0026amp; $RUN_PIPELINE == \u0026#34;true\u0026#34;\u0026#39; 在项目根目录下创建git-push-ci.sh文件 #!/bin/bash # 检查当前分支是否为 dev current_branch=$(git rev-parse --abbrev-ref HEAD) if [ \u0026#34;$current_branch\u0026#34; != \u0026#34;dev\u0026#34; ]; then echo \u0026#34;Error: This script should only be run on the dev branch.\u0026#34; exit 1 fi # 设置 CI 变量并推送 git push origin dev -o ci.variable=\u0026#34;RUN_PIPELINE=true\u0026#34; echo \u0026#34;Pushed to dev branch with pipeline trigger.\u0026#34; 在全局用户git配置末尾添加 windows默认路径：C:\\Users\\Administrator\\.gitconfig [alias] push-ci = \u0026#34;!sh ./git-push-ci.sh\u0026#34; 提交代码时，使用git push-ci代替git push，即可触发CICD流程 3. 手动构建 # 通过在需要手动执行的步骤，指定rules对应参数 stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} script: | echo \u0026#34;手动构建\u0026#34; rules: - if: \u0026#39;$EXECUTE_MODE == \u0026#34;manual\u0026#34;\u0026#39; 在gitlab界面，手动点Run pipeline按钮进去 选择需要执行的分支，输入上一步定义变量及值 即可手动执行CICD流程 ","date":"2024-09-11","externalUrl":null,"permalink":"/devops/20240911-1/","section":"云原生AI技术","summary":"\u003ch1 class=\"relative group\"\u003e1.自动化构建 \n    \u003cdiv id=\"1%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e通过在需要自动化的步骤，指定rules对应commit分支即可，自动触发该步骤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;自动化构建\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;master\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1 class=\"relative group\"\u003e2. 半自动化构建(参考友人方案） \n    \u003cdiv id=\"2-%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%8F%82%E8%80%83%E5%8F%8B%E4%BA%BA%E6%96%B9%E6%A1%88\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#2-%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%8F%82%E8%80%83%E5%8F%8B%E4%BA%BA%E6%96%B9%E6%A1%88\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e设定好需要执行的commit分支以及触发半自动化构建的变量及值\n\u003cul\u003e\n\u003cli\u003e该变量\u003ccode\u003eRUN_PIPELINE\u003c/code\u003e初始化值为\u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eRUN_PIPELINE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;false\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;自动化构建\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$CI_COMMIT_REF_NAME == \u0026#34;dev\u0026#34; \u0026amp;\u0026amp; $RUN_PIPELINE == \u0026#34;true\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e在项目根目录下创建\u003ccode\u003egit-push-ci.sh\u003c/code\u003e文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 检查当前分支是否为 dev\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecurrent_branch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003egit rev-parse --abbrev-ref HEAD\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$current_branch\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;dev\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Error: This script should only be run on the dev branch.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 设置 CI 变量并推送\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit push origin dev -o ci.variable\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;RUN_PIPELINE=true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Pushed to dev branch with pipeline trigger.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e在全局用户git配置末尾添加\n\u003cul\u003e\n\u003cli\u003ewindows默认路径：C:\\Users\\Administrator\\.gitconfig\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-conf\" data-lang=\"conf\"\u003e[alias]\n  push-ci = \u0026#34;!sh ./git-push-ci.sh\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e提交代码时，使用\u003ccode\u003egit push-ci\u003c/code\u003e代替\u003ccode\u003egit push\u003c/code\u003e，即可触发CICD流程\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e3. 手动构建 \n    \u003cdiv id=\"3-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#3-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e通过在需要手动执行的步骤，指定rules对应参数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild_docker\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e${KANIKO_IMAGE}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e    echo \u0026#34;手动构建\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$EXECUTE_MODE == \u0026#34;manual\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e在gitlab界面，手动点\u003ccode\u003eRun pipeline\u003c/code\u003e按钮进去\n\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./1.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/li\u003e\n\u003cli\u003e选择需要执行的分支，输入上一步定义变量及值\n\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./2.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/li\u003e\n\u003cli\u003e即可手动执行CICD流程\u003c/li\u003e\n\u003c/ul\u003e","title":"Devops之CI三种触发构建","type":"blog"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/kubernetes/","section":"Tags","summary":"","title":"Kubernetes","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/","section":"欢迎来到云一二三知识库! 🎉","summary":"","title":"欢迎来到云一二三知识库! 🎉","type":"page"},{"content":"","date":"2024-09-11","externalUrl":null,"permalink":"/devops/","section":"云原生AI技术","summary":"","title":"云原生AI技术","type":"devops"},{"content":" 1. 前言 # 参考：gitlab-runner学习资料大全\n本方案CI采用的是gitlab-ci，通过启动gitlab-runner去构建实现，理论上可以构建任意形式的制品，包括且不限于镜像、前端静态文件压缩包等。\n1.1 K8s 部署 Gitlab CI Runner # K8s 版本：1.20.10 GitLab CI 最大的作用是管理各个项目的构建状态。因此，运行构建任务这种浪费资源的事情交给一个独立的 Gitlab Runner 来做就会好很多，而且 Gitlab Runner 可以安装到不同的机器上 只要在项目中添加一个.gitlab-ci.yml文件，然后添加一个 Runner ，即可进行持续集成 官方文档：Install GitLab Runner | GitLab 1.2 介绍 # Pipeline：相当于一次构建任务，里面可以包含多个流程，如安装依赖、运行测试、编译、部署测试服务器、部署生产服务器等。任何提交或者 Merge Request 的合并都可以触发 Pipeline 构建 Stages：表示一个构建阶段。一次 Pipeline 中可定义多个 Stages 所有 Stages 会顺序运行，即当一个 Stage 完成后，下一个 Stage 才会开始 只有当所有 Stages 完成后，该构建任务才会成功 如果任何一个 Stage 失败，那么后面的 Stages 不会执行，该构建任务失败 Jobs：表示构建工作，即某个 Stage 里面执行的工作。一个 Stage 中可定义多个 Jobs 相同 Stage 中的 Jobs 会并行执行 相同 Stage 中的 Jobs 都执行成功时，该 Stage 才会成功 如果任何一个 Job 失败，那么该 Stage 失败，即该构建任务失败 Runner：执行 Gitlab CI 构建任务 2. gitlab-ci缓存配置 # 本项目通过minio的s3接口为gitlab-ci提供诸如maven依赖等缓存\n2.1 minio安装 # minio的helm包下载\nhelm repo add bitnami https://charts.bitnami.com/bitnami helm repo update helm pull bitnami/minio tar -xvf minio-14.7.5.tgz minio配置修改\nvalues.yaml mode: distributed ...... auth: ## @param auth.rootUser MinIO\u0026amp;reg; root username ## rootUser: minio ## @param auth.rootPassword Password for MinIO\u0026amp;reg; root user ## rootPassword: \u0026#34;minio123\u0026#34; ...... resourcesPreset: \u0026#34;2xlarge\u0026#34; ...... statefulset: ## @param statefulset.replicaCount Number of pods per zone (only for MinIO\u0026amp;reg; distributed mode). Should be even and `\u0026gt;= 4` ## replicaCount: 4 ...... persistence: ## @param persistence.enabled Enable MinIO\u0026amp;reg; data persistence using PVC. If false, use emptyDir ## enabled: true ## @param persistence.storageClass PVC Storage Class for MinIO\u0026amp;reg; data volume ## If defined, storageClassName: \u0026lt;storageClass\u0026gt; ## If set to \u0026#34;-\u0026#34;, storageClassName: \u0026#34;\u0026#34;, which disables dynamic provisioning ## If undefined (the default) or set to null, no storageClassName spec is ## set, choosing the default provisioner. (gp2 on AWS, standard on ## GKE, AWS \u0026amp; OpenStack) ## storageClass: \u0026#34;\u0026#34; ## @param persistence.mountPath Data volume mount path ## mountPath: /bitnami/minio/data ## @param persistence.accessModes PVC Access Modes for MinIO\u0026amp;reg; data volume ## accessModes: - ReadWriteMany ## @param persistence.size PVC Storage Request for MinIO\u0026amp;reg; data volume ## size: 30Gi minio安装\n命名空间指定：-n minio #通过命令行设置密码不生效 #helm install -n minio minio bitnami/minio --set accessKey=minio,secretKey=minio123 helm install -n minio minio bitnami/minio -f ./values.yaml 2.2 minio数据迁移（如果之前配置过） # minio客户端下载 wget https:// dl.minio.org.cn/client/mc/release/linux-amd64/mc \u0026amp;\u0026amp; chmod -x mc \u0026amp;\u0026amp; mv mc /usr/bin minio服务端别名设置 mc alias set minio1 http://172.16.2.xx1:3xxx1 minio minio123 mc alias set minio2 http://172.16.2.xx2:3xxx2 minio minio123 数据通过命令迁移（如果配置低的话，会导致失败） mc mirror minio1/gitlabrb minio2/gitlabrb 数据下载后迁移（无视minio配置）, 因minio性能差，无法直接mc cp所有项目到minio仓库中，因此采用bash脚本逐个子项目上传 拷贝源minio仓库到本地：mc cp \u0026ndash;recursive minio1/gitlabrb ./ 拷贝本地仓库到minio仓库：mc cp $i minio2/gitlabrb/gitlabruner/project \u0026ndash;recursive \u0026ndash;recursive：递归cp目录 list中为原minio上gitlabrb/gitlabruner/project下的子目录 #!/bin/bash list=(1040 1196 1197 1198 1199 1205 1222 1239 1271 1272 1273 1274 1279 1294 1304 1311 1314 1326 1334 1335 1336 1338 1342 1357 1360 1460 1476 1483 275 357 361 362 368 370 374 375 376 377 378 379 381 382 383 406 407) for i in ${list[@]};do mc cp $i minio2/gitlabrb/gitlabruner/project --recursive sleep 5 done 3. gitlab-runner安装 # gitlab-runner.yaml gitlab地址：CI_SERVER_URL runner并发数：RUNNER_REQUEST_CONCURRENCY minio-bucket地址：CACHE_PATH minio地址：CACHE_S3_SERVER_ADDRESS 允许http的minio服务：CACHE_S3_INSECURE: \u0026ldquo;true\u0026rdquo; gitlab-group的密钥，需经过base64处理(echo xxxxxxs | base64 -w0)：GITLAB_CI_TOKEN http://gitlab.south.com/admin/runners -\u0026gt; xxxs apiVersion: v1 kind: ServiceAccount metadata: name: gitlab-ci namespace: gitlab --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: name: gitlab-ci namespace: gitlab rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;*\u0026#34;] verbs: [\u0026#34;*\u0026#34;] --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: gitlab-ci namespace: gitlab subjects: - kind: ServiceAccount name: gitlab-ci namespace: gitlab roleRef: kind: Role name: gitlab-ci apiGroup: rbac.authorization.k8s.io --- apiVersion: v1 kind: ConfigMap metadata: labels: app: gitlab-ci-runner name: gitlab-ci-runner-cm namespace: gitlab data: REGISTER_NON_INTERACTIVE: \u0026#34;true\u0026#34; REGISTER_LOCKED: \u0026#34;false\u0026#34; METRICS_SERVER: \u0026#34;0.0.0.0:9100\u0026#34; CI_SERVER_URL: \u0026#34;https://git.xxx.cn\u0026#34; # * RUNNER_REQUEST_CONCURRENCY: \u0026#34;6\u0026#34; RUNNER_EXECUTOR: \u0026#34;kubernetes\u0026#34; KUBERNETES_NAMESPACE: \u0026#34;gitlab\u0026#34; # * KUBERNETES_PRIVILEGED: \u0026#34;true\u0026#34; KUBERNETES_CPU_LIMIT: \u0026#34;2\u0026#34; KUBERNETES_MEMORY_LIMIT: \u0026#34;10Gi\u0026#34; KUBERNETES_MEMORY_REQUEST: \u0026#34;8Gi\u0026#34; KUBERNETES_SERVICE_CPU_LIMIT: \u0026#34;1\u0026#34; KUBERNETES_SERVICE_CPU_REQUEST: \u0026#34;1\u0026#34; KUBERNETES_SERVICE_MEMORY_LIMIT: \u0026#34;10Gi\u0026#34; KUBERNETES_SERVICE_MEMORY_REQUEST: \u0026#34;8Gi\u0026#34; KUBERNETES_HELPER_CPU_LIMIT: \u0026#34;1000m\u0026#34; KUBERNETES_HELPER_CPU_REQUEST: \u0026#34;500m\u0026#34; KUBERNETES_HELPER_MEMORY_LIMIT: \u0026#34;3000Mi\u0026#34; KUBERNETES_HELPER_MEMORY_REQUEST: \u0026#34;2000Mi\u0026#34; KUBERNETES_PULL_POLICY: \u0026#34;if-not-present\u0026#34; KUBERNETES_TERMINATIONGRACEPERIODSECONDS: \u0026#34;10\u0026#34; KUBERNETES_POLL_INTERVAL: \u0026#34;5\u0026#34; KUBERNETES_POLL_TIMEOUT: \u0026#34;360\u0026#34; CACHE_TYPE: \u0026#34;s3\u0026#34; CACHE_PATH: \u0026#34;gitlabruner\u0026#34; CACHE_SHARED: \u0026#34;true\u0026#34; CACHE_S3_SERVER_ADDRESS: \u0026#34;10.96.1.175:9000\u0026#34; CACHE_S3_ACCESS_KEY: \u0026#34;minio\u0026#34; CACHE_S3_SECRET_KEY: \u0026#34;minio123\u0026#34; CACHE_S3_BUCKET_NAME: \u0026#34;gitlabrb\u0026#34; CACHE_S3_INSECURE: \u0026#34;true\u0026#34; --- apiVersion: v1 kind: Secret metadata: name: gitlab-ci-token namespace: gitlab labels: app: gitlab-ci-runner data: GITLAB_CI_TOKEN: xxxxaXZjxxxxxxhUV25txxxx # echo xxxxf4SxxxT7fqxHSxxxx | base64 -w0 --- apiVersion: v1 kind: ConfigMap metadata: labels: app: gitlab-ci-runner name: gitlab-ci-runner-scripts namespace: gitlab data: run.sh: | #!/bin/bash unregister() { kill %1 echo \u0026#34;Unregistering runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner unregister -t \u0026#34;$(/usr/bin/gitlab-ci-multi-runner list 2\u0026gt;\u0026amp;1 | tail -n1 | awk \u0026#39;{print $4}\u0026#39; | cut -d\u0026#39;=\u0026#39; -f2)\u0026#34; -n ${RUNNER_NAME} exit $? } trap \u0026#39;unregister\u0026#39; EXIT HUP INT QUIT PIPE TERM echo \u0026#34;Registering runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner register -r ${GITLAB_CI_TOKEN} --tls-ca-file /opt/gitlab-runner/certs/gitlab.crt #/usr/bin/gitlab-ci-multi-runner register -r ${GITLAB_CI_TOKEN} --tls-ca-file /opt/gitlab-runner/certs/gitlab.crt --docker-volumes \u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34; --docker-volumes \u0026#34;/usr/bin/docker:/usr/bin/docker\u0026#34; sed -i \u0026#39;s/^concurrent.*/concurrent = \u0026#39;\u0026#34;${RUNNER_REQUEST_CONCURRENCY}\u0026#34;\u0026#39;/\u0026#39; /home/gitlab-runner/.gitlab-runner/config.toml echo \u0026#34;Starting runner ${RUNNER_NAME} ...\u0026#34; /usr/bin/gitlab-ci-multi-runner run -n ${RUNNER_NAME} \u0026amp; wait --- apiVersion: apps/v1 kind: StatefulSet metadata: name: gitlab-ci-runner namespace: gitlab labels: app: gitlab-ci-runner spec: updateStrategy: type: RollingUpdate replicas: 6 serviceName: gitlab-ci-runner selector: matchLabels: app: gitlab-ci-runner template: metadata: labels: app: gitlab-ci-runner spec: volumes: - name: mypvc hostPath: path: /data/gitlab-runner/certs - name: gitlab-ci-runner-scripts projected: sources: - configMap: name: gitlab-ci-runner-scripts items: - key: run.sh path: run.sh mode: 0755 serviceAccountName: gitlab-ci securityContext: runAsNonRoot: true runAsUser: 999 supplementalGroups: [999] containers: - image: xxx/gitlab-runner:latest name: gitlab-ci-runner command: - /scripts/run.sh envFrom: - configMapRef: name: gitlab-ci-runner-cm - secretRef: name: gitlab-ci-token env: - name: RUNNER_NAME valueFrom: fieldRef: fieldPath: metadata.name ports: - containerPort: 9100 name: http-metrics protocol: TCP #securityContext: #runAsUser: 0 #securityContext: {} volumeMounts: - name: gitlab-ci-runner-scripts mountPath: \u0026#34;/scripts\u0026#34; readOnly: true - name: mypvc mountPath: /opt/gitlab-runner/certs #- name: gitlab-runner-pv #mountPath: /opt/cache #- name: docker-sock #mountPath: /var/run/docker.sock #readOnly: true #- name: docker-use #mountPath: /usr/bin/docker #readOnly: true restartPolicy: Always 4. ci使用 # 在git项目中配置gitlab-ci.yml 提交git项目,自动触发 4.1 gitlab-ci中环境变量设置 # 通过管理员账号设置Variables后，ci运行时可获得对应变量值 4.2 maven项目配置缓存 # 缓存目录: .m2/* maven仓库缓存配置(maven镜像中设置了repository为当前路径下的.m2/repository): .m2/repository maven工程产生的结果zip文件缓存配置: .m2/xxx-server-1.0.0-SNAPSHOT.zip image: nnntln/3.6.1-jdk-8:latest variables: MAVEN_OPTS: -Dmaven.repo.local=/cache/maven.repository cache: key: PortalReportBackend paths: - .m2/repository stages: - build - execute build: stage: build cache: key: PortalReportBackend paths: - .m2 script: /usr/lib/jvm/java-8-openjdk-amd64/bin/javac Hello.java artifacts: paths: - Hello.* execute: stage: execute script: /usr/lib/jvm/java-8-openjdk-amd64/bin/java Hello 4.3 node项目配置缓存 # cache: key: 项目名 paths: - $(pwd)/.yarn-cache - node_modules/ install: image: node:latest stage: Install script: - echo \u0026#39;nameserver 223.5.5.5\u0026#39;\u0026gt;\u0026gt;/etc/resolv.conf - yarn config set registry \u0026#39;https://registry.npm.taobao.org\u0026#39; - yarn config set sass_binary_site \u0026#34;https://npm.taobao.org/mirrors/node-sass/\u0026#34; - yarn config set phantomjs_cdnurl \u0026#34;http://cnpmjs.org/downloads\u0026#34; - yarn config set electron_mirror \u0026#34;https://npm.taobao.org/mirrors/electron/\u0026#34; - yarn config set sqlite3_binary_host_mirror \u0026#34;https://foxgis.oss-cn-shanghai.aliyuncs.com/\u0026#34; - yarn config set profiler_binary_host_mirror \u0026#34;https://npm.taobao.org/mirrors/node-inspector/\u0026#34; - yarn config set chromedriver_cdnurl \u0026#34;https://cdn.npm.taobao.org/dist/chromedriver\u0026#34; - yarn config set cache-folder $(pwd)/.yarn-cache ","date":"2024-09-09","externalUrl":null,"permalink":"/devops/20240909-2/","section":"云原生AI技术","summary":"\u003ch1 class=\"relative group\"\u003e1. 前言 \n    \u003cdiv id=\"1-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%89%8D%E8%A8%80\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca href=\"https://blog.csdn.net/github_35631540/category_10804590.html\" target=\"_blank\"\u003egitlab-runner学习资料大全\u003c/a\u003e\u003c/p\u003e","title":"Devops之gitlab-ci部署","type":"blog"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/docker/","section":"Tags","summary":"","title":"Docker","type":"tags"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/gitlab-runner/","section":"Tags","summary":"","title":"Gitlab-Runner","type":"tags"},{"content":"","date":"2024-09-09","externalUrl":null,"permalink":"/tags/kaniko/","section":"Tags","summary":"","title":"Kaniko","type":"tags"},{"content":" 1. kaniko介绍 # kaniko 是一种工具，用于在容器或 Kubernetes 集群内从 Dockerfile 构建容器镜像。 与docker不同，Kaniko 并不依赖于Docker daemon进程，完全是在用户空间根据Dockerfile的内容逐行执行命令来构建镜像，这就使得在一些无法获取 docker daemon 进程的环境下也能够构建镜像，比如在标准的Kubernetes Cluster上。 Kaniko 以容器镜像的方式来运行的，同时需要三个参数: Dockerfile，上下文，以及远端镜像仓库的地址。 Kaniko会先提取基础镜像(Dockerfile FROM 之后的镜像)的文件系统 然后根据Dockerfile中所描述的，一条条执行命令，每一条命令执行完以后会在用户空间下面创建一个snapshot，并与存储与内存中的上一个状态进行比对，如果有变化，就将新的修改生成一个镜像层添加在基础镜像上，并且将相关的修改信息写入镜像元数据中 等所有命令执行完，kaniko会将最终镜像推送到指定的远端镜像仓库。 2. kaniko镜像构建 # 根据自定义的harbor仓库给kaniko镜像配置权限\n构建命令 docker build -t harbor.xxx.cn/tools/executor:v1.23.2-debug . config.json 通过echo -n admin:xxx |base64生成一个base64的密钥，例如xxtaW46SGFyYm9yxxx harbor私库地址：harbor.xxx.cn {\u0026#34;auths\u0026#34;:{\u0026#34;harbor.xxx.cn\u0026#34;:{\u0026#34;auth\u0026#34;:\u0026#34;xxtaW46SGFyYm9yxxx\u0026#34;}}} Dockerfile harbor私库地址：harbor.xxx.cn FROM gcr.io/kaniko-project/executor:v1.23.2-debug ENV HARBOR_REGISTRY=harbor.xxx.cn COPY config.json /kaniko/.docker/config.json 3. 在gitlab-ci中使用kaniko构建镜像 # .gitlab-ci.yml Dockerfile文件需与.gitlab-ci.yml放在同一级目录或指定目录也可 \u0026ndash;dockerfile：指定 Docker file 文件路径 \u0026ndash;insecure：指定无 HTTPS 的 Harbor 仓库地址 \u0026ndash;skip-tls-verify: 如果harbor私库没有配置https，则使用此配置跳过验证 \u0026ndash;destination：设置打过 Harbor 仓库标签的镜像名称及版本号 cache: key: ${CI_PROJECT_NAME} paths: - .venv/ stages: - build_docker build_docker: stage: build_docker image: name: ${KANIKO_IMAGE} cache: key: ${CI_PROJECT_NAME} paths: - .venv/ script: | ls -la ./ cp -r /builds/xxxx/${CI_PROJECT_NAME}/* /workspace cp -r .venv /workspace if [ \u0026#34;${CI_COMMIT_REF_NAME}\u0026#34; == \u0026#34;master\u0026#34; ]; then /kaniko/executor --build-arg CI_PROJECT_NAME=${CI_PROJECT_NAME} --dockerfile Dockerfile --skip-tls-verify --destination ${HARBOR_REGISTRY}/xxxx/${CI_PROJECT_NAME}:$VERSION_VAR else /kaniko/executor --build-arg CI_PROJECT_NAME=${CI_PROJECT_NAME} --dockerfile Dockerfile --skip-tls-verify --destination ${HARBOR_REGISTRY}/xxxx/${CI_PROJECT_NAME}:$VERSION_VAR fi 4. 报错解决 # 4.1 Error: kaniko should only be run inside of a container # 这是因为Docker Engine 20.10 引入了一个已知的不兼容问题，当主机使用 Docker Engine 20.10 或更高版本时，低于 v1.9.0 的版本中的 gcr.io/kaniko-project/executor:debug 镜像无法按预期工作。 当尝试构建映像时，Kaniko会失败，并显示：\nkaniko should only be run inside of a container, run with the --force flag if you are sure you want to continue 解决方案 要解决此问题，请将 gcr.io/kaniko-project/executor:debug 容器更新到至少 v1.9.0 的版本，例如 gcr.io/kaniko-project/executor:v1.23.2-debug 而反过来，（版本 19.06.x 或更早版本中主机上的 gcr.io/kaniko-project/executor:v1.23.2-debug 映像和 Docker 引擎）可以正常工作。为了获得最佳策略，您应该经常测试作业环境版本并将其更新到最新版本。这带来了新功能、更高的安全性，并且对于这种特定情况，使运行器主机上底层 Docker Engine 的升级对作业透明。\n","date":"2024-09-09","externalUrl":null,"permalink":"/devops/20240909-1/","section":"云原生AI技术","summary":"\u003ch1 class=\"relative group\"\u003e1. kaniko介绍 \n    \u003cdiv id=\"1-kaniko%E4%BB%8B%E7%BB%8D\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-kaniko%E4%BB%8B%E7%BB%8D\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/GoogleContainerTools/kaniko\" target=\"_blank\"\u003ekaniko\u003c/a\u003e 是一种工具，用于在容器或 Kubernetes 集群内从 Dockerfile 构建容器镜像。\u003c/li\u003e\n\u003cli\u003e与docker不同，Kaniko 并不依赖于Docker daemon进程，完全是在用户空间根据Dockerfile的内容逐行执行命令来构建镜像，这就使得在一些无法获取 docker daemon 进程的环境下也能够构建镜像，比如在标准的Kubernetes Cluster上。\u003c/li\u003e\n\u003cli\u003eKaniko 以容器镜像的方式来运行的，同时需要三个参数: Dockerfile，上下文，以及远端镜像仓库的地址。\n\u003cul\u003e\n\u003cli\u003eKaniko会先提取基础镜像(Dockerfile FROM 之后的镜像)的文件系统\u003c/li\u003e\n\u003cli\u003e然后根据Dockerfile中所描述的，一条条执行命令，每一条命令执行完以后会在用户空间下面创建一个snapshot，并与存储与内存中的上一个状态进行比对，如果有变化，就将新的修改生成一个镜像层添加在基础镜像上，并且将相关的修改信息写入镜像元数据中\u003c/li\u003e\n\u003cli\u003e等所有命令执行完，kaniko会将最终镜像推送到指定的远端镜像仓库。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e2. kaniko镜像构建 \n    \u003cdiv id=\"2-kaniko%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#2-kaniko%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003e根据自定义的harbor仓库给kaniko镜像配置权限\u003c/p\u003e","title":"通过kaniko在容器中构建镜像","type":"blog"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/fnos/","section":"Tags","summary":"","title":"Fnos","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/kubernetes/","section":"Kubernetes","summary":"","title":"Kubernetes","type":"kubernetes"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/mount/","section":"Tags","summary":"","title":"Mount","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/nas/","section":"Tags","summary":"","title":"Nas","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tags/path/","section":"Tags","summary":"","title":"Path","type":"tags"},{"content":"","date":"2024-09-08","externalUrl":null,"permalink":"/tools/","section":"工具合集","summary":"","title":"工具合集","type":"tools"},{"content":" 1. 批量删除卸载docker遗留的大量挂载路径 # 可自定义路径： /var/lib/bak-docker/overlay2 /var/lib/bak-docker/containers #!/bin/bash # 执行 df -h 命令并将输出存储到变量中 disk_output=$(df -h) # 定义两个正则表达式来匹配目标路径 regex_overlay=\u0026#34;/var/lib/bak-docker/overlay2/[a-fA-F0-9]{64}/merged\u0026#34; regex_containers=\u0026#34;/var/lib/bak-docker/containers/[a-zA-Z0-9.-]+\u0026#34; # 使用grep匹配包含特定路径的行，并提取路径 while read -r line; do if [[ $line =~ $regex_overlay || $line =~ $regex_containers ]]; then # 提取路径 path=$(echo $line | awk \u0026#39;{print $6}\u0026#39;) echo \u0026#34;Found path: $path\u0026#34; # 检查路径是否存在，存在则卸载 if [ -d \u0026#34;$path\u0026#34; ]; then if ! mountpoint -q \u0026#34;$path\u0026#34;; then echo \u0026#34;Path $path is not mounted.\u0026#34; else umount \u0026#34;$path\u0026#34; echo \u0026#34;Unmounted $path\u0026#34; fi else echo \u0026#34;Path $path does not exist.\u0026#34; fi fi done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$disk_output\u0026#34; ","date":"2024-09-08","externalUrl":null,"permalink":"/kubernetes/20240908-1/","section":"Kubernetes","summary":"\u003ch1 class=\"relative group\"\u003e1. 批量删除卸载docker遗留的大量挂载路径 \n    \u003cdiv id=\"1-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%8D%B8%E8%BD%BDdocker%E9%81%97%E7%95%99%E7%9A%84%E5%A4%A7%E9%87%8F%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%8D%B8%E8%BD%BDdocker%E9%81%97%E7%95%99%E7%9A%84%E5%A4%A7%E9%87%8F%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e可自定义路径：\n\u003cul\u003e\n\u003cli\u003e/var/lib/bak-docker/overlay2\u003c/li\u003e\n\u003cli\u003e/var/lib/bak-docker/containers\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 执行 df -h 命令并将输出存储到变量中\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edisk_output\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edf -h\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 定义两个正则表达式来匹配目标路径\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eregex_overlay\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/var/lib/bak-docker/overlay2/[a-fA-F0-9]{64}/merged\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eregex_containers\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/var/lib/bak-docker/containers/[a-zA-Z0-9.-]+\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 使用grep匹配包含特定路径的行，并提取路径\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"nb\"\u003eread\u003c/span\u003e -r line\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e~ \u003cspan class=\"nv\"\u003e$regex_overlay\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e~ \u003cspan class=\"nv\"\u003e$regex_containers\u003c/span\u003e \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# 提取路径\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print $6}\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Found path: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# 检查路径是否存在，存在则卸载\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -d \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e ! mountpoint -q \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Path \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e is not mounted.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                umount \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Unmounted \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Path \u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"s2\"\u003e does not exist.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$disk_output\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"批量删除卸载docker遗留的大量挂载路径","type":"blog"},{"content":" 0. 前言 # 飞牛云推出的飞牛云nas操作系统，FnOS基于最新 Linux 内核（Debian 发行版）深度开发，兼容主流 x86 硬件，自由组装 NAS，灵活扩展外部存储 飞牛云官网\n1. 安装步骤 # 本文通过vmware虚拟机进行FnOS的安装操作，主打体验\n1.1 创建虚拟机 # 点击vmware主页创建新的虚拟机 选择稍后安装操作系统 选择Linux操作系统 选择Debian 9.x（FnOS基于此开发） 选择虚拟机所在目录 给虚拟机分配存储空间 给虚拟机分配内存、cpu等资源 设置合适的内存、cpu大小 给虚拟机选择操作系统镜像 选择提前下载好的trim.iso镜像文件 点击开启此虚拟机，进行虚拟机的安装操作 选择分配好的虚拟硬盘 设置系统分区大小，根据硬盘富裕程度分配 格式化该虚拟硬盘 等待安装 安装完成 等待几秒自动进入系统 弹出系统终端界面，安装成功 然后可以将vmware虚拟机最小化了，接下来操作都将在浏览器完成 根据终端给出给出的Web UI地址（默认端口是8000）去浏览器访问 2. 使用步骤 # 2.1 第一次登陆 # 浏览器输入第一步安装完成后给出的WebUI地址 第一次登陆，设置用户名/密码 此步骤设置的用户名密码即为FnOS底层debian系统的管理员用户与密码 2.2 第二次登陆 # 浏览器输入第一步安装完成后给出的WebUI地址 输入设置好的用户名/密码 2.3 享受国产Nas吧 # ","date":"2024-09-08","externalUrl":null,"permalink":"/tools/20240908-1/","section":"工具合集","summary":"\u003ch1 class=\"relative group\"\u003e0. 前言 \n    \u003cdiv id=\"0-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#0-%E5%89%8D%E8%A8%80\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003e飞牛云推出的飞牛云nas操作系统，FnOS基于最新 Linux 内核（Debian 发行版）深度开发，兼容主流 x86 硬件，自由组装 NAS，灵活扩展外部存储\n\u003ca href=\"https://www.fnnas.com/download?key=fnos\" target=\"_blank\"\u003e飞牛云官网\u003c/a\u003e\u003c/p\u003e","title":"通过vmware虚拟机安装国产nas系统FnOS","type":"blog"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/frp/","section":"Tags","summary":"","title":"Frp","type":"tags"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/net/","section":"Tags","summary":"","title":"Net","type":"tags"},{"content":"","date":"2024-09-07","externalUrl":null,"permalink":"/tags/proxy/","section":"Tags","summary":"","title":"Proxy","type":"tags"},{"content":" 0. 前言 # 本文主要用于通过一台具有公网ip地址的服务器来代理可访问公网的nas内部的局域网服务，需注意的是本方案存在一定的被黑客攻击风险，需谨慎使用。\n1. frps配置及部署（服务端） # 部署在具有公网ip地址的服务器上\n运行命令 docker-compose -f docker-compose.yaml up -d docker-compose.yaml version: \u0026#39;3\u0026#39; services: frp: container_name: frps image: snowdreamtech/frps:0.60 network_mode: \u0026#34;host\u0026#34; environment: - TZ=Asia/Shanghai volumes: - \u0026#34;/data/software/frps/frps.toml:/etc/frp/frps.toml\u0026#34; restart: always 配置：frps.toml [common] bindAddr = 0.0.0.0 bind_port = 5xxx # 启用面板 dashboard_port = 5x1x # 面板登录名和密码 dashboard_user = xxx dashboard_pwd = xxxx # 使用http代理并使用5x2x端口进行穿透 vhost_http_port = 5x2x # 使用https代理并使用5x3x端口进行穿透 vhost_https_port = 5x3x # 日志路径 log_file = ./frps.log # 日志级别 log_level = info # 日志最大保存天数 log_max_days = 2 # 认证超时时间 authentication_timeout = 900 # 认证token，客户端需要和此对应 token=123456 # 最大连接数 max_pool_count = 50 max_ports_per_client = 0 2. frpc配置及部署（客户端） # 部署在可访问公网的nas上\n运行命令 docker-compose -f docker-compose.yaml up -d docker-compose.yaml version: \u0026#39;3\u0026#39; services: frp: container_name: frpc image: snowdreamtech/frpc:0.60 network_mode: \u0026#34;host\u0026#34; environment: - TZ=Asia/Shanghai volumes: - \u0026#34;/vol1/1000/frpc/frpc.toml:/etc/frp/frpc.toml\u0026#34; restart: always 配置：frpc.toml token、server_addr、server_port：对应frps的配置来填写 custom_domains、customDomains：如果没有域名，则填写frps服务器的ip地址 remote_port：设定frps服务器代理的端口 [common] server_addr = xx.xx.xx.xx server_port = 5xxx token = \u0026#34;123456\u0026#34; log.to = \u0026#34;./frpc.log\u0026#34; log.level = info log.maxDays = 3 log.disablePrintColor = false [[proxies]] name = xxxx type = http local_ip = 0.0.0.0 local_port = xxxx custom_domains = frps.ip customDomains = xx.xx.xx remote_port = 5x2x ","date":"2024-09-07","externalUrl":null,"permalink":"/tools/20240907-1/","section":"工具合集","summary":"\u003ch1 class=\"relative group\"\u003e0. 前言 \n    \u003cdiv id=\"0-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#0-%E5%89%8D%E8%A8%80\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003e本文主要用于通过一台具有公网ip地址的服务器来代理可访问公网的nas内部的局域网服务，需注意的是本方案存在一定的被黑客攻击风险，需谨慎使用。\u003c/p\u003e","title":"内网穿透工具FRP使用","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/ai/","section":"Tags","summary":"","title":"Ai","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/backup/","section":"Tags","summary":"","title":"Backup","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/cloud/","section":"Tags","summary":"","title":"Cloud","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/harbor/","section":"Tags","summary":"","title":"Harbor","type":"tags"},{"content":" 1. 待迁移Harbor仓库配置 # 1.1 通过仓库管理添加新Harbor仓库关联 # 新建目标 添加对应Harbor仓库信息 添加具有创建空间权限的用户名、密码 测试连接是否成功 保存 1.2 通过复制管理添加待复制空间的规则 # 新建规则 选择复制模式 配置资源过滤器条件：不填，则默认复制全部镜像，可定义单个命名空间: xxx/** 选择目标仓库（1.1中增加的仓库） 选择触发模式（默认手动） 2. 开始迁移 # 选中复制管理里新建的规则，点击复制按钮开始复制 查看进度 ","date":"2024-09-02","externalUrl":null,"permalink":"/cloudnative/20240902-1/","section":"云原生","summary":"\u003ch5 id=\"typeit-44468b13ec0e2d9a786f3228a14e74ca\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-44468b13ec0e2d9a786f3228a14e74ca\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e1. 待迁移Harbor仓库配置 \n    \u003cdiv id=\"1-%E5%BE%85%E8%BF%81%E7%A7%BBharbor%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%BE%85%E8%BF%81%E7%A7%BBharbor%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 通过仓库管理添加新Harbor仓库关联 \n    \u003cdiv id=\"11-%E9%80%9A%E8%BF%87%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E6%B7%BB%E5%8A%A0%E6%96%B0harbor%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E9%80%9A%E8%BF%87%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E6%B7%BB%E5%8A%A0%E6%96%B0harbor%E4%BB%93%E5%BA%93%E5%85%B3%E8%81%94\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cp\u003e\n    \u003cfigure\u003e\n      \u003cimg class=\"my-0 rounded-md\" loading=\"lazy\" src=\"./1.png\" alt=\"image.png\" /\u003e\n      \n    \u003c/figure\u003e\n\u003c/p\u003e","title":"Harbor镜像仓库迁移","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/image/","section":"Tags","summary":"","title":"Image","type":"tags"},{"content":" 注意 # 需要注意的是kserve使用的模型下载链接storageUri: \u0026quot;http://172.16.2.132:9999/00000123.tar\u0026quot;对应的模型压缩包：应该是解压后模型及配置文件平铺开来的，而不是解压后还有一层目录包裹的 同时对于storageUri: \u0026quot;http://172.16.2.132:9999/00000123\u0026quot;的模型链接，00000123里面的内容应该直接是模型及配置文件，而不应该再有深层次的目录 1. kserve-0.10.0版本安装 # 1.1 kserve与依赖版本对应 # K8s v1.22.15 KServe v0.10.0 Cert-manager v1.11.0 Ingress-nginx（与k8s版本对应关系） v1.3.0 1.2 部署ingress-nginx # 采用RawDeployment模式，因此不需要按照官网要求安装Istio（Istio较重）\n通过管理Ingress，控制路由，因此部署 Ingress-Nginx 即可。 kubectl apply -f nginx-ingress-1.3.1.yml 1.3 部署CertManager # kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.yaml 1.4 部署Kserve # 需修改kserve.yaml中ingressClassName为创建的IngressClass（本例为nginx） ingress: |- { \u0026#34;ingressClassName\u0026#34; : \u0026#34;nginx\u0026#34;, } # 下载 wget https://github.com/kserve/kserve/releases/download/v0.10.0/kserve.yaml # 修改以后部署 kubectl apply -f kserve.yaml # 下载 wget https://github.com/kserve/kserve/releases/download/v0.10.0/kserve-runtimes.yaml kubectl apply -f kserve-runtimes.yaml 修改inferenceservice-config部署模式为RawDeployment kubectl patch configmap/inferenceservice-config -n kserve --type=strategic -p \u0026#39;{\u0026#34;data\u0026#34;: {\u0026#34;deploy\u0026#34;: \u0026#34;{\\\u0026#34;defaultDeploymentMode\\\u0026#34;: \\\u0026#34;RawDeployment\\\u0026#34;}\u0026#34;}}\u0026#39; 1.5 测试 # 1.5.1 配置模型crd # demo-tensorflow.yaml name：tensorflow-kserve storageUri：http://172.16.2.132:9999/00000123.tar（采用文件服务器形式提供模型文件tar包或zip包，服务会自动解压） 模型下载链接，tags2 4 apiVersion: \u0026#34;serving.kserve.io/v1beta1\u0026#34; kind: \u0026#34;InferenceService\u0026#34; metadata: name: \u0026#34;tensorflow-kserve\u0026#34; spec: predictor: tensorflow: storageUri: \u0026#34;http://172.16.2.132:9999/00000123.tar\u0026#34; 1.5.2 使用ingress测试 # INGRESS_HOST：10.96.1.200（Ingress-nginx地址） MODEL_NAME：1.5.1定义的name INPUT_PATH：模型入参 #!/bin/bash # nginx ingress 的访问地址 INGRESS_HOST=10.96.1.200 INGRESS_PORT=80 MODEL_NAME=tensorflow-kserve INPUT_PATH=@./input.json SERVICE_HOSTNAME=$(kubectl get inferenceservice ${MODEL_NAME} -o jsonpath=\u0026#39;{.status.url}\u0026#39; | cut -d \u0026#34;/\u0026#34; -f 3) curl -H \u0026#34;Host: ${SERVICE_HOSTNAME}\u0026#34; http://${INGRESS_HOST}:${INGRESS_PORT}/v1/models/$MODEL_NAME:predict -d $INPUT_PATH input.json { \u0026#34;instances\u0026#34;:[1,2,3] } 结果如下 2. kserve-0.13.0版本安装 # 2.1 kserve与依赖版本对应 # K8s v1.29.7 KServe v0.13.0 Cert-manager v1.15.3 Ingress-nginx（与k8s版本对应关系） v1.11.2 2.2 部署ingress-nginx # 采用RawDeployment模式，因此不需要按照官网要求安装Istio（Istio较重）\n通过管理Ingress，控制路由，因此部署 Ingress-Nginx 即可。 本版本ingress-nginx采用helm安装 wget https://github.com/kubernetes/ingress-nginx/releases/download/helm-chart-4.11.2/ingress-nginx-4.11.2.tgz tar -zxf ingress-nginx-4.11.2.tgz helm install ingress-nginx ./ingress-nginx --namespace ingress-nginx --create-namespace 安装成功信息 (base) [root@node77 ingress-nginx]# kubectl get service --namespace ingress-nginx ingress-nginx-controller --output wide --watch NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR ingress-nginx-controller LoadBalancer 10.96.1.190 \u0026lt;pending\u0026gt; 80:32702/TCP,443:32064/TCP 37s app.kubernetes.io/component=controller,app.kubernetes.io/instance=ingress-nginx,app.kubernetes.io/name=ingress-nginx 2.3 部署 CertManager # kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.15.3/cert-manager.yaml 2.4 部署Kserve # 需修改kserve.yaml中ingressClassName为创建的IngressClass（本例为nginx） ingress: |- { \u0026#34;ingressClassName\u0026#34; : \u0026#34;nginx\u0026#34;, } 需要注意的是在kserve v0.13.0版本中kserve-runtimes.yaml组件改名为kserve-cluster-resources.yaml # 下载 wget https://github.com/kserve/kserve/releases/download/v0.13.0/kserve.yaml # 修改以后部署 kubectl apply -f kserve.yaml # 下载 wget https://github.com/kserve/kserve/releases/download/v0.13.0/kserve-cluster-resources.yaml kubectl apply -f kserve-cluster-resources.yaml 修改inferenceservice-config部署模式为RawDeployment kubectl patch configmap/inferenceservice-config -n kserve --type=strategic -p \u0026#39;{\u0026#34;data\u0026#34;: {\u0026#34;deploy\u0026#34;: \u0026#34;{\\\u0026#34;defaultDeploymentMode\\\u0026#34;: \\\u0026#34;RawDeployment\\\u0026#34;}\u0026#34;}}\u0026#39; 2.5 测试 # 2.5.1 配置模型crd # 创建namespace kubectl create namespace test demo-tensorflow.yaml 注意：在kserve v0.13.0版本中，模型发布需要发布在非default命名空间或是kserve具有权限的命名空间中，否则模型对应Pod会报错No such file or directory: '/mnt/models'，初步怀疑跟2.3部署的CertManager配置有关系，暂未深究 注意：kserve创建的模型发布不能发布在kserve命名空间以及没有权限的命名空间中，否则模型对应Pod会报错No such file or directory: '/mnt/models'，这是kserve的webhook检查导致的，具体可以参考这个issue name：tensorflow-kserve storageUri：http://172.16.2.132:9999/00000123.tar（采用文件服务器形式提供模型文件tar包或zip包，服务会自动解压） 模型下载链接，tags2 4 apiVersion: \u0026#34;serving.kserve.io/v1beta1\u0026#34; kind: \u0026#34;InferenceService\u0026#34; metadata: name: \u0026#34;tensorflow-kserve\u0026#34; namespace: \u0026#34;test\u0026#34; spec: predictor: tensorflow: storageUri: \u0026#34;http://172.16.2.132:9999/00000123.tar\u0026#34; 2.5.2 使用ingress测试 # INGRESS_HOST：10.96.0.158（Ingress-nginx地址） MODEL_NAME：2.5.1定义的name INPUT_PATH：模型入参 #!/bin/bash # nginx ingress 的访问地址 INGRESS_HOST=10.96.0.158 INGRESS_PORT=80 MODEL_NAME=tensorflow-kserve INPUT_PATH=@./input.json SERVICE_HOSTNAME=$(kubectl -n test get inferenceservice ${MODEL_NAME} -o jsonpath=\u0026#39;{.status.url}\u0026#39; | cut -d \u0026#34;/\u0026#34; -f 3) curl -H \u0026#34;Host: ${SERVICE_HOSTNAME}\u0026#34; http://${INGRESS_HOST}:${INGRESS_PORT}/v1/models/$MODEL_NAME:predict -d $INPUT_PATH input.json { \u0026#34;instances\u0026#34;:[1,2,3] } 结果如下 ","date":"2024-09-02","externalUrl":null,"permalink":"/cloudai/20240902-1/","section":"云原生AI技术","summary":"\u003ch5 id=\"typeit-975418dc18a096f280744c8894f6f973\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-975418dc18a096f280744c8894f6f973\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e注意 \n    \u003cdiv id=\"%E6%B3%A8%E6%84%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e需要注意的是kserve使用的模型下载链接\u003ccode\u003estorageUri: \u0026quot;http://172.16.2.132:9999/00000123.tar\u0026quot;\u003c/code\u003e对应的模型压缩包：应该是解压后模型及配置文件平铺开来的，而不是解压后还有一层目录包裹的\u003c/li\u003e\n\u003cli\u003e同时对于\u003ccode\u003estorageUri: \u0026quot;http://172.16.2.132:9999/00000123\u0026quot;\u003c/code\u003e的模型链接，00000123里面的内容应该直接是模型及配置文件，而不应该再有深层次的目录\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e1. kserve-0.10.0版本安装 \n    \u003cdiv id=\"1-kserve-0100%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-kserve-0100%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 kserve与依赖版本对应 \n    \u003cdiv id=\"11-kserve%E4%B8%8E%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-kserve%E4%B8%8E%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: left\"\u003eK8s\u003c/th\u003e\n          \u003cth style=\"text-align: left\"\u003ev1.22.15\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"https://github.com/kserve/kserve/releases/download/v0.10.0/kserve.yaml/\" target=\"_blank\"\u003eKServe\u003c/a\u003e\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev0.10.0\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"\"\u003eCert-manager\u003c/a\u003e\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev1.11.0\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: left\"\u003e\u003ca href=\"https://kubernetes.github.io/ingress-nginx/deploy/#quick-start\" target=\"_blank\"\u003eIngress-nginx\u003c/a\u003e（\u003ca href=\"https://github.com/kubernetes/ingress-nginx#supported-versions-table\" target=\"_blank\"\u003e与k8s版本对应关系\u003c/a\u003e）\u003c/td\u003e\n          \u003ctd style=\"text-align: left\"\u003ev1.3.0\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.2 部署ingress-nginx \n    \u003cdiv id=\"12-%E9%83%A8%E7%BD%B2ingress-nginx\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#12-%E9%83%A8%E7%BD%B2ingress-nginx\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e采用RawDeployment模式，因此不需要按照官网要求安装Istio（Istio较重）\u003c/p\u003e","title":"kserve安装使用","type":"blog"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/tags/machinelearning/","section":"Tags","summary":"","title":"Machinelearning","type":"tags"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/cloudnative/","section":"云原生","summary":"","title":"云原生","type":"cloudnative"},{"content":"","date":"2024-09-02","externalUrl":null,"permalink":"/cloudai/","section":"云原生AI技术","summary":"","title":"云原生AI技术","type":"cloudai"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/containerd/","section":"Tags","summary":"","title":"Containerd","type":"tags"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/k8s-solve/","section":"k8s问题解决与记录","summary":"","title":"k8s问题解决与记录","type":"k8s-solve"},{"content":"kubernetes问题解决集合。\n1. 宿主机修改时DNS（/etc/resolv.conf）配置 # 宿主机集群更改DNS服务(/etc/resolv.conf), 需同时重启nodelocaldns(部分集群高配nodelocaldns)及coredns服务 2. 进入CoreDNS容器内部操作 # 2.1 进入k8s的coredns容器查看信息: # 您可以按照此处的说明使用 sidecar 模式:https://support.rancher.com/hc/en-us/articles/360041568712-How-to-troubleshoot-using-the-namespace-of-a-container#sidecar-container-0-2\n2.2 简而言之，这样做是为了找到一个运行 coredns pod 的节点: # kubectl -n kube-system get po -o wide | grep coredns ssh 到这些节点之一，然后: docker ps -a | grep coredns 将容器 ID 复制到剪贴板并运行: ID=\u0026lt;paste ID here\u0026gt; docker run -it --net=container:$ID --pid=container:$ID --volumes-from=$ID alpine sh 您现在将位于“sidecar”容器内，可以四处查看。 cat /etc/coredns/Corefile 3. 带有nodelocaldns集群重启后dns异常 # nodenocaldns日志报错如下：\ncoredns HINFO: read tcp 10.233.90.147:44370-\u0026gt;172.16.1.207:53: i/o timeout 通过排查发现是nolocaldns的53指向不是集群的dns服务器\n修改nodecaldns的corefile\n将其中 forward . 10.233.90.242 手动改为forward . 10.233.0.3 10.233.0.3为coredns的vip地址 10.233.90.242为coredns的pod ip地址，重启pod后发生变动，因此采用vip作为指向 cluster.local:53 { errors cache { success 9984 30 denial 9984 5 } reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 health 169.254.25.10:9254 } in-addr.arpa:53 { errors cache 30 reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 } ip6.arpa:53 { errors cache 30 reload loop bind 169.254.25.10 forward . 10.233.0.3 { force_tcp } prometheus :9253 } .:53 { errors cache 30 reload loop bind 169.254.25.10 forward . /etc/resolv.conf prometheus :9253 } 重新观察nodelocaldns日志，服务正常\n4. K8S版本与Linux内核不兼容导致内存泄露问题 # 4.1 背景 # kubelet误报内存压力(实际内存使用率很小)-\u0026gt;节点被打污点-\u0026gt;节点上pod处于驱逐状态-\u0026gt;重启kubelet会恢复\nmkdir /sys/fs/cgroup/memory/kubepods/besteffort/pod54ca8314-ae1a-4d22-8564-fdd73215f1cc: cannot allocate memory Normal Scheduled 7m19s default-scheduler Successfully assigned default/kt-rectifier-rulla to node133 Warning FailedCreatePodContainer 2m1s (x26 over 7m20s) kubelet unable to ensure pod container exists: failed to create container for [kubepods besteffort pod54ca8314-ae1a-4d22-8564-fdd73215f1cc] : mkdir /sys/fs/cgroup/memory/kubepods/besteffort/pod54ca8314-ae1a-4d22-8564-fdd73215f1cc: cannot allocate memory 4.2 Cgroup # 在当前内核版本（3.x）下，开启了kmem accounting功能，会导致memory cgroup的条目泄漏无法回收。\n4.3 解决方案 # 4.3.1 重启内存泄露服务器（临时解决） # 4.3.2 升级内核版本-4.x（永久解决） # 具体升级方案参考《Centos7内核升级》一文 ","date":"2024-09-01","externalUrl":null,"permalink":"/k8s-solve/20240901-3/","section":"k8s问题解决与记录","summary":"\u003cp\u003ekubernetes问题解决集合。\u003c/p\u003e","title":"kubernetes问题解决集合","type":"blog"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/question/","section":"Tags","summary":"","title":"Question","type":"tags"},{"content":"","date":"2024-09-01","externalUrl":null,"permalink":"/tags/solve/","section":"Tags","summary":"","title":"Solve","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/crd/","section":"Tags","summary":"","title":"Crd","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/download/","section":"Tags","summary":"","title":"Download","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/file/","section":"Tags","summary":"","title":"File","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/gs/","section":"Tags","summary":"","title":"Gs","type":"tags"},{"content":"本文解决了k8s资源删除报Terminating卡住的问题。\n1.方案一 # 适用资源类型：pod、deploy、namespaces、crd\n使用kubectl delete crd卡住，用以下命令更新该资源的状态： kubectl patch crd/inferenceservices.serving.kserve.io -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:[]}}\u0026#39; --type=merge 2.方案2(优先方案一) # # 1.导出配置 kubectl get ns rook-ceph -o json \u0026gt; tmp.json # 2.删除tmp.json中spec及status部分的内容 # 3.启动代理 kubectl proxy # 4.调用接口删除 curl -k -H \u0026#34;Content-Type: application/json\u0026#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/rook-ceph/finalize ","date":"2024-08-29","externalUrl":null,"permalink":"/k8s-solve/20240829-2/","section":"k8s问题解决与记录","summary":"\u003cp\u003e本文解决了k8s资源删除报Terminating卡住的问题。\u003c/p\u003e","title":"k8s资源删除报Terminating卡住","type":"blog"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/namespace/","section":"Tags","summary":"","title":"Namespace","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/tags/terminating/","section":"Tags","summary":"","title":"Terminating","type":"tags"},{"content":"","date":"2024-08-29","externalUrl":null,"permalink":"/filedown/","section":"文件下载","summary":"","title":"文件下载","type":"filedown"},{"content":"本文提供了下载gs协议的文件方案。\n通过将gs://后的文件或文件夹地址拼接到https://storage.googleapis.com即可\n1. 原始文件地址 # gs://kfserving-examples/models/sklearn/1.0/model/model.joblib 2. 转换后的下载地址 # https://storage.googleapis.com/kfserving-examples/models/sklearn/1.0/model/model.joblib ","date":"2024-08-29","externalUrl":null,"permalink":"/filedown/20240829-1/","section":"文件下载","summary":"\u003cp\u003e本文提供了下载gs协议的文件方案。\u003c/p\u003e","title":"下载gs协议的文件","type":"blog"},{"content":"","date":"2024-08-26","externalUrl":null,"permalink":"/calico/","section":"calico","summary":"","title":"calico","type":"calico"},{"content":" 这是一个标题 # ","date":"2024-08-26","externalUrl":null,"permalink":"/calico/20240826-1/","section":"calico","summary":"\u003ch5 id=\"typeit-ccaa400c54080eb69775b832cdd583dd\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-ccaa400c54080eb69775b832cdd583dd\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e这是一个标题 \n    \u003cdiv id=\"%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e","title":"First","type":"calico"},{"content":" 这是一个标题 # ","date":"2024-08-26","externalUrl":null,"permalink":"/ceph/20240826-1/","section":"RookCeph存储","summary":"\u003ch5 id=\"typeit-4b3b2247ac91943a2fe576ae718ab317\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-4b3b2247ac91943a2fe576ae718ab317\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\n\n\u003ch1 class=\"relative group\"\u003e这是一个标题 \n    \u003cdiv id=\"%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e","title":"First","type":"ceph"},{"content":"","date":"2024-08-26","externalUrl":null,"permalink":"/ceph/","section":"RookCeph存储","summary":"","title":"RookCeph存储","type":"ceph"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/archives/","section":"Tags","summary":"","title":"Archives","type":"tags"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/blowfish/","section":"Tags","summary":"","title":"Blowfish","type":"tags"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/hugo/","section":"Tags","summary":"","title":"Hugo","type":"tags"},{"content":"添加时间轴，归档博客。\n1. 创建时间轴相关文件 # 1.1 创建archives.html文件 # 复制layouts/default目录下的single.html文件为archives.html,并用以下代码替代html中的{{ .Content }} {{ range (where .Pages \u0026ldquo;Type\u0026rdquo; \u0026ldquo;blog\u0026rdquo;) }}：用于仅展示content目录下类型为blog的md文件 {{ range (.Site.RegularPages.GroupByDate \u0026#34;2006\u0026#34;) }} \u0026lt;h3\u0026gt;{{ .Key }}\u0026lt;/h3\u0026gt; \u0026lt;ul class=\u0026#34;archive-list\u0026#34;\u0026gt; {{ range (where .Pages \u0026#34;Type\u0026#34; \u0026#34;blog\u0026#34;) }} \u0026lt;li\u0026gt; {{ .PublishDate.Format \u0026#34;2006-01-02\u0026#34; }} -\u0026gt; \u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34;\u0026gt;{{ .Title }}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; {{ end }} \u0026lt;/ul\u0026gt; {{ end }} 1.2 创建archives.md文件 # 在content目录下创建archives.md文件 --- title: \u0026#34;时间轴\u0026#34; layout: \u0026#34;archives\u0026#34; date: 2017-07-17 description: \u0026#34;历史文章按照年归档.\u0026#34; type: \u0026#34;archives\u0026#34; cascade: showDate: true showAuthor: true invertPagination: true --- 2. 添加配置 # 在config/_default/menus.zh-cn.toml中添加如下配置 [[main]] name = \u0026#34;时间轴\u0026#34; pageRef = \u0026#34;archives\u0026#34; weight = 300 ","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/20240825-3/","section":"Hugo博客相关","summary":"\u003cp\u003e添加时间轴，归档博客。\u003c/p\u003e","title":"hugo博客-blowfish主题添加时间轴","type":"blog"},{"content":"添加音乐组件，并在切换页面时保持音乐播放。\n1. 添加音乐组件 # 1.1 创建music.html文件 # 在layouts/partials目录下创建music.html文件，添加音乐对应参数说明 name: 音乐名， #\u0026lsquo;探故知\u0026rsquo; url: 音乐外链地址，#\u0026lsquo;http://music.163.com/song/media/outer/url?id=2613724903.mp3' artist: 音乐家，#\u0026lsquo;吉泽树\u0026rsquo; cover: 音乐封面，#\u0026lsquo;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp' \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- require APlayer --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- require MetingJS --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;demo\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;player1\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var ap = new APlayer ({ element: document.getElementById(\u0026#39;player1\u0026#39;), fixed: true, showlrc: false, autoplay: false, mini: true, theme: \u0026#39;#f8f4fc\u0026#39;, loop: \u0026#39;all\u0026#39;, order: \u0026#39;random\u0026#39;, preload: \u0026#39;auto\u0026#39;, volume: 0.4, mutex: true, listFolded: true, listMaxHeight: \u0026#39;500px\u0026#39;, lrcType: 0, music: [ { name: \u0026#39;探故知\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2613724903.mp3\u0026#39;, artist: \u0026#39;吉泽树\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;如果当时2020\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=1488737309.mp3\u0026#39;, artist: \u0026#39;许嵩,朱婷婷\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;如果云知道\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2109099118.mp3\u0026#39;, artist: \u0026#39;许茹芸\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;一生有你\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2017129217.mp3\u0026#39;, artist: \u0026#39;水木年华\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;觉悟\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2030542462.mp3\u0026#39;, artist: \u0026#39;王小帅\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, ] }); //ap.init(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; 2. 配置音乐组件在切换页面后仍保持播放 # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- require APlayer --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- require MetingJS --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;demo\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;player1\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var ap = new APlayer ({ element: document.getElementById(\u0026#39;player1\u0026#39;), fixed: true, showlrc: false, autoplay: false, mini: true, theme: \u0026#39;#f8f4fc\u0026#39;, loop: \u0026#39;all\u0026#39;, order: \u0026#39;random\u0026#39;, preload: \u0026#39;auto\u0026#39;, volume: 0.4, mutex: true, listFolded: true, listMaxHeight: \u0026#39;500px\u0026#39;, lrcType: 0, music: [ { name: \u0026#39;探故知\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2613724903.mp3\u0026#39;, artist: \u0026#39;吉泽树\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;如果当时2020\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=1488737309.mp3\u0026#39;, artist: \u0026#39;许嵩,朱婷婷\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;如果云知道\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2109099118.mp3\u0026#39;, artist: \u0026#39;许茹芸\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;一生有你\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2017129217.mp3\u0026#39;, artist: \u0026#39;水木年华\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, { name: \u0026#39;觉悟\u0026#39;, url: \u0026#39;http://music.163.com/song/media/outer/url?id=2030542462.mp3\u0026#39;, artist: \u0026#39;王小帅\u0026#39;, cover: \u0026#39;https://s1.best-wallpaper.net/wallpaper/m/1207/Kitten-greeting_m.webp\u0026#39; }, ] }); //ap.init(); isRecover = false; function ready(){ ap.on(\u0026#39;canplay\u0026#39;, function () { if(!isRecover){ if(localStorage.getItem(\u0026#34;musicIndex\u0026#34;) != null){ musicIndex = localStorage.getItem(\u0026#34;musicIndex\u0026#34;); musicTime = localStorage.getItem(\u0026#34;musicTime\u0026#34;); if(ap.list.index != musicIndex){ ap.list.switch(musicIndex); }else{ ap.seek(musicTime); ap.play(); localStorage.clear(); isRecover = true; } }else{ isRecover = true; } } }); } window.onbeforeunload = function(event) { if(!ap.audio.paused){ musicIndex = ap.list.index; musicTime = ap.audio.currentTime; localStorage.setItem(\u0026#34;musicIndex\u0026#34;,musicIndex); localStorage.setItem(\u0026#34;musicTime\u0026#34;,musicTime); } }; \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; ","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/20240825-2/","section":"Hugo博客相关","summary":"\u003cp\u003e添加音乐组件，并在切换页面时保持音乐播放。\u003c/p\u003e","title":"hugo博客-blowfish主题添加音乐组件","type":"blog"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/hugos/","section":"Hugo博客相关","summary":"","title":"Hugo博客相关","type":"hugos"},{"content":"","date":"2024-08-25","externalUrl":null,"permalink":"/tags/music/","section":"Tags","summary":"","title":"Music","type":"tags"},{"content":"","date":"2024-08-23","externalUrl":null,"permalink":"/tags/comments/","section":"Tags","summary":"","title":"Comments","type":"tags"},{"content":"添加giscus，用于博客交流。\n1. 创建评论相关文件 # 1.1 创建comments.html文件 # 在layouts/partials目录下创建comments.html 以下参数来自giscus，具体参考官网https://giscus.app/zh-CN \u0026lt;script src=\u0026#34;https://giscus.app/client.js\u0026#34; data-repo=\u0026#34;xxx/xxx\u0026#34; data-repo-id=\u0026#34;xxxx\u0026#34; data-category=\u0026#34;Announcements\u0026#34; data-category-id=\u0026#34;xxxx\u0026#34; data-mapping=\u0026#34;pathname\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; data-loading=\u0026#34;lazy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; 2. 添加配置 # 2.1 config.toml中添加配置 # 在themes/blowfish/config.toml中添加如下配置 以下参数来自giscus，具体参考官网https://giscus.app/zh-CN [params.giscus] data-repo=\u0026#34;xxx/xxxx\u0026#34; data-repo-id=\u0026#34;xxx\u0026#34; data-category=\u0026#34;Announcements\u0026#34; data-category-id=\u0026#34;xxx\u0026#34; data-mapping=\u0026#34;pathname\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; data-loading=\u0026#34;lazy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; 2.2 params.toml中添加配置 # config/_default/params.toml中添加如下配置 showComments = true [article] showDate = true ... showWordCount = true showComments = true ","date":"2024-08-23","externalUrl":null,"permalink":"/hugos/20240823-1/","section":"Hugo博客相关","summary":"\u003cp\u003e添加giscus，用于博客交流。\u003c/p\u003e","title":"hugo博客-blowfish主题添加giscus作为评论系统","type":"blog"},{"content":"本文解决了k8s健康检查时提示unhealthy的问题。\n1.kubectl get cs组件状态异常 # 报错信息提示10251端口拒绝连接 Get \u0026#34;http://127.0.0.1:10251/healthz\u0026#34;: dial tcp 127.0.0.1:10251: connect: connection refused 2. 查看端口状态 # 服务确实未启动 netstat -lnpt |grep 1025 3. 修改kube-scheduler.yaml,注释port=0 # 查看scheduler配置文件是否禁用非安全端口。文件路径在/etc/kubernetes/manifests\ncd /etc/kubernetes/manifests vim kube-scheduler.yaml 4. 再次检查端口及服务 # 一切正常 netstat -lnpt |grep 1025 kubectl get cs 5.其它情况 # 因为本次仅遇到了scheduler的unhealthy的问题，所以仅修改了一个文件，根据经验之谈，如果contoller也是unhealthy的情况\n5.1 contoller也是unhealthy解决方案 # 其它步骤同上，文件需要修改，注释port=0\n/etc/kubernetes/manifests/ 5.2 重启服务 # 本文操作时并未重启服务，修改文件即可，如修改文件不生效，可手动重启服务\nsystemctl restart kubelet.service ","date":"2024-08-11","externalUrl":null,"permalink":"/k8s-solve/20240811-1/","section":"k8s问题解决与记录","summary":"\u003cp\u003e本文解决了k8s健康检查时提示unhealthy的问题。\u003c/p\u003e","title":"k8s（kubectl get cs）健康检查报错","type":"blog"},{"content":"","date":"2024-08-11","externalUrl":null,"permalink":"/tags/unhealthy/","section":"Tags","summary":"","title":"Unhealthy","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/https/","section":"Tags","summary":"","title":"Https","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/os/","section":"Tags","summary":"","title":"Os","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/tools/","section":"Tags","summary":"","title":"Tools","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/wifi/","section":"Tags","summary":"","title":"Wifi","type":"tags"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"windows笔记本wifi连接正常上不了网。\n1. 现象 # 笔记本电脑上一次关机前可正常连接wifi上网 关机后，下一次再开机发现连接wifi正常，但是通过浏览器无法打开网页了 2. 原因 # 某些操作或者代理软件会自动设置局域网代理导致网络不通 3. 解决 # 右键桌面右下角的wifi标志，选择网络和Internet选项 选择最下面的Internet选项 选择第五项连接里面的局域网设置，将代理服务器下面所有的勾选取消 ","date":"2024-07-29","externalUrl":null,"permalink":"/windows/20240729-1/","section":"windows问题解决","summary":"\u003cp\u003ewindows笔记本wifi连接正常上不了网。\u003c/p\u003e","title":"windows笔记本wifi连接正常上不了网","type":"blog"},{"content":"","date":"2024-07-29","externalUrl":null,"permalink":"/windows/","section":"windows问题解决","summary":"","title":"windows问题解决","type":"windows"},{"content":"各类工具网址记录。\n1. 工具类网址 # 1.1 pdf加锁文件解锁网址 # 1.1.1 现象 # 一些pdf文件加锁后忘记密码从而无法编辑 1.1.2 解决 # 通过在线网站进行解锁 https://smallpdf.com/cn/unlock-pdf 1.2 矢量图标下载 # 阿里免费矢量图标下载 https://www.iconfont.cn/ 1.3 在线音乐聚合搜索 # 聚合音乐搜索 https://mp3.ltyuanfang.cn/ 1.4 图片裁剪圆形网址 # https://bigimage.11zon.com/zh-cn/crop-circle-image/ https://crop.imageonline.co/cn/ 1.5 图片压缩 # 在线压缩：\nhttp://v.yalijuda.com:32723/%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9-%e5%89%af%e6%9c%ac-2/ https://www.youcompress.com/zh-cn/ 压缩软件：\n1.5.1 Imagine # Imagine 7 是一款用于压缩 PNG 和 JPEG 的桌面应用程序，用户界面现代而友好。\n特点： 多种格式（JPEG、PNG、WebP） 格式转换 跨平台 GUI 图形用户界面 批量优化 (English, 简体中文, Nederlands, Español, Français, Italiano, Deutsch) https://github.com/meowtec/Imagine 1.6 windows文件夹防丢小助手（DirTag） # 运行DirTag后，当你打开某文件夹（目标是更深处的文件夹），如果存在深处子文件夹已处于打开状态，那么会跳出菜单，单击菜单项即可转到。\n原文地址：小众论坛 http://dogbean.ysepan.com/ 2. 学习类网址 # ","date":"2024-07-29","externalUrl":null,"permalink":"/tools/20240729-1/","section":"工具合集","summary":"\u003cp\u003e各类工具网址记录。\u003c/p\u003e","title":"各类工具网址记录","type":"blog"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/centos7/","section":"Tags","summary":"","title":"Centos7","type":"tags"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/gitlab-ce/","section":"Tags","summary":"","title":"Gitlab-Ce","type":"tags"},{"content":" 1. 启动中文版gitlab-ce容器 # 1.1 自动启动模式 # docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh:11.1 1.2 手动启动调试模式 # docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh:11.1 /bin/bash -c \u0026#34;while true;do sleep 100; done\u0026#34; 调试完成后，启动命令\n/assets/wrapper 执行启动命令有可能会遇到配置不一致问题，需重新加载配置\ngitlab-ctl reconfigure 2. gitlab-ce异常断电调试 # 2.1 GitLab external URL must include a schema and FQDN, e.g. http://gitlab.example.com/ # 解决办法：\nvim /etc/gitlab/gitlab.rb 将\nexternal_url \u0026#39;YYY\u0026#39; 改成\nexternal_url= \u0026#39;http：//本机IP\u0026#39; 2.2 Failed asserting that mode permissions on \u0026ldquo;/var/opt/gitlab/git-data/repositories\u0026rdquo; is 2770 # 解决办法\nchmod 2770 /var/opt/gitlab/git-data/repositories ","date":"2024-03-29","externalUrl":null,"permalink":"/linux/20240329-2/","section":"Linux问题解决","summary":"\u003ch1 class=\"relative group\"\u003e1. 启动中文版gitlab-ce容器 \n    \u003cdiv id=\"1-%E5%90%AF%E5%8A%A8%E4%B8%AD%E6%96%87%E7%89%88gitlab-ce%E5%AE%B9%E5%99%A8\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%90%AF%E5%8A%A8%E4%B8%AD%E6%96%87%E7%89%88gitlab-ce%E5%AE%B9%E5%99%A8\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\n\n\u003ch2 class=\"relative group\"\u003e1.1 自动启动模式 \n    \u003cdiv id=\"11-%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e twang2218/gitlab-ce-zh:11.1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch2 class=\"relative group\"\u003e1.2 手动启动调试模式 \n    \u003cdiv id=\"12-%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#12-%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab11 -v /usr/local/gitlab11/etc:/etc/gitlab -v /usr/local/gitlab11/log:/var/log/gitlab -v /usr/local/gitlab11/data:/var/opt/gitlab --privileged\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e twang2218/gitlab-ce-zh:11.1 /bin/bash -c \u003cspan class=\"s2\"\u003e\u0026#34;while true;do sleep 100; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e调试完成后，启动命令\u003c/p\u003e","title":"Gitlab-ce中文版安装及维护","type":"blog"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/tags/kernel/","section":"Tags","summary":"","title":"Kernel","type":"tags"},{"content":"","date":"2024-03-29","externalUrl":null,"permalink":"/linux/","section":"Linux问题解决","summary":"","title":"Linux问题解决","type":"linux"},{"content":" 1. 参考网站 # centos7 离线升级/在线升级操作系统内核_centos7 red hat enterprise-CSDN博客\n2. 内核下载网站 # http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/\n3. 配置rpm仓库及下载内核rpm包 # 内核包下载好，kernel-ml代表主线版本，总是保持主线最新的内核，kernel-lt代表长期支持版本，支持周期更长，如果你要追求最新的版本，直接选择带ml的rpm包即可，如果你要追求稳定且更长的支持周期，直接选择lt版本即可。 rpm -Uvh http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/elrepo-release-7.0-8.el7.elrepo.noarch.rpm # 6.9.7版本：http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-6.9.7-1.el7.elrepo.x86_64.rpm wget http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm 4. 安装(Centos7系统) # rpm -ivh kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm 4.1 修改内核启动顺序 # 修改文件：/etc/default/grub 使 GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=\u0026#34;$(sed \u0026#39;s, release .*$,,g\u0026#39; /etc/system-release)\u0026#34; # 改GRUB_DEFAULT=saved为0 GRUB_DEFAULT=0 GRUB_DISABLE_SUBMENU=true GRUB_TERMINAL_OUTPUT=\u0026#34;gfxterm\u0026#34; GRUB_CMDLINE_LINUX=\u0026#34;rhgb quiet nomodeset\u0026#34; GRUB_DISABLE_RECOVERY=\u0026#34;true\u0026#34; 设置默认启动内核，grub2-set-default 0和/etc/default/grub文件里的GRUB_DEFAULT=0意思一样 grub2-set-default 0 查看所有内核 awk -F\\\u0026#39; \u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39; /boot/grub2/grub.cfg 重新生成grub配置文件 grub2-mkconfig -o /boot/grub2/grub.cfg 重启并查看内核板板 reboot uname -r 4.2 多余内核删除 # 在 CentOS 7 中删除多余内核的步骤通常如下：\n在执行删除操作时务必小心，确保你不会误删当前正在使用的内核，否则可能导致系统无法正常启动。如果不确定哪些内核可以安全删除，建议仅删除明确标记为旧版本且确认未被当前系统使用的内核。 4.3 确认当前使用的内核版本 # 打开终端，输入以下命令来查看当前系统正在使用的内核版本： uname -r 4.4 查询已安装的所有内核版本 # 使用 rpm 命令列出所有与内核相关的包： rpm -qa | grep kernel 这将列出包括当前正在使用的内核在内的所有内核版本。 4.5 确定要删除的内核 # 确保不要删除当前正在使用的内核版本。通常，安全的做法是至少保留一个或两个旧内核作为备用。 删除多余的内核\n使用 yum 命令来删除不再需要的内核版本。例如，如果你要删除 kernel-3.10.0-1127.el7.x86_64 这个版本，可以运行： sudo yum remove kernel-ml-6.9.7-1.el7.elrepo.x86_64 对于每个不需要的内核重复此步骤。\n4.6 更新引导加载器配置 # 删除内核后，需要更新 GRUB 配置以反映这些更改： sudo grub2-mkconfig -o /boot/grub2/grub.cfg 4.7 重启系统 # -（可选）如果你确信没有删除正在使用的内核，并且所有操作都已完成，可以选择重启系统以应用更改\nreboot ","date":"2024-03-29","externalUrl":null,"permalink":"/linux/20240329-1/","section":"Linux问题解决","summary":"\u003ch1 class=\"relative group\"\u003e1. 参考网站 \n    \u003cdiv id=\"1-%E5%8F%82%E8%80%83%E7%BD%91%E7%AB%99\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%8F%82%E8%80%83%E7%BD%91%E7%AB%99\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/yaxuan88521/article/details/129946104?spm=1001.2101.3001.6650.2\u0026amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-129946104-blog-136274022.235%5Ev43%5Econtrol\u0026amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-129946104-blog-136274022.235%5Ev43%5Econtrol\u0026amp;utm_relevant_index=5\" target=\"_blank\"\u003ecentos7 离线升级/在线升级操作系统内核_centos7 red hat enterprise-CSDN博客\u003c/a\u003e\u003c/p\u003e","title":"Linux系统内核升级","type":"blog"},{"content":"OwnerReference和Finalizers.\n1.OwnerReference # 设置了OwnerReference以后，会在k8s资源间建立从属关系，当删除属主（即父资源）时，其从属资源（即子资源）也会跟着删除，这就是k8s中的级联删除\n1.1 OwnerReference中的属性 # ApiVersion：属主资源的api版本 Kind：属主资源的类型，例如deployment，pod等 Name：属主资源的名称 Uid：属主资源的唯一标识 Controller：当Controller属性为true时，表示资源对象是一个控制器（如Deployment、ReplicaSet等），它管理着其他资源对象（如Pod、Service等）的创建和生命周期。个人理解为：当一个资源有多个属主时，其中为true的属主会监视该资源的变化 BlockOwnerDeletion：根据它来判断从属资源的删除是否会阻塞属主资源的删除；当BlockOwnerDeletion为true，并且删除策略为前台删除（foreground）时，属主资源会等待从属资源删完后，才会删除，表现在go-client接口中即为要等待该属主资源及其所有从属资源完全删除后，才会返回该删除接口的结果；当BlockOwnerDeletion设置为false时，从属资源的删除不会阻塞属主资源的删除。 1.2 k8s中的删除策略 # foreground（前台删除）：先删除从属资源，再删除属主资源（一般与BlockOwnerDeletion=true结合使用） background（后台删除）：先删除属主资源，再在后台删除从属资源（默认策略） orphan（孤儿删除）：不考虑OwnerReference，只删除该资源，不级联删除 1.3 BlockOwnerDeletion与删除策略结合使用 # 从属资源的BlockOwnerDeletion为true，删除策略为前台删除：删除属主资源时，会等待从属资源被删除后，才会删除属主资源，然后返回删除结果；与go-client结合来看就是，等属主资源和其所有的从属资源都被删除后，删除接口才会返回结果 从属资源的BlockOwnerDeletion为false，删除策略为前台删除时：删除属主资源时，不会等待从属资源的删除，会直接返回删除结果；与go-client结合来看就是，删除接口会立即返回结果 删除策略为后台删除时，都会直接返回删除结果，后台删除不会等待从属资源的删除 2.Finalizers # Finalizers是metadata中的一个数组类型的标签，当k8s资源存在Finalizers标签，删除该资源时，会阻塞该资源的删除，直到Finalizers为空时，才会将该资源真正删除\n2.1 Finalizers的工作原理 # 当删除存在Finalizers标签的资源时，处理删除请求的api会为该资源的metadata标签中添加DeletionTimeStamp标签（该标签为下发删除请求的时间），并且会更改该资源的状态为Terminating状态，此时该资源并没有被完全删除，处于只可见状态；此时控制器会尽量满足该资源的Finalizers的要求，每达到一个要求，就会删去该Finalizers，直到所有的Finalizers全被删除时，该资源才会被真正删除\n","date":"2024-03-11","externalUrl":null,"permalink":"/kubernetes/20240311-4/","section":"Kubernetes","summary":"\u003cp\u003eOwnerReference和Finalizers.\u003c/p\u003e","title":"【Kubernetes知识】OwnerReference和Finalizers","type":"blog"},{"content":"","date":"2024-03-11","externalUrl":null,"permalink":"/tags/pod/","section":"Tags","summary":"","title":"Pod","type":"tags"},{"content":"","date":"2024-03-11","externalUrl":null,"permalink":"/tags/spec/","section":"Tags","summary":"","title":"Spec","type":"tags"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/tags/longhorn/","section":"Tags","summary":"","title":"Longhorn","type":"tags"},{"content":" 1. 前言 # Longhorn采用容器和微服务技术实现了分布式块存储。Longhorn为每个块设备卷创建一个专门的存储控制器，并且对多个节点上存储副本中的卷进行实时复制。\nLonghorn的卷可以作为Kubernetes集群中分布式有状态应用的存储。 可以将块存储划分为Longhorn卷，以便在有或没有云提供商的情况下使用Kubernetes卷。 可以跨节点和数据中心复制块存储，从而提高可用性。 可以在外部存储上存储备份数据，例如：NFS或AWS S3。 可以创建跨群集灾难恢复卷，以便从备用的Kubernetes集群的备份中快速恢复来自主Kubernetes群集的数据。 可以为卷设置计划，对卷定期生成快照，并把快照备份到NFS或者兼容S3的备用存储中。 支持从备份中恢复卷。 支持不中断卷服务的情况下进行升级。 1.1 前提 # 一个正常运行的Kubernetes集群 集群每个节点已经安装下列软件包，并正常启动 open-iscsi（iscsid服务） 安装： yum install iscsi-initiator-utils 2. 安装 # 采用helm安装\n2.1 添加helm源 # helm repo add longhorn https://charts.longhorn.io 2,2 更新helm源 # helm repo update 2.3下载helm包并修改配置 # 下载并解压 # 下载包 helm fetch longhorn/longhorn # 解压包 tar xf longhorn-1.6.2.tgz 修改配置文件 values.yaml # Default values for longhorn. # This is a YAML-formatted file. # Declare variables to be passed into your templates. global: cattle: # -- Default system registry. systemDefaultRegistry: \u0026#34;\u0026#34; windowsCluster: # -- Setting that allows Longhorn to run on a Rancher Windows cluster. enabled: false # -- Toleration for Linux nodes that can run user-deployed Longhorn components. tolerations: - key: \u0026#34;cattle.io/os\u0026#34; value: \u0026#34;linux\u0026#34; effect: \u0026#34;NoSchedule\u0026#34; operator: \u0026#34;Equal\u0026#34; # -- Node selector for Linux nodes that can run user-deployed Longhorn components. nodeSelector: kubernetes.io/os: \u0026#34;linux\u0026#34; defaultSetting: # -- Toleration for system-managed Longhorn components. taintToleration: cattle.io/os=linux:NoSchedule # -- Node selector for system-managed Longhorn components. systemManagedComponentsNodeSelector: kubernetes.io/os:linux networkPolicies: # -- Setting that allows you to enable network policies that control access to Longhorn pods. enabled: false # -- Distribution that determines the policy for allowing access for an ingress. (Options: \u0026#34;k3s\u0026#34;, \u0026#34;rke2\u0026#34;, \u0026#34;rke1\u0026#34;) type: \u0026#34;k3s\u0026#34; image: longhorn: engine: # -- Repository for the Longhorn Engine image. repository: longhornio/longhorn-engine # -- Specify Longhorn engine image tag tag: v1.6.2 manager: # -- Repository for the Longhorn Manager image. repository: longhornio/longhorn-manager # -- Specify Longhorn manager image tag tag: v1.6.2 ui: # -- Repository for the Longhorn UI image. repository: longhornio/longhorn-ui # -- Specify Longhorn ui image tag tag: v1.6.2 instanceManager: # -- Repository for the Longhorn Instance Manager image. repository: longhornio/longhorn-instance-manager # -- Specify Longhorn instance manager image tag tag: v1.6.2 shareManager: # -- Repository for the Longhorn Share Manager image. repository: longhornio/longhorn-share-manager # -- Specify Longhorn share manager image tag tag: v1.6.2 backingImageManager: # -- Repository for the Backing Image Manager image. When unspecified, Longhorn uses the default value. repository: longhornio/backing-image-manager # -- Specify Longhorn backing image manager image tag tag: v1.6.2 supportBundleKit: # -- Repository for the Longhorn Support Bundle Manager image. repository: longhornio/support-bundle-kit # -- Tag for the Longhorn Support Bundle Manager image. tag: v0.0.37 csi: attacher: # -- Repository for the CSI attacher image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-attacher # -- Tag for the CSI attacher image. When unspecified, Longhorn uses the default value. tag: v4.5.1 provisioner: # -- Repository for the CSI Provisioner image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-provisioner # -- Tag for the CSI Provisioner image. When unspecified, Longhorn uses the default value. tag: v3.6.4 nodeDriverRegistrar: # -- Repository for the CSI Node Driver Registrar image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-node-driver-registrar # -- Tag for the CSI Node Driver Registrar image. When unspecified, Longhorn uses the default value. tag: v2.9.2 resizer: # -- Repository for the CSI Resizer image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-resizer # -- Tag for the CSI Resizer image. When unspecified, Longhorn uses the default value. tag: v1.10.1 snapshotter: # -- Repository for the CSI Snapshotter image. When unspecified, Longhorn uses the default value. repository: longhornio/csi-snapshotter # -- Tag for the CSI Snapshotter image. When unspecified, Longhorn uses the default value. tag: v6.3.4 livenessProbe: # -- Repository for the CSI liveness probe image. When unspecified, Longhorn uses the default value. repository: longhornio/livenessprobe # -- Tag for the CSI liveness probe image. When unspecified, Longhorn uses the default value. tag: v2.12.0 openshift: oauthProxy: # -- Repository for the OAuth Proxy image. This setting applies only to OpenShift users. repository: longhornio/openshift-origin-oauth-proxy # -- Tag for the OAuth Proxy image. This setting applies only to OpenShift users. Specify OCP/OKD version 4.1 or later. The latest stable version is 4.14. tag: 4.14 # -- Image pull policy that applies to all user-deployed Longhorn components, such as Longhorn Manager, Longhorn driver, and Longhorn UI. pullPolicy: IfNotPresent # 修改ui界面的service类型为NodePort service: ui: # -- Service type for Longhorn UI. (Options: \u0026#34;ClusterIP\u0026#34;, \u0026#34;NodePort\u0026#34;, \u0026#34;LoadBalancer\u0026#34;, \u0026#34;Rancher-Proxy\u0026#34;) type: NodePort # -- NodePort port number for Longhorn UI. When unspecified, Longhorn selects a free port between 30000 and 32767. nodePort: null manager: # -- Service type for Longhorn Manager. type: ClusterIP # -- NodePort port number for Longhorn Manager. When unspecified, Longhorn selects a free port between 30000 and 32767. nodePort: \u0026#34;\u0026#34; # 看需求设置是否为默认storageclass（defaultClass），修改pvc策略为Retain persistence: # -- Setting that allows you to specify the default Longhorn StorageClass. defaultClass: true # -- Filesystem type of the default Longhorn StorageClass. defaultFsType: ext4 # -- mkfs parameters of the default Longhorn StorageClass. defaultMkfsParams: \u0026#34;\u0026#34; # -- Replica count of the default Longhorn StorageClass. defaultClassReplicaCount: 1 # -- Data locality of the default Longhorn StorageClass. (Options: \u0026#34;disabled\u0026#34;, \u0026#34;best-effort\u0026#34;) defaultDataLocality: disabled # -- Reclaim policy that provides instructions for handling of a volume after its claim is released. (Options: \u0026#34;Retain\u0026#34;, \u0026#34;Delete\u0026#34;) reclaimPolicy: Retain # -- Setting that allows you to enable live migration of a Longhorn volume from one node to another. migratable: false # -- Set NFS mount options for Longhorn StorageClass for RWX volumes nfsOptions: \u0026#34;\u0026#34; recurringJobSelector: # -- Setting that allows you to enable the recurring job selector for a Longhorn StorageClass. enable: false # -- Recurring job selector for a Longhorn StorageClass. Ensure that quotes are used correctly when specifying job parameters. (Example: `[{\u0026#34;name\u0026#34;:\u0026#34;backup\u0026#34;, \u0026#34;isGroup\u0026#34;:true}]`) jobList: [] backingImage: # -- Setting that allows you to use a backing image in a Longhorn StorageClass. enable: false # -- Backing image to be used for creating and restoring volumes in a Longhorn StorageClass. When no backing images are available, specify the data source type and parameters that Longhorn can use to create a backing image. name: ~ # -- Data source type of a backing image used in a Longhorn StorageClass. # If the backing image exists in the cluster, Longhorn uses this setting to verify the image. # If the backing image does not exist, Longhorn creates one using the specified data source type. dataSourceType: ~ # -- Data source parameters of a backing image used in a Longhorn StorageClass. # You can specify a JSON string of a map. (Example: `\u0026#39;{\\\u0026#34;url\\\u0026#34;:\\\u0026#34;https://backing-image-example.s3-region.amazonaws.com/test-backing-image\\\u0026#34;}\u0026#39;`) dataSourceParameters: ~ # -- Expected SHA-512 checksum of a backing image used in a Longhorn StorageClass. expectedChecksum: ~ defaultNodeSelector: # -- Setting that allows you to enable the node selector for the default Longhorn StorageClass. enable: false # -- Node selector for the default Longhorn StorageClass. Longhorn uses only nodes with the specified tags for storing volume data. (Examples: \u0026#34;storage,fast\u0026#34;) selector: \u0026#34;\u0026#34; # -- Setting that allows you to enable automatic snapshot removal during filesystem trim for a Longhorn StorageClass. (Options: \u0026#34;ignored\u0026#34;, \u0026#34;enabled\u0026#34;, \u0026#34;disabled\u0026#34;) removeSnapshotsDuringFilesystemTrim: ignored preUpgradeChecker: # -- Setting that allows Longhorn to perform pre-upgrade checks. Disable this setting when installing Longhorn using Argo CD or other GitOps solutions. jobEnabled: true # -- Setting that allows Longhorn to perform upgrade version checks after starting the Longhorn Manager DaemonSet Pods. Disabling this setting also disables `preUpgradeChecker.jobEnabled`. Longhorn recommends keeping this setting enabled. upgradeVersionCheck: true csi: # -- kubelet root directory. When unspecified, Longhorn uses the default value. kubeletRootDir: ~ # -- Replica count of the CSI Attacher. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). attacherReplicaCount: ~ # -- Replica count of the CSI Provisioner. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). provisionerReplicaCount: ~ # -- Replica count of the CSI Resizer. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). resizerReplicaCount: ~ # -- Replica count of the CSI Snapshotter. When unspecified, Longhorn uses the default value (\u0026#34;3\u0026#34;). snapshotterReplicaCount: ~ defaultSettings: # -- Endpoint used to access the backupstore. (Options: \u0026#34;NFS\u0026#34;, \u0026#34;CIFS\u0026#34;, \u0026#34;AWS\u0026#34;, \u0026#34;GCP\u0026#34;, \u0026#34;AZURE\u0026#34;) backupTarget: ~ # -- Name of the Kubernetes secret associated with the backup target. backupTargetCredentialSecret: ~ # -- Setting that allows Longhorn to automatically attach a volume and create snapshots or backups when recurring jobs are run. allowRecurringJobWhileVolumeDetached: ~ # -- Setting that allows Longhorn to automatically create a default disk only on nodes with the label \u0026#34;node.longhorn.io/create-default-disk=true\u0026#34; (if no other disks exist). When this setting is disabled, Longhorn creates a default disk on each node that is added to the cluster. createDefaultDiskLabeledNodes: true # -- Default path for storing data on a host. The default value is \u0026#34;/var/lib/longhorn/\u0026#34;. # 设置longhorn挂载的本地存储路径，/data/longhorn defaultDataPath: /data1/longhorn # -- Default data locality. A Longhorn volume has data locality if a local replica of the volume exists on the same node as the pod that is using the volume. defaultDataLocality: ~ # -- Setting that allows scheduling on nodes with healthy replicas of the same volume. This setting is disabled by default. replicaSoftAntiAffinity: ~ # -- Setting that automatically rebalances replicas when an available node is discovered. replicaAutoBalance: ~ # -- Percentage of storage that can be allocated relative to hard drive capacity. The default value is \u0026#34;100\u0026#34;. storageOverProvisioningPercentage: ~ # -- Percentage of minimum available disk capacity. When the minimum available capacity exceeds the total available capacity, the disk becomes unschedulable until more space is made available for use. The default value is \u0026#34;25\u0026#34;. storageMinimalAvailablePercentage: ~ # -- Percentage of disk space that is not allocated to the default disk on each new Longhorn node. storageReservedPercentageForDefaultDisk: ~ # -- Upgrade Checker that periodically checks for new Longhorn versions. When a new version is available, a notification appears on the Longhorn UI. This setting is enabled by default upgradeChecker: ~ # -- Default number of replicas for volumes created using the Longhorn UI. For Kubernetes configuration, modify the `numberOfReplicas` field in the StorageClass. The default value is \u0026#34;3\u0026#34;. defaultReplicaCount: ~ # -- Default Longhorn StorageClass. \u0026#34;storageClassName\u0026#34; is assigned to PVs and PVCs that are created for an existing Longhorn volume. \u0026#34;storageClassName\u0026#34; can also be used as a label, so it is possible to use a Longhorn StorageClass to bind a workload to an existing PV without creating a Kubernetes StorageClass object. The default value is \u0026#34;longhorn-static\u0026#34;. defaultLonghornStaticStorageClass: ~ # -- Number of seconds that Longhorn waits before checking the backupstore for new backups. The default value is \u0026#34;300\u0026#34;. When the value is \u0026#34;0\u0026#34;, polling is disabled. backupstorePollInterval: ~ # -- Number of minutes that Longhorn keeps a failed backup resource. When the value is \u0026#34;0\u0026#34;, automatic deletion is disabled. failedBackupTTL: ~ # -- Setting that restores recurring jobs from a backup volume on a backup target and creates recurring jobs if none exist during backup restoration. restoreVolumeRecurringJobs: ~ # -- Maximum number of successful recurring backup and snapshot jobs to be retained. When the value is \u0026#34;0\u0026#34;, a history of successful recurring jobs is not retained. recurringSuccessfulJobsHistoryLimit: ~ # -- Maximum number of failed recurring backup and snapshot jobs to be retained. When the value is \u0026#34;0\u0026#34;, a history of failed recurring jobs is not retained. recurringFailedJobsHistoryLimit: ~ # -- Maximum number of snapshots or backups to be retained. recurringJobMaxRetention: ~ # -- Maximum number of failed support bundles that can exist in the cluster. When the value is \u0026#34;0\u0026#34;, Longhorn automatically purges all failed support bundles. supportBundleFailedHistoryLimit: ~ # -- Taint or toleration for system-managed Longhorn components. # Specify values using a semicolon-separated list in `kubectl taint` syntax (Example: key1=value1:effect; key2=value2:effect). taintToleration: ~ # -- Node selector for system-managed Longhorn components. systemManagedComponentsNodeSelector: ~ # -- PriorityClass for system-managed Longhorn components. # This setting can help prevent Longhorn components from being evicted under Node Pressure. # Notice that this will be applied to Longhorn user-deployed components by default if there are no priority class values set yet, such as `longhornManager.priorityClass`. priorityClass: \u0026amp;defaultPriorityClassNameRef \u0026#34;longhorn-critical\u0026#34; # -- Setting that allows Longhorn to automatically salvage volumes when all replicas become faulty (for example, when the network connection is interrupted). Longhorn determines which replicas are usable and then uses these replicas for the volume. This setting is enabled by default. autoSalvage: ~ # -- Setting that allows Longhorn to automatically delete a workload pod that is managed by a controller (for example, daemonset) whenever a Longhorn volume is detached unexpectedly (for example, during Kubernetes upgrades). After deletion, the controller restarts the pod and then Kubernetes handles volume reattachment and remounting. autoDeletePodWhenVolumeDetachedUnexpectedly: ~ # -- Setting that prevents Longhorn Manager from scheduling replicas on a cordoned Kubernetes node. This setting is enabled by default. disableSchedulingOnCordonedNode: ~ # -- Setting that allows Longhorn to schedule new replicas of a volume to nodes in the same zone as existing healthy replicas. Nodes that do not belong to any zone are treated as existing in the zone that contains healthy replicas. When identifying zones, Longhorn relies on the label \u0026#34;topology.kubernetes.io/zone=\u0026lt;Zone name of the node\u0026gt;\u0026#34; in the Kubernetes node object. replicaZoneSoftAntiAffinity: ~ # -- Setting that allows scheduling on disks with existing healthy replicas of the same volume. This setting is enabled by default. replicaDiskSoftAntiAffinity: ~ # -- Policy that defines the action Longhorn takes when a volume is stuck with a StatefulSet or Deployment pod on a node that failed. nodeDownPodDeletionPolicy: ~ # -- Policy that defines the action Longhorn takes when a node with the last healthy replica of a volume is drained. nodeDrainPolicy: ~ # -- Setting that allows automatic detaching of manually-attached volumes when a node is cordoned. detachManuallyAttachedVolumesWhenCordoned: ~ # -- Number of seconds that Longhorn waits before reusing existing data on a failed replica instead of creating a new replica of a degraded volume. replicaReplenishmentWaitInterval: ~ # -- Maximum number of replicas that can be concurrently rebuilt on each node. concurrentReplicaRebuildPerNodeLimit: ~ # -- Maximum number of volumes that can be concurrently restored on each node using a backup. When the value is \u0026#34;0\u0026#34;, restoration of volumes using a backup is disabled. concurrentVolumeBackupRestorePerNodeLimit: ~ # -- Setting that disables the revision counter and thereby prevents Longhorn from tracking all write operations to a volume. When salvaging a volume, Longhorn uses properties of the \u0026#34;volume-head-xxx.img\u0026#34; file (the last file size and the last time the file was modified) to select the replica to be used for volume recovery. This setting applies only to volumes created using the Longhorn UI. disableRevisionCounter: ~ # -- Image pull policy for system-managed pods, such as Instance Manager, engine images, and CSI Driver. Changes to the image pull policy are applied only after the system-managed pods restart. systemManagedPodsImagePullPolicy: ~ # -- Setting that allows you to create and attach a volume without having all replicas scheduled at the time of creation. allowVolumeCreationWithDegradedAvailability: ~ # -- Setting that allows Longhorn to automatically clean up the system-generated snapshot after replica rebuilding is completed. autoCleanupSystemGeneratedSnapshot: ~ # -- Setting that allows Longhorn to automatically clean up the snapshot generated by a recurring backup job. autoCleanupRecurringJobBackupSnapshot: ~ # -- Maximum number of engines that are allowed to concurrently upgrade on each node after Longhorn Manager is upgraded. When the value is \u0026#34;0\u0026#34;, Longhorn does not automatically upgrade volume engines to the new default engine image version. concurrentAutomaticEngineUpgradePerNodeLimit: ~ # -- Number of minutes that Longhorn waits before cleaning up the backing image file when no replicas in the disk are using it. backingImageCleanupWaitInterval: ~ # -- Number of seconds that Longhorn waits before downloading a backing image file again when the status of all image disk files changes to \u0026#34;failed\u0026#34; or \u0026#34;unknown\u0026#34;. backingImageRecoveryWaitInterval: ~ # -- Percentage of the total allocatable CPU resources on each node to be reserved for each instance manager pod when the V1 Data Engine is enabled. The default value is \u0026#34;12\u0026#34;. guaranteedInstanceManagerCPU: ~ # -- Setting that notifies Longhorn that the cluster is using the Kubernetes Cluster Autoscaler. kubernetesClusterAutoscalerEnabled: ~ # -- Setting that allows Longhorn to automatically delete an orphaned resource and the corresponding data (for example, stale replicas). Orphaned resources on failed or unknown nodes are not automatically cleaned up. orphanAutoDeletion: ~ # -- Storage network for in-cluster traffic. When unspecified, Longhorn uses the Kubernetes cluster network. storageNetwork: ~ # -- Flag that prevents accidental uninstallation of Longhorn. deletingConfirmationFlag: ~ # -- Timeout between the Longhorn Engine and replicas. Specify a value between \u0026#34;8\u0026#34; and \u0026#34;30\u0026#34; seconds. The default value is \u0026#34;8\u0026#34;. engineReplicaTimeout: ~ # -- Setting that allows you to enable and disable snapshot hashing and data integrity checks. snapshotDataIntegrity: ~ # -- Setting that allows disabling of snapshot hashing after snapshot creation to minimize impact on system performance. snapshotDataIntegrityImmediateCheckAfterSnapshotCreation: ~ # -- Setting that defines when Longhorn checks the integrity of data in snapshot disk files. You must use the Unix cron expression format. snapshotDataIntegrityCronjob: ~ # -- Setting that allows Longhorn to automatically mark the latest snapshot and its parent files as removed during a filesystem trim. Longhorn does not remove snapshots containing multiple child files. removeSnapshotsDuringFilesystemTrim: ~ # -- Setting that allows fast rebuilding of replicas using the checksum of snapshot disk files. Before enabling this setting, you must set the snapshot-data-integrity value to \u0026#34;enable\u0026#34; or \u0026#34;fast-check\u0026#34;. fastReplicaRebuildEnabled: ~ # -- Number of seconds that an HTTP client waits for a response from a File Sync server before considering the connection to have failed. replicaFileSyncHttpClientTimeout: ~ # -- Log levels that indicate the type and severity of logs in Longhorn Manager. The default value is \u0026#34;Info\u0026#34;. (Options: \u0026#34;Panic\u0026#34;, \u0026#34;Fatal\u0026#34;, \u0026#34;Error\u0026#34;, \u0026#34;Warn\u0026#34;, \u0026#34;Info\u0026#34;, \u0026#34;Debug\u0026#34;, \u0026#34;Trace\u0026#34;) logLevel: ~ # -- Setting that allows you to specify a backup compression method. backupCompressionMethod: ~ # -- Maximum number of worker threads that can concurrently run for each backup. backupConcurrentLimit: ~ # -- Maximum number of worker threads that can concurrently run for each restore operation. restoreConcurrentLimit: ~ # -- Setting that allows you to enable the V1 Data Engine. v1DataEngine: ~ # -- Setting that allows you to enable the V2 Data Engine, which is based on the Storage Performance Development Kit (SPDK). The V2 Data Engine is a preview feature and should not be used in production environments. v2DataEngine: ~ # -- Setting that allows you to configure maximum huge page size (in MiB) for the V2 Data Engine. v2DataEngineHugepageLimit: ~ # -- Setting that allows rebuilding of offline replicas for volumes using the V2 Data Engine. offlineReplicaRebuilding: ~ # -- Number of millicpus on each node to be reserved for each Instance Manager pod when the V2 Data Engine is enabled. The default value is \u0026#34;1250\u0026#34;. v2DataEngineGuaranteedInstanceManagerCPU: ~ # -- Setting that allows scheduling of empty node selector volumes to any node. allowEmptyNodeSelectorVolume: ~ # -- Setting that allows scheduling of empty disk selector volumes to any disk. allowEmptyDiskSelectorVolume: ~ # -- Setting that allows Longhorn to periodically collect anonymous usage data for product improvement purposes. Longhorn sends collected data to the [Upgrade Responder](https://github.com/longhorn/upgrade-responder) server, which is the data source of the Longhorn Public Metrics Dashboard (https://metrics.longhorn.io). The Upgrade Responder server does not store data that can be used to identify clients, including IP addresses. allowCollectingLonghornUsageMetrics: ~ # -- Setting that temporarily prevents all attempts to purge volume snapshots. disableSnapshotPurge: ~ # -- Maximum snapshot count for a volume. The value should be between 2 to 250 snapshotMaxCount: ~ privateRegistry: # -- Setting that allows you to create a private registry secret. createSecret: ~ # -- URL of a private registry. When unspecified, Longhorn uses the default system registry. registryUrl: ~ # -- User account used for authenticating with a private registry. registryUser: ~ # -- Password for authenticating with a private registry. registryPasswd: ~ # -- Kubernetes secret that allows you to pull images from a private registry. This setting applies only when creation of private registry secrets is enabled. You must include the private registry name in the secret name. registrySecret: ~ longhornManager: log: # -- Format of Longhorn Manager logs. (Options: \u0026#34;plain\u0026#34;, \u0026#34;json\u0026#34;) format: plain # -- PriorityClass for Longhorn Manager. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn Manager on nodes allowed to run Longhorn Manager. tolerations: [] ## If you want to set tolerations for Longhorn Manager DaemonSet, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn Manager. Specify the nodes allowed to run Longhorn Manager. nodeSelector: {} ## If you want to set node selector for Longhorn Manager DaemonSet, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; # -- Annotation for the Longhorn Manager service. serviceAnnotations: {} ## If you want to set annotations for the Longhorn Manager service, delete the `{}` in the line above ## and uncomment this example block # annotation-key1: \u0026#34;annotation-value1\u0026#34; # annotation-key2: \u0026#34;annotation-value2\u0026#34; longhornDriver: # -- PriorityClass for Longhorn Driver. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn Driver on nodes allowed to run Longhorn components. tolerations: [] ## If you want to set tolerations for Longhorn Driver Deployer Deployment, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn Driver. Specify the nodes allowed to run Longhorn Driver. nodeSelector: {} ## If you want to set node selector for Longhorn Driver Deployer Deployment, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; longhornUI: # -- Replica count for Longhorn UI. replicas: 1 # -- PriorityClass for Longhorn UI. priorityClass: *defaultPriorityClassNameRef # -- Toleration for Longhorn UI on nodes allowed to run Longhorn components. tolerations: [] ## If you want to set tolerations for Longhorn UI Deployment, delete the `[]` in the line above ## and uncomment this example block # - key: \u0026#34;key\u0026#34; # operator: \u0026#34;Equal\u0026#34; # value: \u0026#34;value\u0026#34; # effect: \u0026#34;NoSchedule\u0026#34; # -- Node selector for Longhorn UI. Specify the nodes allowed to run Longhorn UI. nodeSelector: {} ## If you want to set node selector for Longhorn UI Deployment, delete the `{}` in the line above ## and uncomment this example block # label-key1: \u0026#34;label-value1\u0026#34; # label-key2: \u0026#34;label-value2\u0026#34; ingress: # -- Setting that allows Longhorn to generate ingress records for the Longhorn UI service. enabled: false # -- IngressClass resource that contains ingress configuration, including the name of the Ingress controller. # ingressClassName can replace the kubernetes.io/ingress.class annotation used in earlier Kubernetes releases. ingressClassName: ~ # -- Hostname of the Layer 7 load balancer. host: sslip.io # -- Setting that allows you to enable TLS on ingress records. tls: false # -- Setting that allows you to enable secure connections to the Longhorn UI service via port 443. secureBackends: false # -- TLS secret that contains the private key and certificate to be used for TLS. This setting applies only when TLS is enabled on ingress records. tlsSecret: longhorn.local-tls # -- Default ingress path. You can access the Longhorn UI by following the full ingress path {{host}}+{{path}}. path: / ## If you\u0026#39;re using kube-lego, you will want to add: ## kubernetes.io/tls-acme: true ## ## For a full list of possible ingress annotations, please see ## ref: https://github.com/kubernetes/ingress-nginx/blob/master/docs/annotations.md ## ## If tls is set to true, annotation ingress.kubernetes.io/secure-backends: \u0026#34;true\u0026#34; will automatically be set # -- Ingress annotations in the form of key-value pairs. annotations: # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: true # -- Secret that contains a TLS private key and certificate. Use secrets if you want to use your own certificates to secure ingresses. secrets: ## If you\u0026#39;re providing your own certificates, please use this to add the certificates as secrets ## key and certificate should start with -----BEGIN CERTIFICATE----- or ## -----BEGIN RSA PRIVATE KEY----- ## ## name should line up with a tlsSecret set further up ## If you\u0026#39;re using kube-lego, this is unneeded, as it will create the secret for you if it is not set ## ## It is also possible to create and manage the certificates outside of this helm chart ## Please see README.md for more information # - name: longhorn.local-tls # key: # certificate: # -- Setting that allows you to enable pod security policies (PSPs) that allow privileged Longhorn pods to start. This setting applies only to clusters running Kubernetes 1.25 and earlier, and with the built-in Pod Security admission controller enabled. enablePSP: false # -- Specify override namespace, specifically this is useful for using longhorn as sub-chart and its release namespace is not the `longhorn-system`. namespaceOverride: \u0026#34;\u0026#34; # -- Annotation for the Longhorn Manager DaemonSet pods. This setting is optional. annotations: {} serviceAccount: # -- Annotations to add to the service account annotations: {} metrics: serviceMonitor: # -- Setting that allows the creation of a Prometheus ServiceMonitor resource for Longhorn Manager components. enabled: false ## openshift settings openshift: # -- Setting that allows Longhorn to integrate with OpenShift. enabled: false ui: # -- Route for connections between Longhorn and the OpenShift web console. route: \u0026#34;longhorn-ui\u0026#34; # -- Port for accessing the OpenShift web console. port: 443 # -- Port for proxy that provides access to the OpenShift web console. proxy: 8443 # -- Setting that allows Longhorn to generate code coverage profiles. enableGoCoverDir: false 2.4 部署 # 2.4.1 longhorn安装准备工作 # 各存储节点创建目录及挂载 # 将存储盘挂载到/data1所在目录，并创建longhorn目录 mkdir /home/data1/longhorn 存储节点使用命令打标签： kubectl label nodes node75 node77 node78 node.longhorn.io/create-default-disk=true 安装longhorn所需系统依赖 yum install -y nfs-utils yum --setopt=tsflags=noscripts install iscsi-initiator-utils echo \u0026#34;InitiatorName=$(/sbin/iscsi-iname)\u0026#34; \u0026gt; /etc/iscsi/initiatorname.iscsi systemctl enable iscsid systemctl start iscsid wget https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 -O /usr/local/bin/jq chmod +x /usr/local/bin/jq longhorn环境检查脚本 检查环境是否准备好了longhorn所需依赖 #!/bin/bash NVME_CLI_VERSION=\u0026#34;1.12\u0026#34; ###################################################### # Log ###################################################### export RED=\u0026#39;\\x1b[0;31m\u0026#39; export GREEN=\u0026#39;\\x1b[38;5;22m\u0026#39; export CYAN=\u0026#39;\\x1b[36m\u0026#39; export YELLOW=\u0026#39;\\x1b[33m\u0026#39; export NO_COLOR=\u0026#39;\\x1b[0m\u0026#39; if [ -z \u0026#34;${LOG_TITLE}\u0026#34; ]; then LOG_TITLE=\u0026#39;\u0026#39; fi if [ -z \u0026#34;${LOG_LEVEL}\u0026#34; ]; then LOG_LEVEL=\u0026#34;INFO\u0026#34; fi debug() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${GREEN}[DEBUG]${log_title} ${NO_COLOR}$1\u0026#34; fi } info() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${CYAN}[INFO] ${log_title} ${NO_COLOR}$1\u0026#34; fi } warn() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;WARN\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${YELLOW}[WARN] ${log_title} ${NO_COLOR}$1\u0026#34; fi } error() { if [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;DEBUG\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;INFO\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;WARN\u0026#34; ]] ||\\ [[ \u0026#34;${LOG_LEVEL}\u0026#34; == \u0026#34;ERROR\u0026#34; ]]; then local log_title if [ -n \u0026#34;${LOG_TITLE}\u0026#34; ]; then log_title=\u0026#34;(${LOG_TITLE})\u0026#34; else log_title=\u0026#39;\u0026#39; fi echo -e \u0026#34;${RED}[ERROR]${log_title} ${NO_COLOR}$1\u0026#34; fi } ###################################################### # Check logics ###################################################### set_packages_and_check_cmd() { case $OS in *\u0026#34;debian\u0026#34;* | *\u0026#34;ubuntu\u0026#34;* ) CHECK_CMD=\u0026#39;dpkg -l | grep -w\u0026#39; PACKAGES=(nfs-common open-iscsi cryptsetup dmsetup) ;; *\u0026#34;centos\u0026#34;* | *\u0026#34;fedora\u0026#34;* | *\u0026#34;rocky\u0026#34;* | *\u0026#34;ol\u0026#34;* ) CHECK_CMD=\u0026#39;rpm -q\u0026#39; PACKAGES=(nfs-utils iscsi-initiator-utils cryptsetup device-mapper) ;; *\u0026#34;suse\u0026#34;* ) CHECK_CMD=\u0026#39;rpm -q\u0026#39; PACKAGES=(nfs-client open-iscsi cryptsetup device-mapper) ;; *\u0026#34;arch\u0026#34;* ) CHECK_CMD=\u0026#39;pacman -Q\u0026#39; PACKAGES=(nfs-utils open-iscsi cryptsetup device-mapper) ;; *\u0026#34;gentoo\u0026#34;* ) CHECK_CMD=\u0026#39;qlist -I\u0026#39; PACKAGES=(net-fs/nfs-utils sys-block/open-iscsi sys-fs/cryptsetup sys-fs/lvm2) ;; *) CHECK_CMD=\u0026#39;\u0026#39; PACKAGES=() warn \u0026#34;Stop the environment check because \u0026#39;$OS\u0026#39; is not supported in the environment check script.\u0026#34; exit 1 ;; esac } detect_node_kernel_release() { local pod=\u0026#34;$1\u0026#34; KERNEL_RELEASE=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;uname -r\u0026#39;) echo \u0026#34;$KERNEL_RELEASE\u0026#34; } detect_node_os() { local pod=\u0026#34;$1\u0026#34; OS=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -E \u0026#34;^ID_LIKE=\u0026#34; /etc/os-release | cut -d= -f2\u0026#39;) if [[ -z \u0026#34;${OS}\u0026#34; ]]; then OS=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -E \u0026#34;^ID=\u0026#34; /etc/os-release | cut -d= -f2\u0026#39;) fi echo \u0026#34;$OS\u0026#34; } check_local_dependencies() { local targets=($@) local all_found=true for ((i=0; i\u0026lt;${#targets[@]}; i++)); do local target=${targets[$i]} if [ \u0026#34;$(which $target)\u0026#34; = \u0026#34;\u0026#34; ]; then all_found=false error \u0026#34;Not found: $target\u0026#34; fi done if [ \u0026#34;$all_found\u0026#34; = \u0026#34;false\u0026#34; ]; then msg=\u0026#34;Please install missing dependencies: ${targets[@]}.\u0026#34; info \u0026#34;$msg\u0026#34; exit 2 fi msg=\u0026#34;Required dependencies \u0026#39;${targets[@]}\u0026#39; are installed.\u0026#34; info \u0026#34;$msg\u0026#34; } create_ds() { cat \u0026lt;\u0026lt;EOF \u0026gt; $TEMP_DIR/environment_check.yaml apiVersion: apps/v1 kind: DaemonSet metadata: labels: app: longhorn-environment-check name: longhorn-environment-check spec: selector: matchLabels: app: longhorn-environment-check template: metadata: labels: app: longhorn-environment-check spec: hostPID: true containers: - name: longhorn-environment-check image: alpine:3.12 args: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;sleep 1000000000\u0026#34;] volumeMounts: - name: mountpoint mountPath: /tmp/longhorn-environment-check mountPropagation: Bidirectional securityContext: privileged: true volumes: - name: mountpoint hostPath: path: /tmp/longhorn-environment-check EOF kubectl create -f $TEMP_DIR/environment_check.yaml \u0026gt; /dev/null } cleanup() { info \u0026#34;Cleaning up longhorn-environment-check pods...\u0026#34; kubectl delete -f $TEMP_DIR/environment_check.yaml \u0026gt; /dev/null rm -rf $TEMP_DIR info \u0026#34;Cleanup completed.\u0026#34; } wait_ds_ready() { while true; do local ds=$(kubectl get ds/longhorn-environment-check -o json) local numberReady=$(echo $ds | jq .status.numberReady) local desiredNumberScheduled=$(echo $ds | jq .status.desiredNumberScheduled) if [ \u0026#34;$desiredNumberScheduled\u0026#34; = \u0026#34;$numberReady\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$desiredNumberScheduled\u0026#34; != \u0026#34;0\u0026#34; ]; then info \u0026#34;All longhorn-environment-check pods are ready ($numberReady/$desiredNumberScheduled).\u0026#34; return fi info \u0026#34;Waiting for longhorn-environment-check pods to become ready ($numberReady/$desiredNumberScheduled)...\u0026#34; sleep 3 done } check_mount_propagation() { local allSupported=true local pods=$(kubectl -l app=longhorn-environment-check get po -o json) local ds=$(kubectl get ds/longhorn-environment-check -o json) local desiredNumberScheduled=$(echo $ds | jq .status.desiredNumberScheduled) for ((i=0; i\u0026lt;desiredNumberScheduled; i++)); do local pod=$(echo $pods | jq .items[$i]) local nodeName=$(echo $pod | jq -r .spec.nodeName) local mountPropagation=$(echo $pod | jq -r \u0026#39;.spec.containers[0].volumeMounts[] | select(.name==\u0026#34;mountpoint\u0026#34;) | .mountPropagation\u0026#39;) if [ \u0026#34;$mountPropagation\u0026#34; != \u0026#34;Bidirectional\u0026#34; ]; then allSupported=false error \u0026#34;node $nodeName: MountPropagation is disabled\u0026#34; fi done if [ \u0026#34;$allSupported\u0026#34; != \u0026#34;true\u0026#34; ]; then error \u0026#34;MountPropagation is disabled on at least one node. As a result, CSI driver and Base image cannot be supported\u0026#34; exit 1 else info \u0026#34;MountPropagation is enabled\u0026#34; fi } check_hostname_uniqueness() { hostnames=$(kubectl get nodes -o jsonpath=\u0026#39;{.items[*].status.addresses[?(@.type==\u0026#34;Hostname\u0026#34;)].address}\u0026#39;) if [ $? -ne 0 ]; then error \u0026#34;kubectl get nodes failed - check KUBECONFIG setup\u0026#34; exit 1 fi if [[ ! ${hostnames[@]} ]]; then error \u0026#34;kubectl get nodes returned empty list - check KUBECONFIG setup\u0026#34; exit 1 fi deduplicate_hostnames=() num_nodes=0 for hostname in ${hostnames}; do num_nodes=$((num_nodes+1)) if ! echo \u0026#34;${deduplicate_hostnames[@]}\u0026#34; | grep -q \u0026#34;\\\u0026lt;${hostname}\\\u0026gt;\u0026#34;; then deduplicate_hostnames+=(\u0026#34;${hostname}\u0026#34;) fi done if [ \u0026#34;${#deduplicate_hostnames[@]}\u0026#34; != \u0026#34;${num_nodes}\u0026#34; ]; then error \u0026#34;Nodes do not have unique hostnames.\u0026#34; exit 2 fi info \u0026#34;All nodes have unique hostnames.\u0026#34; } check_nodes() { local name=$1 local callback=$2 shift shift info \u0026#34;Checking $name...\u0026#34; local all_passed=true local pods=$(kubectl get pods -o name -l app=longhorn-environment-check) for pod in ${pods}; do eval \u0026#34;${callback} ${pod} $@\u0026#34; if [ $? -ne 0 ]; then all_passed=false fi done if [ \u0026#34;$all_passed\u0026#34; = \u0026#34;false\u0026#34; ]; then return 1 fi } verlte() { printf \u0026#39;%s\\n\u0026#39; \u0026#34;$1\u0026#34; \u0026#34;$2\u0026#34; | sort -C -V } verlt() { ! verlte \u0026#34;$2\u0026#34; \u0026#34;$1\u0026#34; } kernel_in_range() { verlte \u0026#34;$2\u0026#34; \u0026#34;$1\u0026#34; \u0026amp;\u0026amp; verlt \u0026#34;$1\u0026#34; \u0026#34;$3\u0026#34; } check_kernel_release() { local pod=$1 local node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) recommended_kernel_release=\u0026#34;5.8\u0026#34; local kernel=$(detect_node_kernel_release ${pod}) if verlt \u0026#34;$kernel\u0026#34; \u0026#34;$recommended_kernel_release\u0026#34; ; then warn \u0026#34;Node $node has outdated kernel release: $kernel. Recommending kernel release \u0026gt;= $recommended_kernel_release\u0026#34; return 1 fi local broken_kernel=(\u0026#34;5.15.0-94\u0026#34; \u0026#34;6.5.6\u0026#34;) local fixed_kernel=(\u0026#34;5.15.0-100\u0026#34; \u0026#34;6.5.7\u0026#34;) for i in ${!broken_kernel[@]}; do if kernel_in_range \u0026#34;$kernel\u0026#34; \u0026#34;${broken_kernel[$i]}\u0026#34; \u0026#34;${fixed_kernel[$i]}\u0026#34; ; then warn \u0026#34;Node $node has a kernel version $kernel known to have a breakage that affects Longhorn. See description and solution at https://longhorn.io/kb/troubleshooting-rwx-volume-fails-to-attached-caused-by-protocol-not-supported\u0026#34; return 1 fi done } check_iscsid() { local pod=$1 kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager iscsid.service\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager iscsid.socket\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;Neither iscsid.service nor iscsid.socket is running on ${node}\u0026#34; return 1 fi fi } check_multipathd() { local pod=$1 kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;systemctl status --no-pager multipathd.service\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? = 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) warn \u0026#34;multipathd is running on ${node} known to have a breakage that affects Longhorn. See description and solution at https://longhorn.io/kb/troubleshooting-volume-with-multipath\u0026#34; return 1 fi } check_packages() { local pod=$1 OS=$(detect_node_os ${pod}) if [ x\u0026#34;$OS\u0026#34; = x\u0026#34;\u0026#34; ]; then error \u0026#34;Failed to detect OS on node ${node}\u0026#34; return 1 fi set_packages_and_check_cmd for ((i=0; i\u0026lt;${#PACKAGES[@]}; i++)); do check_package ${PACKAGES[$i]} if [ $? -ne 0 ]; then return 1 fi done } check_package() { local package=$1 kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- timeout 30 bash -c \u0026#34;$CHECK_CMD $package\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;$package is not found in $node.\u0026#34; return 1 fi } check_nfs_client() { local pod=$1 local node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) local options=(\u0026#34;CONFIG_NFS_V4_2\u0026#34; \u0026#34;CONFIG_NFS_V4_1\u0026#34; \u0026#34;CONFIG_NFS_V4\u0026#34;) local kernel=$(detect_node_kernel_release ${pod}) if [ \u0026#34;x${kernel}\u0026#34; = \u0026#34;x\u0026#34; ]; then warn \u0026#34;Failed to check NFS client installation, because unable to detect kernel release on node ${node}\u0026#34; return 1 fi for option in \u0026#34;${options[@]}\u0026#34;; do kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;[ -f /boot/config-${kernel} ]\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then warn \u0026#34;Failed to check $option on node ${node}, because /boot/config-${kernel} does not exist on node ${node}\u0026#34; continue fi check_kernel_module ${pod} ${option} nfs if [ $? = 0 ]; then return 0 fi done error \u0026#34;NFS clients ${options[*]} not found. At least one should be enabled\u0026#34; return 1 } check_kernel_module() { local pod=$1 local option=$2 local module=$3 local kernel=$(detect_node_kernel_release ${pod}) if [ \u0026#34;x${kernel}\u0026#34; = \u0026#34;x\u0026#34; ]; then warn \u0026#34;Failed to check kernel config option ${option}, because unable to detect kernel release on node ${node}\u0026#34; return 1 fi kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;[ -e /boot/config-${kernel} ]\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then warn \u0026#34;Failed to check kernel config option ${option}, because /boot/config-${kernel} does not exist on node ${node}\u0026#34; return 1 fi value=$(kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;grep \u0026#34;^$option=\u0026#34; /boot/config-${kernel} | cut -d= -f2\u0026#34;) if [ -z \u0026#34;${value}\u0026#34; ]; then error \u0026#34;Failed to find kernel config $option on node ${node}\u0026#34; return 1 elif [ \u0026#34;${value}\u0026#34; = \u0026#34;m\u0026#34; ]; then kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#34;lsmod | grep ${module}\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -ne 0 ]; then node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) error \u0026#34;kernel module ${module} is not enabled on ${node}\u0026#34; return 1 fi elif [ \u0026#34;${value}\u0026#34; = \u0026#34;y\u0026#34; ]; then return 0 else warn \u0026#34;Unknown value for $option: $value\u0026#34; return 1 fi } check_hugepage() { local pod=$1 local expected_nr_hugepages=$2 nr_hugepages=$(kubectl exec ${pod} -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;cat /proc/sys/vm/nr_hugepages\u0026#39;) if [ $? -ne 0 ]; then error \u0026#34;Failed to check hugepage size on node ${node}\u0026#34; return 1 fi if [ $nr_hugepages -lt $expected_nr_hugepages ]; then error \u0026#34;Hugepage size is not enough on node ${node}. Expected: ${expected_nr_hugepages}, Actual: ${nr_hugepages}\u0026#34; return 1 fi } function check_sse42_support() { local pod=$1 node=$(kubectl get ${pod} --no-headers -o=custom-columns=:.spec.nodeName) machine=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;uname -m\u0026#39; 2\u0026gt;/dev/null) if [ $? -ne 0 ]; then error \u0026#34;Failed to check machine on node ${node}\u0026#34; return 1 fi if [ \u0026#34;$machine\u0026#34; = \u0026#34;x86_64\u0026#34; ]; then sse42_support=$(kubectl exec $pod -- nsenter --mount=/proc/1/ns/mnt -- bash -c \u0026#39;grep -o sse4_2 /proc/cpuinfo | wc -l\u0026#39; 2\u0026gt;/dev/null) if [ $? -ne 0 ]; then error \u0026#34;Failed to check SSE4.2 instruction set on node ${node}\u0026#34; return 1 fi if [ \u0026#34;$sse42_support\u0026#34; -ge 1 ]; then return 0 fi error \u0026#34;CPU does not support SSE4.2\u0026#34; return 1 else warn \u0026#34;Skip SSE4.2 instruction set check on node ${node} because it is not x86_64\u0026#34; fi } function show_help() { cat \u0026lt;\u0026lt;EOF Usage: $0 [OPTIONS] Options: -s, --enable-spdk Enable checking SPDK prerequisites -p, --expected-nr-hugepages Expected number of 2 MiB hugepages for SPDK. Default: 1024 -h, --help Show this help message and exit EOF exit 0 } enable_spdk=false expected_nr_hugepages=1024 while [[ $# -gt 0 ]]; do opt=\u0026#34;$1\u0026#34; case $opt in -s|--enable-spdk) enable_spdk=true ;; -p|--expected-nr-hugepages) expected_nr_hugepages=\u0026#34;$2\u0026#34; shift ;; -h|--help) show_help ;; *) instance_manager_options+=(\u0026#34;$1\u0026#34;) ;; esac shift done ###################################################### # Main logics ###################################################### DEPENDENCIES=(\u0026#34;kubectl\u0026#34; \u0026#34;jq\u0026#34; \u0026#34;mktemp\u0026#34; \u0026#34;sort\u0026#34; \u0026#34;printf\u0026#34;) check_local_dependencies \u0026#34;${DEPENDENCIES[@]}\u0026#34; # Check the each host has a unique hostname (for RWX volume) check_hostname_uniqueness # Create a daemonset for checking the requirements in each node TEMP_DIR=$(mktemp -d) trap cleanup EXIT create_ds wait_ds_ready check_mount_propagation check_nodes \u0026#34;kernel release\u0026#34; check_kernel_release check_nodes \u0026#34;iscsid\u0026#34; check_iscsid check_nodes \u0026#34;multipathd\u0026#34; check_multipathd check_nodes \u0026#34;packages\u0026#34; check_packages check_nodes \u0026#34;nfs client\u0026#34; check_nfs_client if [ \u0026#34;$enable_spdk\u0026#34; = \u0026#34;true\u0026#34; ]; then check_nodes \u0026#34;x86-64 SSE4.2 instruction set\u0026#34; check_sse42_support check_nodes \u0026#34;kernel module nvme_tcp\u0026#34; check_kernel_module CONFIG_NVME_TCP nvme_tcp check_nodes \u0026#34;kernel module uio_pci_generic\u0026#34; check_kernel_module CONFIG_UIO_PCI_GENERIC uio_pci_generic check_nodes \u0026#34;hugepage\u0026#34; check_hugepage ${expected_nr_hugepages} fi exit 0 2.4.2 安装 # 在线环境安装命令\n进入到longhorn的helm目录下 helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace -f ./values.yaml 离线环境安装命令（备选） 进入到longhorn的helm目录下 helm install longhorn --namespace longhorn-system --create-namespace -f ./ 2.4.3 查看 # kubectl get all -n longhorn-system 3. 测试说明 # 基于https://github.com/yasker/kbench项目进行性能测试 对于官方基准测试：\nSIZE环境变量：大小应至少为读/写带宽的 25 倍，以避免缓存影响结果。 如果要测试像 Longhorn 这样的分布式存储解决方案，请始终首先针对本地存储进行测试，以了解基线是什么。 如果您使用 Kubernetes 进行测试，则可以为本地存储安装存储提供程序，例如本地路径配置器，用于此测试。 CPU_IDLE_PROF环境变量：CPU 空闲度分析测量 CPU 空闲，但它会带来额外的开销并降低存储性能。默认情况下，该标志处于禁用状态。 3.1 参数解析 # IOPS：每秒 IO 操作数。越高越好。 它是衡量设备在一秒钟内可以处理多少 IO 操作的度量，主要涉及较小的 IO 块，例如 4k。 带宽：也称为吞吐量。越高越好。 它是设备在一秒钟内可以读取/写入多少数据的度量。它主要是处理较大的IO块，例如128k。 延迟：每个请求在 IO 路径中花费的总时间。越_低越好。_ 它是存储系统处理每个请求的效率的度量。 存储系统的数据路径开销可以表示为它在本机存储系统 （SSD/NVMe） 之上增加的延迟。 CPU 空闲：运行测试的节点上的 CPU 空闲程度。越高越好。 它是存储设备生成的 CPU 负载/开销的度量。 请注意，这是空闲，因此如果该值更高，则意味着该节点上的 CPU 具有更多的空闲周期。 不幸的是，此测量值目前无法反映分布式存储系统整个群集上的负载。但是，在基准测试时，它仍然是存储客户端的CPU负载的值得参考（取决于分布式存储的架构方式）。 对于_比较基准_，该列指示将第二个卷与第一个卷进行比较时的百分比差异。 对于 **IOPS、带宽、CPU 空闲，**正百分比更好。 对于延迟，负百分比更好。 对于 **CPU 空闲，**我们显示的不是变化的百分比，而是差异。 3.1.1 了解分布式存储系统的结果 # 对于分布式存储系统，始终需要先测试本地存储作为基准。 在以下_情况下出现问题：\n读取_延迟低于本地存储_。 您可能会获得比本地存储更高的读取 IOPS/带宽，因为存储引擎可以聚合来自不同节点/磁盘的性能。但是，与本地存储相比，您应该无法获得更低的读取延迟。 如果发生这种情况，很可能是由于存在缓存。增加以避免这种情况。SIZE 写入 IOPS/带宽/延迟比本地存储更好。 与分布式存储解决方案的本地存储相比，几乎不可能获得更好的写入性能，除非在本地存储前面有一个持久性缓存设备。 如果得到此结果，则存储解决方案可能不是崩溃一致的，因此它不会在响应之前将数据提交到磁盘中，这意味着在发生事件时，您可能会丢失数据。 您将获得延迟_基准的低 CPU 空闲率_，例如 \u0026lt;40%。 对于延迟，CPU 空闲应至少为 40%，以确保测试不会受到 CPU 不足的影响。 如果发生这种情况，请向节点添加更多 CPU，或移动到增强计算机。 3.1.2 部署 FIO 基准 # 3.1.2.1 在 Kubernetes 集群中部署单卷基准测试 # 默认情况下：\n基准测试将使用默认存储类。 您可以在本地使用 YAML 指定存储类。 将使用文件系统模式。 您可以在本地使用 YAML 切换到阻止模式。 该测试暂时需要 33G PVC。 可以在本地使用 YAML 更改测试大小。 如上所述，对于正式基准测试，大小应至少为读/写带宽的 25 倍，以避免缓存影响结果。 3.2 测试步骤 # 3.2.1 Longhorn基准测试 # kubectl apply -f https://raw.githubusercontent.com/yasker/kbench/main/deploy/fio.yaml kind: PersistentVolumeClaim apiVersion: v1 metadata: name: kbench-pvc spec: volumeMode: Filesystem #volumeMode: Block #storageClassName: longhorn # replace with your storage class #storageClassName: local-path accessModes: - ReadWriteOnce resources: requests: storage: 33Gi --- apiVersion: batch/v1 kind: Job metadata: name: kbench spec: template: metadata: labels: kbench: fio spec: containers: - name: kbench image: yasker/kbench:latest imagePullPolicy: Always env: #- name: QUICK_MODE # for debugging # value: \u0026#34;1\u0026#34; - name: FILE_NAME value: \u0026#34;/volume/test\u0026#34; - name: SIZE value: \u0026#34;30G\u0026#34; # must be 10% smaller than the PVC size due to filesystem also took space - name: CPU_IDLE_PROF value: \u0026#34;disabled\u0026#34; # must be \u0026#34;enabled\u0026#34; or \u0026#34;disabled\u0026#34; volumeMounts: - name: vol mountPath: /volume/ #volumeDevices: #- name: vol # devicePath: /volume/test restartPolicy: Never volumes: - name: vol persistentVolumeClaim: claimName: kbench-pvc backoffLimit: 0 3.2.2 结果展示 # 3.3 比较基准测试 # 4. longhorn卸载 # 注意：卸载前最好将所有pvc及pv都逐个删除\n4.1 删除标志设置：方式一，终端 # kubectl -n longhorn-system patch -p \u0026#39;{\u0026#34;value\u0026#34;: \u0026#34;true\u0026#34;}\u0026#39; --type=merge lhs deleting-confirmation-flag 4.2 删除标志设置：方式二，界面 # 勾选Deleting Confirmation Flag选项 4.3 删除操作 # helm uninstall longhorn -n longhorn-system ","date":"2023-08-26","externalUrl":null,"permalink":"/longhorn/20230826-1/","section":"longhorn存储","summary":"\u003ch1 class=\"relative group\"\u003e1. 前言 \n    \u003cdiv id=\"1-%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\n    \n    \u003cspan\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%89%8D%E8%A8%80\" aria-label=\"锚点\"\u003e#\u003c/a\u003e\n    \u003c/span\u003e        \n    \n\u003c/h1\u003e\n\u003cp\u003eLonghorn采用容器和微服务技术实现了分布式块存储。Longhorn为每个块设备卷创建一个专门的存储控制器，并且对多个节点上存储副本中的卷进行实时复制。\u003c/p\u003e","title":"Longhorn部署及使用","type":"blog"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/longhorn/","section":"longhorn存储","summary":"","title":"longhorn存储","type":"longhorn"},{"content":"","date":"2023-08-26","externalUrl":null,"permalink":"/tags/storage/","section":"Tags","summary":"","title":"Storage","type":"tags"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/api/","section":"Tags","summary":"","title":"Api","type":"tags"},{"content":"实现docker及containerd镜像代理配置。\n1. docker配置代理 # 修改docker配置： /etc/docker/daemon.json \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://xxx.xxx.xxx\u0026#34; ], 重启服务 systemctl daemon-reload systemctl restart docker 拉取镜像测试\ndocker pull nginx 2. containerd配置代理 # 修改docker配置： /etc/containerd/config.toml [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;] endpoint = [\u0026#34;https://xxx.xxx.xxx\u0026#34;] 重启服务 systemctl daemon-reload systemctl restart containerd 拉取镜像测试\ncrictl pull nginx ","date":"2023-03-11","externalUrl":null,"permalink":"/kubernetes/20230311-1/","section":"Kubernetes","summary":"\u003cp\u003e实现docker及containerd镜像代理配置。\u003c/p\u003e","title":"docker及containerd镜像代理配置","type":"blog"},{"content":"实现docker远程操作api（2375端口）开放。\n1. 检查2375端口是否开启 # netstat -tuln | grep 2375 如果已开启，则会出现如下日志\nroot@work01:~# netstat -tuln | grep 2375 tcp6 0 0 :::2375 :::* LISTEN 如果未输出以上日志，则进入下一步开启2375端口\n2. 开启2375端口 # 2.1 修改docker配置文件: /etc/docker/daemon.json # 新增如下配置 这段配置的意思是允许Docker监听在0.0.0.0的2375端口上，这样就可以远程访问Docker { \u0026#34;hosts\u0026#34;: [\u0026#34;tcp://0.0.0.0:2375\u0026#34;, \u0026#34;unix:///var/run/docker.sock\u0026#34;] } 2.2 重启docker # systemctl restart docker ","date":"2023-03-11","externalUrl":null,"permalink":"/kubernetes/20230311-2/","section":"Kubernetes","summary":"\u003cp\u003e实现docker远程操作api（2375端口）开放。\u003c/p\u003e","title":"docker开放远程操作api（2375）","type":"blog"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/pvc/","section":"Tags","summary":"","title":"Pvc","type":"tags"},{"content":" 仅限PVC绑定其它未删除POD且自身处于terminating状态。\n1. 修改pvc对应pv的回收策略为Retain # 1.1 编辑对应pvc # kubectl edit pv pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 修改策略为Retain后，保存并退出 2. 停止相关pod # 2.1 单pod服务（直接删除服务） # 2.2 多副本pod服务（降低副本数量为0） # 2.3 删除pv所绑定的旧pvc信息 # kubectl edit pv pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 删除对应7行信息，保存并退出 claimRef: apiVersion: v1 kind: PersistentVolumeClaim name: system-minio namespace: ai-education resourceVersion: \u0026#34;87954836\u0026#34; uid: 18c818e0-3e4c-45b0-8156-5d61fbfd6296 3. 重新申请pvc绑定指定pv # 3.1 查看pv状态为available # 3.2 申请pvc # kubectl apply -f k8s-pvc2.yaml k8s-pvc2.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: system-minio # 原pvc name namespace: ai-education # 原pvc namespace spec: accessModes: - ReadWriteOnce # 原pv 读写模式 resources: requests: storage: 8Gi # 原pv 容量 volumeName: pvc-18c818e0-3e4c-45b0-8156-5d61fbfd6296 # 原pv name ","date":"2023-03-11","externalUrl":null,"permalink":"/volume-solve/20230311-1/","section":"云存储问题解决","summary":"\u003cblockquote\u003e\n\u003cp\u003e仅限PVC绑定其它未删除POD且自身处于terminating状态。\u003c/p\u003e\n\u003c/blockquote\u003e","title":"PVC误删除后恢复操作","type":"blog"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/tags/volume/","section":"Tags","summary":"","title":"Volume","type":"tags"},{"content":"","date":"2023-03-11","externalUrl":null,"permalink":"/volume-solve/","section":"云存储问题解决","summary":"","title":"云存储问题解决","type":"volume-solve"},{"content":"k8s网络问题解决记录\n1. k8s(1):calico网络问题排查，IP_AUTODETECTION_METHOD # 引用： https://zhuanlan.zhihu.com/p/488034895?utm_id=0\n问题描述： 4个节点的k8s集群，忽然有个节点上的pod无法访问其他节点的k8s域名了\n排查 ①查看coredns服务状态，发现正常，排除内部dns解析问题 ②查看发现异常pod节点对应的calico-node-rdw97服务异常，出现了非正常使用网卡信息 ③查看calico配置发现，网卡配置为P_AUTODETECTION_METHOD： first_found，这样很容易选错网卡 解决：查看并修改calico node的daemonset配置：(vim环境) kubectl edit DaemonSet calico-node -n calico-system\n发现: IP_AUTODETECTION_METHOD 这个环境变量\n的值是first_found，我的机器网上eth0并不是第一个，这样可能有问题。因此修改成 value: \u0026ldquo;interface=eth0\u0026rdquo; 并保存退出，居然没生效。\n原因是：\n该方法命令虽然可以执行，但是我这里ds么没有生效。k8s 1.22，通过operator生成的calico，不是calico.yaml，如果是calico.yaml，直接修改文件中的参数即可。（calico-node报错Readiness probe failed: calico/node is not ready: BIRD is not ready: Error querying BIRD: unable to connect to BIRDv4 socket - Wghdr\u0026rsquo;s Blog!）\n解决2： 因此要用另一种方法来修改：\n我的custom-resources.yaml 如下，加上红色部分：\ncustom-resources.yaml nodeAddressAutodetectionV4: interface: eno.* # This section includes base Calico installation configuration. # For more information, see: https://projectcalico.docs.tigera.io/v3.22/reference/installation/api#operator.tigera.io/v1.Installation apiVersion: operator.tigera.io/v1 kind: Installation metadata: name: default spec: # Configures Calico networking. registry: sea.hub:5000 calicoNetwork: # Note: The ipPools section cannot be modified post-install. ipPools: - blockSize: 26 cidr: 100.64.0.0/10 encapsulation: VXLANCrossSubnet natOutgoing: Enabled nodeSelector: all() nodeAddressAutodetectionV4: interface: eno.* --- # This section configures the Calico API server. # For more information, see: https://projectcalico.docs.tigera.io/v3.22/reference/installation/api#operator.tigera.io/v1.APIServer apiVersion: operator.tigera.io/v1 kind: APIServer metadata: name: default spec: {} 然后重新执行： kubectl apply -f custom-resources.yaml 然后再：\nkubectl set env ds/calico-node -n calico-system IP_AUTODETECTION_METHOD=interface=eno3 可能会出现的问题，calico-apiserver-5787fcd448-s56vz出现异常，并报ImageNameError,查找发现yaml中定义的ImageName不知为何少了一个/，添加后重启服务即可 ","date":"2023-02-11","externalUrl":null,"permalink":"/cloudnetissues/20230211-3/","section":"云原生网络知识集合","summary":"\u003cp\u003ek8s网络问题解决记录\u003c/p\u003e","title":"k8s网络问题解决记录","type":"blog"},{"content":"","date":"2023-02-11","externalUrl":null,"permalink":"/tags/service/","section":"Tags","summary":"","title":"Service","type":"tags"},{"content":"","date":"2023-02-11","externalUrl":null,"permalink":"/cloudnetissues/","section":"云原生网络知识集合","summary":"","title":"云原生网络知识集合","type":"cloudnetissues"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/command/","section":"Tags","summary":"","title":"Command","type":"tags"},{"content":"收集各类常见kubernetes命令。\n1. 取消主节点禁止调度污点 # ● 较旧版本\nkubectl taint node k3s01 node-role.kubernetes.io/master:NoSchedule- ● 较新版本：\nkubectl taint node k3s01 node-role.kubernetes.io/control-plane:NoSchedule- ","date":"2022-03-12","externalUrl":null,"permalink":"/kubernetes/20220312-3/","section":"Kubernetes","summary":"\u003cp\u003e收集各类常见kubernetes命令。\u003c/p\u003e","title":"Kubernetes命令集合","type":"blog"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/sh/","section":"Tags","summary":"","title":"Sh","type":"tags"},{"content":"","date":"2022-03-12","externalUrl":null,"permalink":"/tags/shell/","section":"Tags","summary":"","title":"Shell","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/coding/","section":"Tags","summary":"","title":"Coding","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/go/","section":"Tags","summary":"","title":"Go","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/go/","section":"Go语言","summary":"","title":"Go语言","type":"go"},{"content":" 实现k8s端口号定义及分配\n1. NodePort 范围 # 在 Kubernetes 集群中，NodePort 默认范围是 30000-32767\n2. 增大NodePort范围 # 修改kube-apiserver.yaml文件\n● 使用 kubeadm 安装 K8S 集群的情况下，您的 Master 节点上会有一个文件 /etc/kubernetes/manifests/kube-apiserver.yaml，修改此文件，向其中添加 \u0026ndash;service-node-port-range=20000-22767 （定义需要的端口范围），如下所示：\napiVersion: v1 kind: Pod ... ... ... ... - --service-account-key-file=/etc/kubernetes/pki/sa.pub - --service-node-port-range=20000-22767 - --service-cluster-ip-range=10.96.0.0/22 ... ... ... ... 3. 重启kube-apiserver # # 获得 apiserver 的 pod 名字 export apiserver_pods=$(kubectl get pods --selector=component=kube-apiserver -n kube-system --output=jsonpath={.items..metadata.name}) # 删除 apiserver 的 pod kubectl delete pod $apiserver_pods -n kube-system 4.验证结果 # ● 执行以下命令查看相关pod\nkubectl describe pod $apiserver_pods -n kube-system 注意:\n● 对于已经创建的NodePort类型的Service，需要删除重新创建\n● 如果集群有多个 Master 节点，需要逐个修改每个节点上的 /etc/kubernetes/manifests/kube-apiserver.yaml 文件，并重启 apiserver\n","date":"2022-03-11","externalUrl":null,"permalink":"/cloudnetissues/20220311-1/","section":"云原生网络知识集合","summary":"\u003ch5 id=\"typeit-c2ef07445b197a99457be36a816dd2c7\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-c2ef07445b197a99457be36a816dd2c7\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\u003cp\u003e实现k8s端口号定义及分配\u003c/p\u003e","title":"k8s端口号定义及分配","type":"blog"},{"content":" 实现k8s容器间免密访问方案\nPod 使用同样的私钥/公钥，可以互相免密访问 只需生成同样的 id_rsa和 id_rsa.pub，然后将 authorized_keys的内容设为id_rsa.pub一致。也即将相同的配置文件挂载到不同的Pod上即可\nconfig文件配置\n将 id_rsa,id_rsa.pub,authorized_keys,config作为 configmap的内容。 # 第一次访问时，无需确认，直接连接 StrictHostKeyChecking no UserKnownHostsFile /dev/null # pod 间无法通过 hostname 直接访问对方的，因此需要 service Host pod-hostname-1 HostName pod-hostname-1.service-name Host pod-hostname-2 HostName pod-hostname-2.service-name 1. Pod 主机名解析 # 1.1 pod 间无法通过 hostname 直接访问对方的，因此需要 service： # 可以参考 Pod 间通信； 1.1.1 启动带 Pod 间通信的 Job # 要在某 Job 中启用使用 Pod 主机名的 Pod 间通信，你必须执行以下操作：\n对于 Job 所创建的那些 Pod， 使用一个有效的标签选择算符创建无头服务。 该无头服务必须位于与该 Job 相同的名字空间内。 实现这一目的的一种简单的方式是使用 job-name: \u0026lt;任务名称\u0026gt; 作为选择算符， 因为 job-name 标签将由 Kubernetes 自动添加。 此配置将触发 DNS 系统为运行 Job 的 Pod 创建其主机名的记录。 通过将以下值包括到你的 Job 模板规约中，针对该 Job 的 Pod，将无头服务配置为其子域服务： subdomain: \u0026lt;无头服务的名称\u0026gt; 示例:以下是启用通过 Pod 主机名来完成 Pod 间通信的 Job 示例。 只有在使用主机名成功 ping 通所有 Pod 之后，此 Job 才会结束。\n说明： # 在以下示例中的每个 Pod 中执行的 Bash 脚本中，如果需要从名字空间外到达 Pod， Pod 主机名也可以带有该名字空间作为前缀。\napiVersion: v1 kind: Service metadata: name: headless-svc spec: clusterIP: None # clusterIP 必须为 None 以创建无头服务 selector: job-name: example-job # 必须与 Job 名称匹配 --- apiVersion: batch/v1 kind: Job metadata: name: example-job spec: completions: 3 parallelism: 3 completionMode: Indexed template: spec: subdomain: headless-svc # 必须与 Service 名称匹配 restartPolicy: Never containers: - name: example-workload image: bash:latest command: - bash - -c - | for i in 0 1 2 do gotStatus=\u0026#34;-1\u0026#34; wantStatus=\u0026#34;0\u0026#34; while [ $gotStatus -ne $wantStatus ] do ping -c 1 example-job-${i}.headless-svc \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 gotStatus=$? if [ $gotStatus -ne $wantStatus ]; then echo \u0026#34;Failed to ping pod example-job-${i}.headless-svc, retrying in 1 second...\u0026#34; sleep 1 fi done echo \u0026#34;Successfully pinged pod: example-job-${i}.headless-svc\u0026#34; done 应用上述示例之后，使用 \u0026lt;Pod 主机名\u0026gt;.\u0026lt;无头服务名\u0026gt; 通过网络到达彼此。 你应看到类似以下的输出：\nkubectl logs example-job-0-qws42 Failed to ping pod example-job-0.headless-svc, retrying in 1 second... Successfully pinged pod: example-job-0.headless-svc Successfully pinged pod: example-job-1.headless-svc Successfully pinged pod: example-job-2.headless-svc 说明：谨记此例中使用的 \u0026lt;Pod 主机名\u0026gt;.\u0026lt;无头服务名称\u0026gt; 名称格式不适用于设置为 None 或 Default 的 DNS 策略。 你可以在此处了解有关 Pod DNS 策略的更多信息。\n1.2 hostname 必须是规则化，才可以静态生成所有的主机名： # 可以用 Statefulset 或者 IndexJob 来生成有规则的 hostname。 1.3 Pod 挂载 SSH ConfigMap # 想要免密，则 Pod 上挂载相应的configmap 即可。\nspec: containers: volumeMounts: - name: ssh-config mountPath: /root/.ssh # use subpath to avoid soft link subPath: .ssh volumes: - name: ssh-config configMap: name: ssh-config-cm defaultMode: 0600 items: - key: PRIVATE_KEY path: .ssh/id_rsa - key: PUBLIC_KEY path: .ssh/id_rsa.pub - key: AUTHORIZED_KEYS path: .ssh/authorized_keys - key: CONFIG path: .ssh/config ","date":"2022-03-11","externalUrl":null,"permalink":"/cloudnetissues/20220311-2/","section":"云原生网络知识集合","summary":"\u003ch5 id=\"typeit-b20707817a1a961b2a788c0f2e033193\"\u003e\u003c/h5\u003e\n\n\u003cscript\u003e\n    document.addEventListener(\"DOMContentLoaded\", function () {\n      new TypeIt(\"#typeit-b20707817a1a961b2a788c0f2e033193\", {\n        strings: [\"\\\"无聊望见了犹豫, 达到理想不太易~\\\"\",\"\"],\n        speed:  80 ,\n        lifeLike:  true ,\n        startDelay:  0 ,\n        breakLines:  true ,\n        waitUntilVisible:  true ,\n        loop:  true \n      }).go();\n    });\n\u003c/script\u003e\n\u003cp\u003e实现k8s容器间免密访问方案\u003c/p\u003e","title":"k8s容器间免密访问方案","type":"blog"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/nossh/","section":"Tags","summary":"","title":"Nossh","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/port/","section":"Tags","summary":"","title":"Port","type":"tags"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/ssh/","section":"Tags","summary":"","title":"Ssh","type":"tags"},{"content":"本文提供了可在 Blowfish 中使用的基本 Markdown 格式示例，还展示了如何加入一些基本 HTML 元素。\n标题 # 以下 HTML 元素 \u0026lt;h1\u0026gt;—\u0026lt;h6\u0026gt; 表示六个级别的标题。 \u0026lt;h1\u0026gt; 是最高的标题级别，而 \u0026lt;h6\u0026gt; 是最低的。\nH1 # H2 # H3 # H4 # H5 # H6 # 段落 # Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\n块引用 # 块引用表示从其他来源引用的内容，可以用于位于 footer 或 cite 元素内的引文，并且可以表示一些补充说明（例如注释和缩写）。\n没有参考链接的块引用 # Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\n有参考链接的块引用 # Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n— Rob Pike1\n表格 # 表格不是核心 Markdown 规范的一部分，但 Hugo 支持渲染。\nName Age Bob 27 Alice 23 表格内内联 Markdown # Italics Bold Code italics bold code 代码块 # 带反引号的代码块 # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 缩进四个空格的代码块 # \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 带有 Hugo 内部高亮简码的代码块 # 1 2 3 4 5 6 7 8 9 10 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 列表 # 有序列表 # First item Second item Third item 无序列表 # List item Another item And another item 嵌套列表 # Fruit Apple Orange Banana Dairy Milk Cheese 其他元素 — abbr、sub、sup、kbd、mark # GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\n上述引文摘自 Rob Pike 在 2015 年 11 月 18 日 Gopherfest 期间的谈论“什么都没有”。\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2022-03-11","externalUrl":null,"permalink":"/go/20220311-1/","section":"Go语言","summary":"\u003cp\u003e本文提供了可在 Blowfish 中使用的基本 Markdown 格式示例，还展示了如何加入一些基本 HTML 元素。\u003c/p\u003e","title":"Windows配置Go环境","type":"blog"},{"content":"","date":"2022-03-11","externalUrl":null,"permalink":"/tags/%E7%8E%AF%E5%A2%83/","section":"Tags","summary":"","title":"环境","type":"tags"},{"content":"","date":"2017-07-17","externalUrl":null,"permalink":"/archives/","section":"欢迎来到云一二三知识库! 🎉","summary":"","title":"时间轴","type":"archives"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/code-languages/","section":"编程语言","summary":"","title":"编程语言","type":"code-languages"},{"content":"","externalUrl":null,"permalink":"/skill-tech/","section":"奇淫技巧","summary":"","title":"奇淫技巧","type":"skill-tech"},{"content":"","externalUrl":null,"permalink":"/cloudstorage/","section":"云原生存储","summary":"","title":"云原生存储","type":"cloudstorage"},{"content":"","externalUrl":null,"permalink":"/cloudnet/","section":"云原生网络","summary":"","title":"云原生网络","type":"cloudnet"}]